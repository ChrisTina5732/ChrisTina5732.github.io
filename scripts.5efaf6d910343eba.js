(function(tt){var G=new inkjs.Story(storyContent),S="";let C;if(G.globalTags)for(var ct=0;ct<G.globalTags.length;ct++){var ot=p(G.globalTags[ct]);ot&&"theme"==ot.property?C=ot.val:ot&&"author"==ot.property&&(document.querySelector(".byline").innerHTML="by "+ot.val)}var et=document.querySelector("#story"),it=document.querySelector(".outerContainer");function w(L){for(var q=0,c=L?0:d();G.canContinue;){for(var F=G.Continue(),X=G.currentTags,A=[],J=0;J<X.length;J++){var K=X[J],T=p(K);if(T&&"AUDIO"==T.property?("audio"in this&&(this.audio.pause(),this.audio.removeAttribute("src"),this.audio.load()),this.audio=new Audio(T.val),this.audio.play()):T&&"AUDIOLOOP"==T.property&&("audioLoop"in this&&(this.audioLoop.pause(),this.audioLoop.removeAttribute("src"),this.audioLoop.load()),this.audioLoop=new Audio(T.val),this.audioLoop.play(),this.audioLoop.loop=!0),T&&"IMAGE"==T.property){var m=document.createElement("img");m.src=T.val,et.appendChild(m),vt(q,m),q+=200}else if(T&&"LINK"==T.property)window.location.href=T.val;else if(T&&"LINKOPEN"==T.property)window.open(T.val);else if(T&&"BACKGROUND"==T.property)it.style.backgroundImage="url("+T.val+")";else if(T&&"CLASS"==T.property)A.push(T.val);else if(("CLEAR"==K||"RESTART"==K)&&(Z("p"),Z("img"),V(".header",!1),"RESTART"==K))return void nt()}var P=document.createElement("p");for(P.innerHTML=F,et.appendChild(P),J=0;J<A.length;J++)P.classList.add(A[J]);vt(q,P),q+=200}G.currentChoices.forEach(function(at){var E=document.createElement("p");E.classList.add("choice"),E.innerHTML=`<a href='#'>${at.text}</a>`,et.appendChild(E),vt(q,E),q+=200,E.querySelectorAll("a")[0].addEventListener("click",function(W){W.preventDefault(),Z(".choice"),G.ChooseChoiceIndex(at.index),S=G.state.toJson(),w()})}),et.style.height=d()+"px",L||function Ct(L){var D=L,q=it.scrollHeight-it.clientHeight;D>q&&(D=q);var c=it.scrollTop,X=300+300*(D-c)/100,A=null;requestAnimationFrame(function J(K){null==A&&(A=K);var T=(K-A)/X,m=3*T*T-2*T*T*T;it.scrollTo(0,(1-m)*c+m*D),T<1&&requestAnimationFrame(J)})}(c)}function nt(){G.ResetState(),V(".header",!0),S=G.state.toJson(),w(!0),it.scrollTo(0,0)}function vt(L,D){D.classList.add("hide"),setTimeout(function(){D.classList.remove("hide")},L)}function d(){var L=et.lastElementChild;return L?L.offsetTop+L.offsetHeight:0}function Z(L){for(var D=et.querySelectorAll(L),q=0;q<D.length;q++){var c=D[q];c.parentNode.removeChild(c)}}function V(L,D){for(var q=et.querySelectorAll(L),c=0;c<q.length;c++){var F=q[c];D?F.classList.remove("invisible"):F.classList.add("invisible")}}function p(L){var D=L.indexOf(":");return null!=D?{property:L.substr(0,D).trim(),val:L.substr(D+1).trim()}:null}!function yt(L){var D;try{D=window.localStorage.getItem("theme")}catch{console.debug("Couldn't load saved theme")}var q=window.matchMedia("(prefers-color-scheme: dark)").matches;("dark"===D||null==D&&"dark"===L||null==D&&null==L&&q)&&document.body.classList.add("dark")}(C),function bt(L){let D=document.getElementById("rewind");D&&D.addEventListener("click",function(X){Z("p"),Z("img"),V(".header",!1),nt()});let q=document.getElementById("save");q&&q.addEventListener("click",function(X){try{window.localStorage.setItem("save-state",S),document.getElementById("reload").removeAttribute("disabled"),window.localStorage.setItem("theme",document.body.classList.contains("dark")?"dark":"")}catch{console.warn("Couldn't save state")}});let c=document.getElementById("reload");L||c.setAttribute("disabled","disabled"),c.addEventListener("click",function(X){if(!c.getAttribute("disabled")){Z("p"),Z("img");try{let A=window.localStorage.getItem("save-state");A&&G.state.LoadJson(A)}catch{console.debug("Couldn't load save state")}w(!0)}});let F=document.getElementById("theme-switch");F&&F.addEventListener("click",function(X){document.body.classList.add("switched"),document.body.classList.toggle("dark")})}(function I(){try{let L=window.localStorage.getItem("save-state");if(L)return G.state.LoadJson(L),!0}catch{console.debug("Couldn't load save state")}return!1}()),S=G.state.toJson(),w(!0)})(),function(tt,G){"object"==typeof exports&&typeof module<"u"?G(exports):"function"==typeof define&&define.amd?define(["exports"],G):G((tt=typeof globalThis<"u"?globalThis:tt||self).inkjs={})}(this,function(tt){"use strict";function G(s){return(G="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n})(s)}function S(s,n){if(!(s instanceof n))throw new TypeError("Cannot call a class as a function")}function Jt(s,n){for(var r=0;r<n.length;r++){var t=n[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(s,t.key,t)}}function C(s,n,r){return n&&Jt(s.prototype,n),r&&Jt(s,r),Object.defineProperty(s,"prototype",{writable:!1}),s}function B(s,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");s.prototype=Object.create(n&&n.prototype,{constructor:{value:s,writable:!0,configurable:!0}}),Object.defineProperty(s,"prototype",{writable:!1}),n&&pt(s,n)}function ct(s){return(ct=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)})(s)}function pt(s,n){return(pt=Object.setPrototypeOf||function(r,t){return r.__proto__=t,r})(s,n)}function ot(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Et(s,n,r){return(Et=ot()?Reflect.construct:function(t,e,i){var a=[null];a.push.apply(a,e);var o=new(Function.bind.apply(t,a));return i&&pt(o,i.prototype),o}).apply(null,arguments)}function et(s){var n="function"==typeof Map?new Map:void 0;return(et=function(r){if(null===r||-1===Function.toString.call(r).indexOf("[native code]"))return r;if("function"!=typeof r)throw new TypeError("Super expression must either be null or a function");if(void 0!==n){if(n.has(r))return n.get(r);n.set(r,e)}function e(){return Et(r,arguments,ct(this).constructor)}return e.prototype=Object.create(r.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),pt(e,r)})(s)}function it(s,n){if(n&&("object"==typeof n||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");return function(r){if(void 0===r)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}(s)}function M(s){var n=ot();return function(){var r,t=ct(s);if(n){var e=ct(this).constructor;r=Reflect.construct(t,arguments,e)}else r=t.apply(this,arguments);return it(this,r)}}function w(s,n){return function(r){if(Array.isArray(r))return r}(s)||function(r,t){var e=null==r?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(null!=e){var i,a,o=[],u=!0,l=!1;try{for(e=e.call(r);!(u=(i=e.next()).done)&&(o.push(i.value),!t||o.length!==t);u=!0);}catch(h){l=!0,a=h}finally{try{u||null==e.return||e.return()}finally{if(l)throw a}}return o}}(s,n)||vt(s,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function nt(s){return function(n){if(Array.isArray(n))return Ct(n)}(s)||function(n){if(typeof Symbol<"u"&&null!=n[Symbol.iterator]||null!=n["@@iterator"])return Array.from(n)}(s)||vt(s)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function vt(s,n){if(s){if("string"==typeof s)return Ct(s,n);var r=Object.prototype.toString.call(s).slice(8,-1);return"Object"===r&&s.constructor&&(r=s.constructor.name),"Map"===r||"Set"===r?Array.from(s):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Ct(s,n):void 0}}function Ct(s,n){(null==n||n>s.length)&&(n=s.length);for(var r=0,t=new Array(n);r<n;r++)t[r]=s[r];return t}function d(s,n){var r=typeof Symbol<"u"&&s[Symbol.iterator]||s["@@iterator"];if(!r){if(Array.isArray(s)||(r=vt(s))||n&&s&&"number"==typeof s.length){r&&(s=r);var t=0,e=function(){};return{s:e,n:function(){return t>=s.length?{done:!0}:{done:!1,value:s[t++]}},e:function(u){throw u},f:e}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,o=!1;return{s:function(){r=r.call(s)},n:function(){var u=r.next();return a=u.done,u},e:function(u){o=!0,i=u},f:function(){try{a||null==r.return||r.return()}finally{if(o)throw i}}}}var Z,s,n,V=function(){function s(){if(S(this,s),this._components=[],this._componentsString=null,this._isRelative=!1,"string"==typeof arguments[0])this.componentsString=arguments[0];else if(arguments[0]instanceof s.Component&&arguments[1]instanceof s){var t=arguments[1];this._components.push(arguments[0]),this._components=this._components.concat(t._components)}else if(arguments[0]instanceof Array){var i=!!arguments[1];this._components=this._components.concat(arguments[0]),this._isRelative=i}}return C(s,[{key:"isRelative",get:function(){return this._isRelative}},{key:"componentCount",get:function(){return this._components.length}},{key:"head",get:function(){return this._components.length>0?this._components[0]:null}},{key:"tail",get:function(){return this._components.length>=2?new s(this._components.slice(1,this._components.length)):s.self}},{key:"length",get:function(){return this._components.length}},{key:"lastComponent",get:function(){var n=this._components.length-1;return n>=0?this._components[n]:null}},{key:"containsNamedComponent",get:function(){for(var n=0,r=this._components.length;n<r;n++)if(!this._components[n].isIndex)return!0;return!1}},{key:"GetComponent",value:function(n){return this._components[n]}},{key:"PathByAppendingPath",value:function(n){for(var r=new s,t=0,e=0;e<n._components.length&&n._components[e].isParent;++e)t++;for(var i=0;i<this._components.length-t;++i)r._components.push(this._components[i]);for(var a=t;a<n._components.length;++a)r._components.push(n._components[a]);return r}},{key:"componentsString",get:function(){return null==this._componentsString&&(this._componentsString=this._components.join("."),this.isRelative&&(this._componentsString="."+this._componentsString)),this._componentsString},set:function(n){if(this._components.length=0,this._componentsString=n,null!=this._componentsString&&""!=this._componentsString){"."==this._componentsString[0]&&(this._isRelative=!0,this._componentsString=this._componentsString.substring(1));var r,t=d(this._componentsString.split("."));try{for(t.s();!(r=t.n()).done;){var e=r.value;/^(\-|\+)?([0-9]+|Infinity)$/.test(e)?this._components.push(new s.Component(parseInt(e))):this._components.push(new s.Component(e))}}catch(i){t.e(i)}finally{t.f()}}}},{key:"toString",value:function(){return this.componentsString}},{key:"Equals",value:function(n){if(null==n||n._components.length!=this._components.length||n.isRelative!=this.isRelative)return!1;for(var r=0,t=n._components.length;r<t;r++)if(!n._components[r].Equals(this._components[r]))return!1;return!0}},{key:"PathByAppendingComponent",value:function(n){var r,t=new s;return(r=t._components).push.apply(r,nt(this._components)),t._components.push(n),t}}],[{key:"self",get:function(){var n=new s;return n._isRelative=!0,n}}]),s}();function p(s,n){return s instanceof n?D(s):null}function I(s,n){if(s instanceof n)return D(s);throw new Error("".concat(s," is not of type ").concat(n))}function yt(s){return s.hasValidName&&s.name?s:null}function bt(s){return void 0===s?null:s}function L(s){return"object"===G(s)&&"function"==typeof s.Equals}function D(s,n){return s}V.parentId="^",s=V||(V={}),n=function(){function r(t){S(this,r),this.index=-1,this.name=null,"string"==typeof t?this.name=t:this.index=t}return C(r,[{key:"isIndex",get:function(){return this.index>=0}},{key:"isParent",get:function(){return this.name==s.parentId}},{key:"toString",value:function(){return this.isIndex?this.index.toString():this.name}},{key:"Equals",value:function(t){return null!=t&&t.isIndex==this.isIndex&&(this.isIndex?this.index==t.index:this.name==t.name)}}],[{key:"ToParent",value:function(){return new r(s.parentId)}}]),r}(),s.Component=n,function(s){function n(r,t){if(!r)throw void 0!==t&&console.warn(t),console.trace&&console.trace(),new Error("")}s.AssertType=function(r,t,e){n(r instanceof t,e)},s.Assert=n}(Z||(Z={}));var q=function(s){B(r,s);var n=M(r);function r(){return S(this,r),n.apply(this,arguments)}return C(r)}(et(Error));function c(s){throw new q("".concat(s," is null or undefined"))}var F=function(){function s(){S(this,s),this.parent=null,this._debugMetadata=null,this._path=null}return C(s,[{key:"debugMetadata",get:function(){return null===this._debugMetadata&&this.parent?this.parent.debugMetadata:this._debugMetadata},set:function(n){this._debugMetadata=n}},{key:"ownDebugMetadata",get:function(){return this._debugMetadata}},{key:"DebugLineNumberOfPath",value:function(n){if(null===n)return null;var r=this.rootContentContainer;if(r){var t=r.ContentAtPath(n).obj;if(t){var e=t.debugMetadata;if(null!==e)return e.startLineNumber}}return null}},{key:"path",get:function(){if(null==this._path)if(null==this.parent)this._path=new V;else{for(var n=[],r=this,t=p(r.parent,R);null!==t;){var e=yt(r);if(null!=e&&e.hasValidName){if(null===e.name)return c("namedChild.name");n.unshift(new V.Component(e.name))}else n.unshift(new V.Component(t.content.indexOf(r)));r=t,t=p(t.parent,R)}this._path=new V(n)}return this._path}},{key:"ResolvePath",value:function(n){if(null===n)return c("path");if(n.isRelative){var r=p(this,R);return null===r&&(Z.Assert(null!==this.parent,"Can't resolve relative path because we don't have a parent"),r=p(this.parent,R),Z.Assert(null!==r,"Expected parent to be a container"),Z.Assert(n.GetComponent(0).isParent),n=n.tail),null===r?c("nearestContainer"):r.ContentAtPath(n)}var t=this.rootContentContainer;return null===t?c("contentContainer"):t.ContentAtPath(n)}},{key:"ConvertPathToRelative",value:function(n){for(var r=this.path,t=Math.min(n.length,r.length),e=-1,i=0;i<t;++i){var a=r.GetComponent(i),o=n.GetComponent(i);if(!a.Equals(o))break;e=i}if(-1==e)return n;for(var u=r.componentCount-1-e,l=[],h=0;h<u;++h)l.push(V.Component.ToParent());for(var f=e+1;f<n.componentCount;++f)l.push(n.GetComponent(f));return new V(l,!0)}},{key:"CompactPathString",value:function(n){var r=null,t=null;return n.isRelative?(t=n.componentsString,r=this.path.PathByAppendingPath(n).componentsString):(t=this.ConvertPathToRelative(n).componentsString,r=n.componentsString),t.length<r.length?t:r}},{key:"rootContentContainer",get:function(){for(var n=this;n.parent;)n=n.parent;return p(n,R)}},{key:"Copy",value:function(){throw Error("Not Implemented: Doesn't support copying")}},{key:"SetChild",value:function(n,r,t){n[r]&&(n[r]=null),n[r]=t,n[r]&&(n[r].parent=this)}},{key:"Equals",value:function(n){return n===this}}]),s}(),X=function(){function s(n){S(this,s),n=void 0!==n?n.toString():"",this.string=n}return C(s,[{key:"Length",get:function(){return this.string.length}},{key:"Append",value:function(n){null!==n&&(this.string+=n)}},{key:"AppendLine",value:function(n){void 0!==n&&this.Append(n),this.string+="\n"}},{key:"AppendFormat",value:function(n){for(var r=arguments.length,t=new Array(r>1?r-1:0),e=1;e<r;e++)t[e-1]=arguments[e];this.string+=n.replace(/{(\d+)}/g,function(i,a){return void 0!==t[a]?t[a]:i})}},{key:"toString",value:function(){return this.string}}]),s}(),A=function(){function s(){if(S(this,s),this.originName=null,this.itemName=null,void 0!==arguments[1]){var r=arguments[1];this.originName=arguments[0],this.itemName=r}else if(arguments[0]){var e=arguments[0].toString().split(".");this.originName=e[0],this.itemName=e[1]}}return C(s,[{key:"isNull",get:function(){return null==this.originName&&null==this.itemName}},{key:"fullName",get:function(){return(null!==this.originName?this.originName:"?")+"."+this.itemName}},{key:"toString",value:function(){return this.fullName}},{key:"Equals",value:function(n){return n instanceof s&&(n.itemName==this.itemName&&n.originName==this.originName)}},{key:"copy",value:function(){return new s(this.originName,this.itemName)}},{key:"serialized",value:function(){return JSON.stringify({originName:this.originName,itemName:this.itemName})}}],[{key:"Null",get:function(){return new s(null,null)}},{key:"fromSerializedKey",value:function(n){var r=JSON.parse(n);return s.isLikeInkListItem(r)?new s(r.originName,r.itemName):s.Null}},{key:"isLikeInkListItem",value:function(n){return!("object"!==G(n)||!n.hasOwnProperty("originName")||!n.hasOwnProperty("itemName")||"string"!=typeof n.originName&&null!==typeof n.originName||"string"!=typeof n.itemName&&null!==typeof n.itemName)}}]),s}(),J=function(s){B(r,s);var n=M(r);function r(){var t,e=arguments;if(S(this,r),(t=n.call(this,e[0]instanceof r?e[0]:[])).origins=null,t._originNames=[],arguments[0]instanceof r){var i=arguments[0];t._originNames=i.originNames,null!==i.origins&&(t.origins=i.origins.slice())}else if("string"==typeof arguments[0]){var a=arguments[0],o=arguments[1];if(t.SetInitialOriginName(a),null===o.listDefinitions)return it(t,c("originStory.listDefinitions"));var u=o.listDefinitions.TryListGetDefinition(a,null);if(!u.exists)throw new Error("InkList origin could not be found in story when constructing new list: "+a);if(null===u.result)return it(t,c("def.result"));t.origins=[u.result]}else if("object"===G(arguments[0])&&arguments[0].hasOwnProperty("Key")&&arguments[0].hasOwnProperty("Value")){var l=arguments[0];t.Add(l.Key,l.Value)}return t}return C(r,[{key:"AddItem",value:function(t){if(t instanceof A){var e=t;if(null==e.originName)return void this.AddItem(e.itemName);if(null===this.origins)return c("this.origins");var i,a=d(this.origins);try{for(a.s();!(i=a.n()).done;){var o=i.value;if(o.name==e.originName){var u=o.TryGetValueForItem(e,0);if(u.exists)return void this.Add(e,u.result);throw new Error("Could not add the item "+e+" to this list because it doesn't exist in the original list definition in ink.")}}}catch(b){a.e(b)}finally{a.f()}throw new Error("Failed to add item to list because the item was from a new list definition that wasn't previously known to this list. Only items from previously known lists can be used, so that the int value can be found.")}var l=t,h=null;if(null===this.origins)return c("this.origins");var f,v=d(this.origins);try{for(v.s();!(f=v.n()).done;){var k=f.value;if(null===l)return c("itemName");if(k.ContainsItemWithName(l)){if(null!=h)throw new Error("Could not add the item "+l+" to this list because it could come from either "+k.name+" or "+h.name);h=k}}}catch(b){v.e(b)}finally{v.f()}if(null==h)throw new Error("Could not add the item "+l+" to this list because it isn't known to any list definitions previously associated with this list.");var g=new A(h.name,l),_=h.ValueForItem(g);this.Add(g,_)}},{key:"ContainsItemNamed",value:function(t){var e,i=d(this);try{for(i.s();!(e=i.n()).done;){var a=w(e.value,1)[0];if(A.fromSerializedKey(a).itemName==t)return!0}}catch(o){i.e(o)}finally{i.f()}return!1}},{key:"ContainsKey",value:function(t){return this.has(t.serialized())}},{key:"Add",value:function(t,e){var i=t.serialized();if(this.has(i))throw new Error("The Map already contains an entry for ".concat(t));this.set(i,e)}},{key:"Remove",value:function(t){return this.delete(t.serialized())}},{key:"Count",get:function(){return this.size}},{key:"originOfMaxItem",get:function(){if(null==this.origins)return null;var t=this.maxItem.Key.originName,e=null;return this.origins.every(function(i){return i.name!=t||(e=i,!1)}),e}},{key:"originNames",get:function(){if(this.Count>0){null==this._originNames&&this.Count>0?this._originNames=[]:(this._originNames||(this._originNames=[]),this._originNames.length=0);var t,e=d(this);try{for(e.s();!(t=e.n()).done;){var i=w(t.value,1)[0],a=A.fromSerializedKey(i);if(null===a.originName)return c("item.originName");this._originNames.push(a.originName)}}catch(o){e.e(o)}finally{e.f()}}return this._originNames}},{key:"SetInitialOriginName",value:function(t){this._originNames=[t]}},{key:"SetInitialOriginNames",value:function(t){this._originNames=null==t?null:t.slice()}},{key:"maxItem",get:function(){var t,e={Key:A.Null,Value:0},i=d(this);try{for(i.s();!(t=i.n()).done;){var a=w(t.value,2),u=a[1],l=A.fromSerializedKey(a[0]);(e.Key.isNull||u>e.Value)&&(e={Key:l,Value:u})}}catch(h){i.e(h)}finally{i.f()}return e}},{key:"minItem",get:function(){var t,e={Key:A.Null,Value:0},i=d(this);try{for(i.s();!(t=i.n()).done;){var a=w(t.value,2),u=a[1],l=A.fromSerializedKey(a[0]);(e.Key.isNull||u<e.Value)&&(e={Key:l,Value:u})}}catch(h){i.e(h)}finally{i.f()}return e}},{key:"inverse",get:function(){var t=new r;if(null!=this.origins){var e,i=d(this.origins);try{for(i.s();!(e=i.n()).done;){var a,o=d(e.value.items);try{for(o.s();!(a=o.n()).done;){var u=w(a.value,2),h=u[1],f=A.fromSerializedKey(u[0]);this.ContainsKey(f)||t.Add(f,h)}}catch(v){o.e(v)}finally{o.f()}}}catch(v){i.e(v)}finally{i.f()}}return t}},{key:"all",get:function(){var t=new r;if(null!=this.origins){var e,i=d(this.origins);try{for(i.s();!(e=i.n()).done;){var a,o=d(e.value.items);try{for(o.s();!(a=o.n()).done;){var u=w(a.value,2),h=u[1],f=A.fromSerializedKey(u[0]);t.set(f.serialized(),h)}}catch(v){o.e(v)}finally{o.f()}}}catch(v){i.e(v)}finally{i.f()}}return t}},{key:"Union",value:function(t){var e,i=new r(this),a=d(t);try{for(a.s();!(e=a.n()).done;){var o=w(e.value,2);i.set(o[0],o[1])}}catch(h){a.e(h)}finally{a.f()}return i}},{key:"Intersect",value:function(t){var e,i=new r,a=d(this);try{for(a.s();!(e=a.n()).done;){var o=w(e.value,2),u=o[0],l=o[1];t.has(u)&&i.set(u,l)}}catch(h){a.e(h)}finally{a.f()}return i}},{key:"Without",value:function(t){var e,i=new r(this),a=d(t);try{for(a.s();!(e=a.n()).done;){var o=w(e.value,1)[0];i.delete(o)}}catch(u){a.e(u)}finally{a.f()}return i}},{key:"Contains",value:function(t){var e,i=d(t);try{for(i.s();!(e=i.n()).done;){var a=w(e.value,1)[0];if(!this.has(a))return!1}}catch(o){i.e(o)}finally{i.f()}return!0}},{key:"GreaterThan",value:function(t){return 0!=this.Count&&(0==t.Count||this.minItem.Value>t.maxItem.Value)}},{key:"GreaterThanOrEquals",value:function(t){return 0!=this.Count&&(0==t.Count||this.minItem.Value>=t.minItem.Value&&this.maxItem.Value>=t.maxItem.Value)}},{key:"LessThan",value:function(t){return 0!=t.Count&&(0==this.Count||this.maxItem.Value<t.minItem.Value)}},{key:"LessThanOrEquals",value:function(t){return 0!=t.Count&&(0==this.Count||this.maxItem.Value<=t.maxItem.Value&&this.minItem.Value<=t.minItem.Value)}},{key:"MaxAsList",value:function(){return this.Count>0?new r(this.maxItem):new r}},{key:"MinAsList",value:function(){return this.Count>0?new r(this.minItem):new r}},{key:"ListWithSubRange",value:function(t,e){if(0==this.Count)return new r;var i=this.orderedItems,a=0,o=Number.MAX_SAFE_INTEGER;Number.isInteger(t)?a=t:t instanceof r&&t.Count>0&&(a=t.minItem.Value),Number.isInteger(e)?o=e:t instanceof r&&t.Count>0&&(o=e.maxItem.Value);var u=new r;u.SetInitialOriginNames(this.originNames);var l,h=d(i);try{for(h.s();!(l=h.n()).done;){var f=l.value;f.Value>=a&&f.Value<=o&&u.Add(f.Key,f.Value)}}catch(v){h.e(v)}finally{h.f()}return u}},{key:"Equals",value:function(t){if(!(t instanceof r)||t.Count!=this.Count)return!1;var e,i=d(this);try{for(i.s();!(e=i.n()).done;){var a=w(e.value,1)[0];if(!t.has(a))return!1}}catch(o){i.e(o)}finally{i.f()}return!0}},{key:"orderedItems",get:function(){var t,e=new Array,i=d(this);try{for(i.s();!(t=i.n()).done;){var a=w(t.value,2),u=a[1],l=A.fromSerializedKey(a[0]);e.push({Key:l,Value:u})}}catch(h){i.e(h)}finally{i.f()}return e.sort(function(h,f){return null===h.Key.originName?c("x.Key.originName"):null===f.Key.originName?c("y.Key.originName"):h.Value==f.Value?h.Key.originName.localeCompare(f.Key.originName):h.Value<f.Value?-1:h.Value>f.Value?1:0}),e}},{key:"toString",value:function(){for(var t=this.orderedItems,e=new X,i=0;i<t.length;i++){i>0&&e.Append(", ");var a=t[i].Key;if(null===a.itemName)return c("item.itemName");e.Append(a.itemName)}return e.toString()}},{key:"valueOf",value:function(){return NaN}}],[{key:"FromString",value:function(t,e){var i,a=null===(i=e.listDefinitions)||void 0===i?void 0:i.FindSingleItemListWithName(t);if(a)return null===a.value?c("listValue.value"):new r(a.value);throw new Error("Could not find the InkListItem from the string '"+t+"' to create an InkList because it doesn't exist in the original list definition in ink.")}}]),r}(et(Map)),K=function(s){B(r,s);var n=M(r);function r(t){var e;return S(this,r),(e=n.call(this,t)).useEndLineNumber=!1,e.message=t,e.name="StoryException",e}return C(r)}(et(Error));function T(s,n,r){if(null===s)return{result:r,exists:!1};var t=s.get(n);return void 0===t?{result:r,exists:!1}:{result:t,exists:!0}}var m,P=function(s){B(r,s);var n=M(r);function r(t){var e;return S(this,r),(e=n.call(this)).value=t,e}return C(r,[{key:"valueObject",get:function(){return this.value}},{key:"toString",value:function(){return null===this.value?c("Value.value"):this.value.toString()}}]),r}(function(s){B(r,s);var n=M(r);function r(){return S(this,r),n.apply(this,arguments)}return C(r,[{key:"Copy",value:function(){return I(r.Create(this.valueObject),F)}},{key:"BadCastException",value:function(t){return new K("Can't cast "+this.valueObject+" from "+this.valueType+" to "+t)}}],[{key:"Create",value:function(t,e){if(e){if(e===m.Int&&Number.isInteger(Number(t)))return new E(Number(t));if(e===m.Float&&!isNaN(t))return new rt(Number(t))}return"boolean"==typeof t?new at(!!t):"string"==typeof t?new W(String(t)):Number.isInteger(Number(t))?new E(Number(t)):isNaN(t)?t instanceof V?new ut(I(t,V)):t instanceof J?new Y(I(t,J)):null:new rt(Number(t))}}]),r}(F)),at=function(s){B(r,s);var n=M(r);function r(t){return S(this,r),n.call(this,t||!1)}return C(r,[{key:"isTruthy",get:function(){return!!this.value}},{key:"valueType",get:function(){return m.Bool}},{key:"Cast",value:function(t){if(null===this.value)return c("Value.value");if(t==this.valueType)return this;if(t==m.Int)return new E(this.value?1:0);if(t==m.Float)return new rt(this.value?1:0);if(t==m.String)return new W(this.value?"true":"false");throw this.BadCastException(t)}},{key:"toString",value:function(){return this.value?"true":"false"}}]),r}(P),E=function(s){B(r,s);var n=M(r);function r(t){return S(this,r),n.call(this,t||0)}return C(r,[{key:"isTruthy",get:function(){return 0!=this.value}},{key:"valueType",get:function(){return m.Int}},{key:"Cast",value:function(t){if(null===this.value)return c("Value.value");if(t==this.valueType)return this;if(t==m.Bool)return new at(0!==this.value);if(t==m.Float)return new rt(this.value);if(t==m.String)return new W(""+this.value);throw this.BadCastException(t)}}]),r}(P),rt=function(s){B(r,s);var n=M(r);function r(t){return S(this,r),n.call(this,t||0)}return C(r,[{key:"isTruthy",get:function(){return 0!=this.value}},{key:"valueType",get:function(){return m.Float}},{key:"Cast",value:function(t){if(null===this.value)return c("Value.value");if(t==this.valueType)return this;if(t==m.Bool)return new at(0!==this.value);if(t==m.Int)return new E(this.value);if(t==m.String)return new W(""+this.value);throw this.BadCastException(t)}}]),r}(P),W=function(s){B(r,s);var n=M(r);function r(t){var e;return S(this,r),(e=n.call(this,t||""))._isNewline="\n"==e.value,e._isInlineWhitespace=!0,null===e.value?it(e,c("Value.value")):(e.value.length>0&&e.value.split("").every(function(i){return" "==i||"\t"==i||(e._isInlineWhitespace=!1,!1)}),e)}return C(r,[{key:"valueType",get:function(){return m.String}},{key:"isTruthy",get:function(){return null===this.value?c("Value.value"):this.value.length>0}},{key:"isNewline",get:function(){return this._isNewline}},{key:"isInlineWhitespace",get:function(){return this._isInlineWhitespace}},{key:"isNonWhitespace",get:function(){return!this.isNewline&&!this.isInlineWhitespace}},{key:"Cast",value:function(t){if(t==this.valueType)return this;if(t==m.Int){var e=function(a){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,u=parseInt(a);return Number.isNaN(u)?{result:o,exists:!1}:{result:u,exists:!0}}(this.value);if(e.exists)return new E(e.result);throw this.BadCastException(t)}if(t==m.Float){var i=function(a){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,u=parseFloat(a);return Number.isNaN(u)?{result:o,exists:!1}:{result:u,exists:!0}}(this.value);if(i.exists)return new rt(i.result);throw this.BadCastException(t)}throw this.BadCastException(t)}}]),r}(P),ut=function(s){B(r,s);var n=M(r);function r(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return S(this,r),n.call(this,t)}return C(r,[{key:"valueType",get:function(){return m.DivertTarget}},{key:"targetPath",get:function(){return null===this.value?c("Value.value"):this.value},set:function(t){this.value=t}},{key:"isTruthy",get:function(){throw new Error("Shouldn't be checking the truthiness of a divert target")}},{key:"Cast",value:function(t){if(t==this.valueType)return this;throw this.BadCastException(t)}},{key:"toString",value:function(){return"DivertTargetValue("+this.targetPath+")"}}]),r}(P),lt=function(s){B(r,s);var n=M(r);function r(t){var e,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;return S(this,r),(e=n.call(this,t))._contextIndex=i,e}return C(r,[{key:"contextIndex",get:function(){return this._contextIndex},set:function(t){this._contextIndex=t}},{key:"variableName",get:function(){return null===this.value?c("Value.value"):this.value},set:function(t){this.value=t}},{key:"valueType",get:function(){return m.VariablePointer}},{key:"isTruthy",get:function(){throw new Error("Shouldn't be checking the truthiness of a variable pointer")}},{key:"Cast",value:function(t){if(t==this.valueType)return this;throw this.BadCastException(t)}},{key:"toString",value:function(){return"VariablePointerValue("+this.variableName+")"}},{key:"Copy",value:function(){return new r(this.variableName,this.contextIndex)}}]),r}(P),Y=function(s){B(r,s);var n=M(r);function r(t,e){var i;return S(this,r),i=n.call(this,null),t||e?t instanceof J?i.value=new J(t):t instanceof A&&"number"==typeof e&&(i.value=new J({Key:t,Value:e})):i.value=new J,i}return C(r,[{key:"isTruthy",get:function(){return null===this.value?c("this.value"):this.value.Count>0}},{key:"valueType",get:function(){return m.List}},{key:"Cast",value:function(t){if(null===this.value)return c("Value.value");if(t==m.Int){var e=this.value.maxItem;return new E(e.Key.isNull?0:e.Value)}if(t==m.Float){var i=this.value.maxItem;return new rt(i.Key.isNull?0:i.Value)}if(t==m.String){var a=this.value.maxItem;return new W(a.Key.isNull?"":a.Key.toString())}if(t==this.valueType)return this;throw this.BadCastException(t)}}],[{key:"RetainListOriginsForAssignment",value:function(t,e){var i=p(t,r),a=p(e,r);return a&&null===a.value?c("newList.value"):i&&null===i.value?c("oldList.value"):void(i&&a&&0==a.value.Count&&a.value.SetInitialOriginNames(i.value.originNames))}}]),r}(P);!function(s){s[s.Bool=-1]="Bool",s[s.Int=0]="Int",s[s.Float=1]="Float",s[s.List=2]="List",s[s.String=3]="String",s[s.DivertTarget=4]="DivertTarget",s[s.VariablePointer=5]="VariablePointer"}(m||(m={}));var pe=function(){function s(){S(this,s),this.obj=null,this.approximate=!1}return C(s,[{key:"correctObj",get:function(){return this.approximate?null:this.obj}},{key:"container",get:function(){return this.obj instanceof R?this.obj:null}},{key:"copy",value:function(){var n=new s;return n.obj=this.obj,n.approximate=this.approximate,n}}]),s}(),R=function(s){B(r,s);var n=M(r);function r(){var t;return S(this,r),(t=n.apply(this,arguments)).name=null,t._content=[],t.namedContent=new Map,t.visitsShouldBeCounted=!1,t.turnIndexShouldBeCounted=!1,t.countingAtStartOnly=!1,t._pathToFirstLeafContent=null,t}return C(r,[{key:"hasValidName",get:function(){return null!=this.name&&this.name.length>0}},{key:"content",get:function(){return this._content},set:function(t){this.AddContent(t)}},{key:"namedOnlyContent",get:function(){var t,e=new Map,i=d(this.namedContent);try{for(i.s();!(t=i.n()).done;){var a=w(t.value,2),o=a[0],u=I(a[1],F);e.set(o,u)}}catch(v){i.e(v)}finally{i.f()}var l,h=d(this.content);try{for(h.s();!(l=h.n()).done;){var f=yt(l.value);null!=f&&f.hasValidName&&e.delete(f.name)}}catch(v){h.e(v)}finally{h.f()}return 0==e.size&&(e=null),e},set:function(t){var e=this.namedOnlyContent;if(null!=e){var i,a=d(e);try{for(a.s();!(i=a.n()).done;){var o=w(i.value,1)[0];this.namedContent.delete(o)}}catch(f){a.e(f)}finally{a.f()}}if(null!=t){var u,l=d(t);try{for(l.s();!(u=l.n()).done;){var h=yt(w(u.value,2)[1]);null!=h&&this.AddToNamedContentOnly(h)}}catch(f){l.e(f)}finally{l.f()}}}},{key:"countFlags",get:function(){var t=0;return this.visitsShouldBeCounted&&(t|=r.CountFlags.Visits),this.turnIndexShouldBeCounted&&(t|=r.CountFlags.Turns),this.countingAtStartOnly&&(t|=r.CountFlags.CountStartOnly),t==r.CountFlags.CountStartOnly&&(t=0),t},set:function(t){var e=t;(e&r.CountFlags.Visits)>0&&(this.visitsShouldBeCounted=!0),(e&r.CountFlags.Turns)>0&&(this.turnIndexShouldBeCounted=!0),(e&r.CountFlags.CountStartOnly)>0&&(this.countingAtStartOnly=!0)}},{key:"pathToFirstLeafContent",get:function(){return null==this._pathToFirstLeafContent&&(this._pathToFirstLeafContent=this.path.PathByAppendingPath(this.internalPathToFirstLeafContent)),this._pathToFirstLeafContent}},{key:"internalPathToFirstLeafContent",get:function(){for(var t=[],e=this;e instanceof r;)e.content.length>0&&(t.push(new V.Component(0)),e=e.content[0]);return new V(t)}},{key:"AddContent",value:function(t){if(t instanceof Array){var e,i=d(t);try{for(i.s();!(e=i.n()).done;)this.AddContent(e.value)}catch(u){i.e(u)}finally{i.f()}}else{var o=t;if(this._content.push(o),o.parent)throw new Error("content is already in "+o.parent);o.parent=this,this.TryAddNamedContent(o)}}},{key:"TryAddNamedContent",value:function(t){var e=yt(t);null!=e&&e.hasValidName&&this.AddToNamedContentOnly(e)}},{key:"AddToNamedContentOnly",value:function(t){if(Z.AssertType(t,F,"Can only add Runtime.Objects to a Runtime.Container"),I(t,F).parent=this,null===t.name)return c("namedContentObj.name");this.namedContent.set(t.name,t)}},{key:"ContentAtPath",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;-1==i&&(i=t.length);var a=new pe;a.approximate=!1;for(var o=this,u=this,l=e;l<i;++l){var h=t.GetComponent(l);if(null==o){a.approximate=!0;break}var f=o.ContentWithPathComponent(h);if(null==f){a.approximate=!0;break}u=f,o=p(f,r)}return a.obj=u,a}},{key:"InsertContent",value:function(t,e){if(this.content.splice(e,0,t),t.parent)throw new Error("content is already in "+t.parent);t.parent=this,this.TryAddNamedContent(t)}},{key:"AddContentsOfContainer",value:function(t){var e;(e=this.content).push.apply(e,nt(t.content));var i,a=d(t.content);try{for(a.s();!(i=a.n()).done;){var o=i.value;o.parent=this,this.TryAddNamedContent(o)}}catch(u){a.e(u)}finally{a.f()}}},{key:"ContentWithPathComponent",value:function(t){if(t.isIndex)return t.index>=0&&t.index<this.content.length?this.content[t.index]:null;if(t.isParent)return this.parent;if(null===t.name)return c("component.name");var e=T(this.namedContent,t.name,null);return e.exists?I(e.result,F):null}},{key:"BuildStringOfHierarchy",value:function(){var t;if(0==arguments.length)return t=new X,this.BuildStringOfHierarchy(t,0,null),t.toString();t=arguments[0];var e=arguments[1],i=arguments[2];function a(){for(var U=0;U<4*e;++U)t.Append(" ")}a(),t.Append("["),this.hasValidName&&t.AppendFormat(" ({0})",this.name),this==i&&t.Append("  <---"),t.AppendLine(),e++;for(var o=0;o<this.content.length;++o){var u=this.content[o];u instanceof r?u.BuildStringOfHierarchy(t,e,i):(a(),u instanceof W?(t.Append('"'),t.Append(u.toString().replace("\n","\\n")),t.Append('"')):t.Append(u.toString())),o!=this.content.length-1&&t.Append(","),u instanceof r||u!=i||t.Append("  <---"),t.AppendLine()}var h,f=new Map,v=d(this.namedContent);try{for(v.s();!(h=v.n()).done;){var k=w(h.value,2),g=k[0],_=k[1];this.content.indexOf(I(_,F))>=0||f.set(g,_)}}catch(U){v.e(U)}finally{v.f()}if(f.size>0){a(),t.AppendLine("-- named: --");var b,O=d(f);try{for(O.s();!(b=O.n()).done;){var H=w(b.value,2)[1];Z.AssertType(H,r,"Can only print out named Containers"),H.BuildStringOfHierarchy(t,e,i),t.AppendLine()}}catch(U){O.e(U)}finally{O.f()}}e--,a(),t.Append("]")}}]),r}(F);!function(s){var n;(n=s.CountFlags||(s.CountFlags={}))[n.Visits=1]="Visits",n[n.Turns=2]="Turns",n[n.CountStartOnly=4]="CountStartOnly"}(R||(R={}));var x,_t=function(s){B(r,s);var n=M(r);function r(){return S(this,r),n.apply(this,arguments)}return C(r,[{key:"toString",value:function(){return"Glue"}}]),r}(F),y=function(s){B(r,s);var n=M(r);function r(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r.CommandType.NotSet;return S(this,r),(t=n.call(this))._commandType=e,t}return C(r,[{key:"commandType",get:function(){return this._commandType}},{key:"Copy",value:function(){return new r(this.commandType)}},{key:"toString",value:function(){return this.commandType.toString()}}],[{key:"EvalStart",value:function(){return new r(r.CommandType.EvalStart)}},{key:"EvalOutput",value:function(){return new r(r.CommandType.EvalOutput)}},{key:"EvalEnd",value:function(){return new r(r.CommandType.EvalEnd)}},{key:"Duplicate",value:function(){return new r(r.CommandType.Duplicate)}},{key:"PopEvaluatedValue",value:function(){return new r(r.CommandType.PopEvaluatedValue)}},{key:"PopFunction",value:function(){return new r(r.CommandType.PopFunction)}},{key:"PopTunnel",value:function(){return new r(r.CommandType.PopTunnel)}},{key:"BeginString",value:function(){return new r(r.CommandType.BeginString)}},{key:"EndString",value:function(){return new r(r.CommandType.EndString)}},{key:"NoOp",value:function(){return new r(r.CommandType.NoOp)}},{key:"ChoiceCount",value:function(){return new r(r.CommandType.ChoiceCount)}},{key:"Turns",value:function(){return new r(r.CommandType.Turns)}},{key:"TurnsSince",value:function(){return new r(r.CommandType.TurnsSince)}},{key:"ReadCount",value:function(){return new r(r.CommandType.ReadCount)}},{key:"Random",value:function(){return new r(r.CommandType.Random)}},{key:"SeedRandom",value:function(){return new r(r.CommandType.SeedRandom)}},{key:"VisitIndex",value:function(){return new r(r.CommandType.VisitIndex)}},{key:"SequenceShuffleIndex",value:function(){return new r(r.CommandType.SequenceShuffleIndex)}},{key:"StartThread",value:function(){return new r(r.CommandType.StartThread)}},{key:"Done",value:function(){return new r(r.CommandType.Done)}},{key:"End",value:function(){return new r(r.CommandType.End)}},{key:"ListFromInt",value:function(){return new r(r.CommandType.ListFromInt)}},{key:"ListRange",value:function(){return new r(r.CommandType.ListRange)}},{key:"ListRandom",value:function(){return new r(r.CommandType.ListRandom)}}]),r}(F);(function(s){var n;(n=s.CommandType||(s.CommandType={}))[n.NotSet=-1]="NotSet",n[n.EvalStart=0]="EvalStart",n[n.EvalOutput=1]="EvalOutput",n[n.EvalEnd=2]="EvalEnd",n[n.Duplicate=3]="Duplicate",n[n.PopEvaluatedValue=4]="PopEvaluatedValue",n[n.PopFunction=5]="PopFunction",n[n.PopTunnel=6]="PopTunnel",n[n.BeginString=7]="BeginString",n[n.EndString=8]="EndString",n[n.NoOp=9]="NoOp",n[n.ChoiceCount=10]="ChoiceCount",n[n.Turns=11]="Turns",n[n.TurnsSince=12]="TurnsSince",n[n.Random=13]="Random",n[n.SeedRandom=14]="SeedRandom",n[n.VisitIndex=15]="VisitIndex",n[n.SequenceShuffleIndex=16]="SequenceShuffleIndex",n[n.StartThread=17]="StartThread",n[n.Done=18]="Done",n[n.End=19]="End",n[n.ListFromInt=20]="ListFromInt",n[n.ListRange=21]="ListRange",n[n.ListRandom=22]="ListRandom",n[n.ReadCount=23]="ReadCount",n[n.TOTAL_VALUES=24]="TOTAL_VALUES"})(y||(y={})),function(s){s[s.Tunnel=0]="Tunnel",s[s.Function=1]="Function",s[s.FunctionEvaluationFromGame=2]="FunctionEvaluationFromGame"}(x||(x={}));var $=function(){function s(){S(this,s),this.container=null,this.index=-1,2===arguments.length&&(this.container=arguments[0],this.index=arguments[1])}return C(s,[{key:"Resolve",value:function(){return this.index<0?this.container:null==this.container?null:0==this.container.content.length?this.container:this.index>=this.container.content.length?null:this.container.content[this.index]}},{key:"isNull",get:function(){return null==this.container}},{key:"path",get:function(){return this.isNull?null:this.index>=0?this.container.path.PathByAppendingComponent(new V.Component(this.index)):this.container.path}},{key:"toString",value:function(){return this.container?"Ink Pointer -> "+this.container.path.toString()+" -- index "+this.index:"Ink Pointer (null)"}},{key:"copy",value:function(){return new s(this.container,this.index)}}],[{key:"StartOf",value:function(n){return new s(n,0)}},{key:"Null",get:function(){return new s(null,-1)}}]),s}(),At=function(s){B(r,s);var n=M(r);function r(t){var e;return S(this,r),(e=n.call(this))._targetPath=null,e._targetPointer=$.Null,e.variableDivertName=null,e.pushesToStack=!1,e.stackPushType=0,e.isExternal=!1,e.externalArgs=0,e.isConditional=!1,e.pushesToStack=!1,void 0!==t&&(e.pushesToStack=!0,e.stackPushType=t),e}return C(r,[{key:"targetPath",get:function(){if(null!=this._targetPath&&this._targetPath.isRelative){var t=this.targetPointer.Resolve();t&&(this._targetPath=t.path)}return this._targetPath},set:function(t){this._targetPath=t,this._targetPointer=$.Null}},{key:"targetPointer",get:function(){if(this._targetPointer.isNull){var t=this.ResolvePath(this._targetPath).obj;if(null===this._targetPath)return c("this._targetPath");if(null===this._targetPath.lastComponent)return c("this._targetPath.lastComponent");if(this._targetPath.lastComponent.isIndex){if(null===t)return c("targetObj");this._targetPointer.container=t.parent instanceof R?t.parent:null,this._targetPointer.index=this._targetPath.lastComponent.index}else this._targetPointer=$.StartOf(t instanceof R?t:null)}return this._targetPointer.copy()}},{key:"targetPathString",get:function(){return null==this.targetPath?null:this.CompactPathString(this.targetPath)},set:function(t){this.targetPath=null==t?null:new V(t)}},{key:"hasVariableTarget",get:function(){return null!=this.variableDivertName}},{key:"Equals",value:function(t){var e=t;return e instanceof r&&this.hasVariableTarget==e.hasVariableTarget&&(this.hasVariableTarget?this.variableDivertName==e.variableDivertName:null===this.targetPath?c("this.targetPath"):this.targetPath.Equals(e.targetPath))}},{key:"toString",value:function(){if(this.hasVariableTarget)return"Divert(variable: "+this.variableDivertName+")";if(null==this.targetPath)return"Divert(null)";var t=new X,e=this.targetPath.toString();return t.Append("Divert"),this.isConditional&&t.Append("?"),this.pushesToStack&&t.Append(this.stackPushType==x.Function?" function":" tunnel"),t.Append(" -> "),t.Append(this.targetPathString),t.Append(" ("),t.Append(e),t.Append(")"),t.toString()}}]),r}(F),Ut=function(s){B(r,s);var n=M(r);function r(){var t,e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return S(this,r),(t=n.call(this))._pathOnChoice=null,t.hasCondition=!1,t.hasStartContent=!1,t.hasChoiceOnlyContent=!1,t.isInvisibleDefault=!1,t.onceOnly=!0,t.onceOnly=e,t}return C(r,[{key:"pathOnChoice",get:function(){if(null!=this._pathOnChoice&&this._pathOnChoice.isRelative){var t=this.choiceTarget;t&&(this._pathOnChoice=t.path)}return this._pathOnChoice},set:function(t){this._pathOnChoice=t}},{key:"choiceTarget",get:function(){return null===this._pathOnChoice?c("ChoicePoint._pathOnChoice"):this.ResolvePath(this._pathOnChoice).container}},{key:"pathStringOnChoice",get:function(){return null===this.pathOnChoice?c("ChoicePoint.pathOnChoice"):this.CompactPathString(this.pathOnChoice)},set:function(t){this.pathOnChoice=new V(t)}},{key:"flags",get:function(){var t=0;return this.hasCondition&&(t|=1),this.hasStartContent&&(t|=2),this.hasChoiceOnlyContent&&(t|=4),this.isInvisibleDefault&&(t|=8),this.onceOnly&&(t|=16),t},set:function(t){this.hasCondition=(1&t)>0,this.hasStartContent=(2&t)>0,this.hasChoiceOnlyContent=(4&t)>0,this.isInvisibleDefault=(8&t)>0,this.onceOnly=(16&t)>0}},{key:"toString",value:function(){return null===this.pathOnChoice?c("ChoicePoint.pathOnChoice"):"Choice: -> "+this.pathOnChoice.toString()}}]),r}(F),Ot=function(s){B(r,s);var n=M(r);function r(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return S(this,r),(t=n.call(this)).pathForCount=null,t.name=e,t}return C(r,[{key:"containerForCount",get:function(){return null===this.pathForCount?null:this.ResolvePath(this.pathForCount).container}},{key:"pathStringForCount",get:function(){return null===this.pathForCount?null:this.CompactPathString(this.pathForCount)},set:function(t){this.pathForCount=null===t?null:new V(t)}},{key:"toString",value:function(){return null!=this.name?"var("+this.name+")":"read_count("+this.pathStringForCount+")"}}]),r}(F),Kt=function(s){B(r,s);var n=M(r);function r(t,e){var i;return S(this,r),(i=n.call(this)).variableName=t||null,i.isNewDeclaration=!!e,i.isGlobal=!1,i}return C(r,[{key:"toString",value:function(){return"VarAssign to "+this.variableName}}]),r}(F),ht=function(s){B(r,s);var n=M(r);function r(){return S(this,r),n.apply(this,arguments)}return C(r)}(F),N=function(s){B(r,s);var n=M(r);function r(){var t;if(S(this,r),(t=n.call(this))._name=null,t._numberOfParameters=0,t._prototype=null,t._isPrototype=!1,t._operationFuncs=null,0===arguments.length)r.GenerateNativeFunctionsIfNecessary();else if(1===arguments.length){var e=arguments[0];r.GenerateNativeFunctionsIfNecessary(),t.name=e}else if(2===arguments.length){var i=arguments[0],a=arguments[1];t._isPrototype=!0,t.name=i,t.numberOfParameters=a}return t}return C(r,[{key:"name",get:function(){return null===this._name?c("NativeFunctionCall._name"):this._name},set:function(t){this._name=t,this._isPrototype||(null===r._nativeFunctions?c("NativeFunctionCall._nativeFunctions"):this._prototype=r._nativeFunctions.get(this._name)||null)}},{key:"numberOfParameters",get:function(){return this._prototype?this._prototype.numberOfParameters:this._numberOfParameters},set:function(t){this._numberOfParameters=t}},{key:"Call",value:function(t){if(this._prototype)return this._prototype.Call(t);if(this.numberOfParameters!=t.length)throw new Error("Unexpected number of parameters");var e,i=!1,a=d(t);try{for(a.s();!(e=a.n()).done;){var o=e.value;if(o instanceof ht)throw new K('Attempting to perform operation on a void value. Did you forget to "return" a value from a function you called here?');o instanceof Y&&(i=!0)}}catch(h){a.e(h)}finally{a.f()}if(2==t.length&&i)return this.CallBinaryListOperation(t);var u=this.CoerceValuesToSingleType(t),l=u[0].valueType;return l==m.Int||l==m.Float||l==m.String||l==m.DivertTarget||l==m.List?this.CallType(u):null}},{key:"CallType",value:function(t){var e=I(t[0],P),i=e.valueType,a=e,o=t.length;if(2==o||1==o){if(null===this._operationFuncs)return c("NativeFunctionCall._operationFuncs");var u=this._operationFuncs.get(i);if(!u)throw new K("Cannot perform operation "+this.name+" on "+m[i]);if(2==o){var h=I(t[1],P),f=u;if(null===a.value||null===h.value)return c("NativeFunctionCall.Call BinaryOp values");var v=f(a.value,h.value);return P.Create(v)}var k=u;if(null===a.value)return c("NativeFunctionCall.Call UnaryOp value");var g=k(a.value);return P.Create(g,this.name===r.Int?m.Int:this.name===r.Float?m.Float:e.valueType)}throw new Error("Unexpected number of parameters to NativeFunctionCall: "+t.length)}},{key:"CallBinaryListOperation",value:function(t){if(("+"==this.name||"-"==this.name)&&t[0]instanceof Y&&t[1]instanceof E)return this.CallListIncrementOperation(t);var e=I(t[0],P),i=I(t[1],P);if(!("&&"!=this.name&&"||"!=this.name||e.valueType==m.List&&i.valueType==m.List)){if(null===this._operationFuncs)return c("NativeFunctionCall._operationFuncs");var a=this._operationFuncs.get(m.Int);if(null===a)return c("NativeFunctionCall.CallBinaryListOperation op");var o=function(u){if("boolean"==typeof u)return u;throw new Error("".concat(u," is not a boolean"))}(a(e.isTruthy?1:0,i.isTruthy?1:0));return new at(o)}if(e.valueType==m.List&&i.valueType==m.List)return this.CallType([e,i]);throw new K("Can not call use "+this.name+" operation on "+m[e.valueType]+" and "+m[i.valueType])}},{key:"CallListIncrementOperation",value:function(t){var e=I(t[0],Y),i=I(t[1],E),a=new J;if(null===e.value)return c("NativeFunctionCall.CallListIncrementOperation listVal.value");var o,u=d(e.value);try{for(u.s();!(o=u.n()).done;){var l=w(o.value,2),f=l[1],v=A.fromSerializedKey(l[0]);if(null===this._operationFuncs)return c("NativeFunctionCall._operationFuncs");var k=this._operationFuncs.get(m.Int);if(null===i.value)return c("NativeFunctionCall.CallListIncrementOperation intVal.value");var g=k(f,i.value),_=null;if(null===e.value.origins)return c("NativeFunctionCall.CallListIncrementOperation listVal.value.origins");var b,O=d(e.value.origins);try{for(O.s();!(b=O.n()).done;){var j=b.value;if(j.name==v.originName){_=j;break}}}catch(z){O.e(z)}finally{O.f()}if(null!=_){var H=_.TryGetItemWithValue(g,A.Null);H.exists&&a.Add(H.result,g)}}}catch(z){u.e(z)}finally{u.f()}return new Y(a)}},{key:"CoerceValuesToSingleType",value:function(t){var e,i=m.Int,a=null,o=d(t);try{for(o.s();!(e=o.n()).done;){var u=I(e.value,P);u.valueType>i&&(i=u.valueType),u.valueType==m.List&&(a=p(u,Y))}}catch(U){o.e(U)}finally{o.f()}var l=[];if(m[i]==m[m.List]){var h,f=d(t);try{for(f.s();!(h=f.n()).done;){var v=I(h.value,P);if(v.valueType==m.List)l.push(v);else{if(v.valueType!=m.Int)throw new K("Cannot mix Lists and "+m[v.valueType]+" values in this operation");var g=parseInt(v.valueObject);if(null===(a=I(a,Y)).value)return c("NativeFunctionCall.CoerceValuesToSingleType specialCaseList.value");var _=a.value.originOfMaxItem;if(null===_)return c("NativeFunctionCall.CoerceValuesToSingleType list");var b=_.TryGetItemWithValue(g,A.Null);if(!b.exists)throw new K("Could not find List item with the value "+g+" in "+_.name);var O=new Y(b.result,g);l.push(O)}}}catch(U){f.e(U)}finally{f.f()}}else{var j,H=d(t);try{for(H.s();!(j=H.n()).done;){var z=I(j.value,P).Cast(i);l.push(z)}}catch(U){H.e(U)}finally{H.f()}}return l}},{key:"AddOpFuncForType",value:function(t,e){null==this._operationFuncs&&(this._operationFuncs=new Map),this._operationFuncs.set(t,e)}},{key:"toString",value:function(){return'Native "'+this.name+'"'}}],[{key:"CallWithName",value:function(t){return new r(t)}},{key:"CallExistsWithName",value:function(t){return this.GenerateNativeFunctionsIfNecessary(),this._nativeFunctions.get(t)}},{key:"Identity",value:function(t){return t}},{key:"GenerateNativeFunctionsIfNecessary",value:function(){null==this._nativeFunctions&&(this._nativeFunctions=new Map,this.AddIntBinaryOp(this.Add,function(t,e){return t+e}),this.AddIntBinaryOp(this.Subtract,function(t,e){return t-e}),this.AddIntBinaryOp(this.Multiply,function(t,e){return t*e}),this.AddIntBinaryOp(this.Divide,function(t,e){return Math.floor(t/e)}),this.AddIntBinaryOp(this.Mod,function(t,e){return t%e}),this.AddIntUnaryOp(this.Negate,function(t){return-t}),this.AddIntBinaryOp(this.Equal,function(t,e){return t==e}),this.AddIntBinaryOp(this.Greater,function(t,e){return t>e}),this.AddIntBinaryOp(this.Less,function(t,e){return t<e}),this.AddIntBinaryOp(this.GreaterThanOrEquals,function(t,e){return t>=e}),this.AddIntBinaryOp(this.LessThanOrEquals,function(t,e){return t<=e}),this.AddIntBinaryOp(this.NotEquals,function(t,e){return t!=e}),this.AddIntUnaryOp(this.Not,function(t){return 0==t}),this.AddIntBinaryOp(this.And,function(t,e){return 0!=t&&0!=e}),this.AddIntBinaryOp(this.Or,function(t,e){return 0!=t||0!=e}),this.AddIntBinaryOp(this.Max,function(t,e){return Math.max(t,e)}),this.AddIntBinaryOp(this.Min,function(t,e){return Math.min(t,e)}),this.AddIntBinaryOp(this.Pow,function(t,e){return Math.pow(t,e)}),this.AddIntUnaryOp(this.Floor,r.Identity),this.AddIntUnaryOp(this.Ceiling,r.Identity),this.AddIntUnaryOp(this.Int,r.Identity),this.AddIntUnaryOp(this.Float,function(t){return t}),this.AddFloatBinaryOp(this.Add,function(t,e){return t+e}),this.AddFloatBinaryOp(this.Subtract,function(t,e){return t-e}),this.AddFloatBinaryOp(this.Multiply,function(t,e){return t*e}),this.AddFloatBinaryOp(this.Divide,function(t,e){return t/e}),this.AddFloatBinaryOp(this.Mod,function(t,e){return t%e}),this.AddFloatUnaryOp(this.Negate,function(t){return-t}),this.AddFloatBinaryOp(this.Equal,function(t,e){return t==e}),this.AddFloatBinaryOp(this.Greater,function(t,e){return t>e}),this.AddFloatBinaryOp(this.Less,function(t,e){return t<e}),this.AddFloatBinaryOp(this.GreaterThanOrEquals,function(t,e){return t>=e}),this.AddFloatBinaryOp(this.LessThanOrEquals,function(t,e){return t<=e}),this.AddFloatBinaryOp(this.NotEquals,function(t,e){return t!=e}),this.AddFloatUnaryOp(this.Not,function(t){return 0==t}),this.AddFloatBinaryOp(this.And,function(t,e){return 0!=t&&0!=e}),this.AddFloatBinaryOp(this.Or,function(t,e){return 0!=t||0!=e}),this.AddFloatBinaryOp(this.Max,function(t,e){return Math.max(t,e)}),this.AddFloatBinaryOp(this.Min,function(t,e){return Math.min(t,e)}),this.AddFloatBinaryOp(this.Pow,function(t,e){return Math.pow(t,e)}),this.AddFloatUnaryOp(this.Floor,function(t){return Math.floor(t)}),this.AddFloatUnaryOp(this.Ceiling,function(t){return Math.ceil(t)}),this.AddFloatUnaryOp(this.Int,function(t){return Math.floor(t)}),this.AddFloatUnaryOp(this.Float,r.Identity),this.AddStringBinaryOp(this.Add,function(t,e){return t+e}),this.AddStringBinaryOp(this.Equal,function(t,e){return t===e}),this.AddStringBinaryOp(this.NotEquals,function(t,e){return t!==e}),this.AddStringBinaryOp(this.Has,function(t,e){return t.includes(e)}),this.AddStringBinaryOp(this.Hasnt,function(t,e){return!t.includes(e)}),this.AddListBinaryOp(this.Add,function(t,e){return t.Union(e)}),this.AddListBinaryOp(this.Subtract,function(t,e){return t.Without(e)}),this.AddListBinaryOp(this.Has,function(t,e){return t.Contains(e)}),this.AddListBinaryOp(this.Hasnt,function(t,e){return!t.Contains(e)}),this.AddListBinaryOp(this.Intersect,function(t,e){return t.Intersect(e)}),this.AddListBinaryOp(this.Equal,function(t,e){return t.Equals(e)}),this.AddListBinaryOp(this.Greater,function(t,e){return t.GreaterThan(e)}),this.AddListBinaryOp(this.Less,function(t,e){return t.LessThan(e)}),this.AddListBinaryOp(this.GreaterThanOrEquals,function(t,e){return t.GreaterThanOrEquals(e)}),this.AddListBinaryOp(this.LessThanOrEquals,function(t,e){return t.LessThanOrEquals(e)}),this.AddListBinaryOp(this.NotEquals,function(t,e){return!t.Equals(e)}),this.AddListBinaryOp(this.And,function(t,e){return t.Count>0&&e.Count>0}),this.AddListBinaryOp(this.Or,function(t,e){return t.Count>0||e.Count>0}),this.AddListUnaryOp(this.Not,function(t){return 0==t.Count?1:0}),this.AddListUnaryOp(this.Invert,function(t){return t.inverse}),this.AddListUnaryOp(this.All,function(t){return t.all}),this.AddListUnaryOp(this.ListMin,function(t){return t.MinAsList()}),this.AddListUnaryOp(this.ListMax,function(t){return t.MaxAsList()}),this.AddListUnaryOp(this.Count,function(t){return t.Count}),this.AddListUnaryOp(this.ValueOfList,function(t){return t.maxItem.Value}),this.AddOpToNativeFunc(this.Equal,2,m.DivertTarget,function(t,e){return t.Equals(e)}),this.AddOpToNativeFunc(this.NotEquals,2,m.DivertTarget,function(t,e){return!t.Equals(e)}))}},{key:"AddOpToNativeFunc",value:function(t,e,i,a){if(null===this._nativeFunctions)return c("NativeFunctionCall._nativeFunctions");var o=this._nativeFunctions.get(t);o||(o=new r(t,e),this._nativeFunctions.set(t,o)),o.AddOpFuncForType(i,a)}},{key:"AddIntBinaryOp",value:function(t,e){this.AddOpToNativeFunc(t,2,m.Int,e)}},{key:"AddIntUnaryOp",value:function(t,e){this.AddOpToNativeFunc(t,1,m.Int,e)}},{key:"AddFloatBinaryOp",value:function(t,e){this.AddOpToNativeFunc(t,2,m.Float,e)}},{key:"AddFloatUnaryOp",value:function(t,e){this.AddOpToNativeFunc(t,1,m.Float,e)}},{key:"AddStringBinaryOp",value:function(t,e){this.AddOpToNativeFunc(t,2,m.String,e)}},{key:"AddListBinaryOp",value:function(t,e){this.AddOpToNativeFunc(t,2,m.List,e)}},{key:"AddListUnaryOp",value:function(t,e){this.AddOpToNativeFunc(t,1,m.List,e)}}]),r}(F);N.Add="+",N.Subtract="-",N.Divide="/",N.Multiply="*",N.Mod="%",N.Negate="_",N.Equal="==",N.Greater=">",N.Less="<",N.GreaterThanOrEquals=">=",N.LessThanOrEquals="<=",N.NotEquals="!=",N.Not="!",N.And="&&",N.Or="||",N.Min="MIN",N.Max="MAX",N.Pow="POW",N.Floor="FLOOR",N.Ceiling="CEILING",N.Int="INT",N.Float="FLOAT",N.Has="?",N.Hasnt="!?",N.Intersect="^",N.ListMin="LIST_MIN",N.ListMax="LIST_MAX",N.All="LIST_ALL",N.Count="LIST_COUNT",N.ValueOfList="LIST_VALUE",N.Invert="LIST_INVERT",N._nativeFunctions=null;var Pt=function(s){B(r,s);var n=M(r);function r(t){var e;return S(this,r),(e=n.call(this)).text=t.toString()||"",e}return C(r,[{key:"toString",value:function(){return"# "+this.text}}]),r}(F),$t=function(s){B(r,s);var n=M(r);function r(){var t;return S(this,r),(t=n.apply(this,arguments)).text="",t.index=0,t.threadAtGeneration=null,t.sourcePath="",t.targetPath=null,t.isInvisibleDefault=!1,t.originalThreadIndex=0,t}return C(r,[{key:"pathStringOnChoice",get:function(){return null===this.targetPath?c("Choice.targetPath"):this.targetPath.toString()},set:function(t){this.targetPath=new V(t)}}]),r}(F),ye=function(){function s(n,r){S(this,s),this._name=n||"",this._items=null,this._itemNameToValues=r||new Map}return C(s,[{key:"name",get:function(){return this._name}},{key:"items",get:function(){if(null==this._items){this._items=new Map;var n,r=d(this._itemNameToValues);try{for(r.s();!(n=r.n()).done;){var t=w(n.value,2),i=t[1],a=new A(this.name,t[0]);this._items.set(a.serialized(),i)}}catch(o){r.e(o)}finally{r.f()}}return this._items}},{key:"ValueForItem",value:function(n){if(!n.itemName)return 0;var r=this._itemNameToValues.get(n.itemName);return void 0!==r?r:0}},{key:"ContainsItem",value:function(n){return!!n.itemName&&n.originName==this.name&&this._itemNameToValues.has(n.itemName)}},{key:"ContainsItemWithName",value:function(n){return this._itemNameToValues.has(n)}},{key:"TryGetItemWithValue",value:function(n,r){var t,e=d(this._itemNameToValues);try{for(e.s();!(t=e.n()).done;){var i=w(t.value,2);if(i[1]==n)return{result:new A(this.name,i[0]),exists:!0}}}catch(o){e.e(o)}finally{e.f()}return{result:A.Null,exists:!1}}},{key:"TryGetValueForItem",value:function(n,r){if(!n.itemName)return{result:0,exists:!1};var t=this._itemNameToValues.get(n.itemName);return t?{result:t,exists:!0}:{result:0,exists:!1}}}]),s}(),Zt=function(){function s(n){S(this,s),this._lists=new Map,this._allUnambiguousListValueCache=new Map;var r,t=d(n);try{for(t.s();!(r=t.n()).done;){var e=r.value;this._lists.set(e.name,e);var i,a=d(e.items);try{for(a.s();!(i=a.n()).done;){var o=w(i.value,2),l=o[1],h=A.fromSerializedKey(o[0]),f=new Y(h,l);if(!h.itemName)throw new Error("item.itemName is null or undefined.");this._allUnambiguousListValueCache.set(h.itemName,f),this._allUnambiguousListValueCache.set(h.fullName,f)}}catch(v){a.e(v)}finally{a.f()}}}catch(v){t.e(v)}finally{t.f()}}return C(s,[{key:"lists",get:function(){var n,r=[],t=d(this._lists);try{for(t.s();!(n=t.n()).done;){var e=w(n.value,2)[1];r.push(e)}}catch(i){t.e(i)}finally{t.f()}return r}},{key:"TryListGetDefinition",value:function(n,r){if(null===n)return{result:r,exists:!1};var t=this._lists.get(n);return t?{result:t,exists:!0}:{result:r,exists:!1}}},{key:"FindSingleItemListWithName",value:function(n){if(null===n)return c("name");var r=this._allUnambiguousListValueCache.get(n);return void 0!==r?r:null}}]),s}(),Q=function(){function s(){S(this,s)}return C(s,null,[{key:"JArrayToRuntimeObjList",value:function(n){var t=n.length;arguments.length>1&&void 0!==arguments[1]&&arguments[1]&&t--;for(var e=[],i=0;i<t;i++){var o=this.JTokenToRuntimeObject(n[i]);if(null===o)return c("runtimeObj");e.push(o)}return e}},{key:"WriteDictionaryRuntimeObjs",value:function(n,r){n.WriteObjectStart();var t,e=d(r);try{for(e.s();!(t=e.n()).done;){var i=w(t.value,2),o=i[1];n.WritePropertyStart(i[0]),this.WriteRuntimeObject(n,o),n.WritePropertyEnd()}}catch(u){e.e(u)}finally{e.f()}n.WriteObjectEnd()}},{key:"WriteListRuntimeObjs",value:function(n,r){n.WriteArrayStart();var t,e=d(r);try{for(e.s();!(t=e.n()).done;)this.WriteRuntimeObject(n,t.value)}catch(a){e.e(a)}finally{e.f()}n.WriteArrayEnd()}},{key:"WriteIntDictionary",value:function(n,r){n.WriteObjectStart();var t,e=d(r);try{for(e.s();!(t=e.n()).done;){var i=w(t.value,2);n.WriteIntProperty(i[0],i[1])}}catch(u){e.e(u)}finally{e.f()}n.WriteObjectEnd()}},{key:"WriteRuntimeObject",value:function(n,r){var t=p(r,R);if(t)this.WriteRuntimeContainer(n,t);else{var e=p(r,At);if(e){var i,a="->";return e.isExternal?a="x()":e.pushesToStack&&(e.stackPushType==x.Function?a="f()":e.stackPushType==x.Tunnel&&(a="->t->")),i=e.hasVariableTarget?e.variableDivertName:e.targetPathString,n.WriteObjectStart(),n.WriteProperty(a,i),e.hasVariableTarget&&n.WriteProperty("var",!0),e.isConditional&&n.WriteProperty("c",!0),e.externalArgs>0&&n.WriteIntProperty("exArgs",e.externalArgs),void n.WriteObjectEnd()}var o=p(r,Ut);if(o)return n.WriteObjectStart(),n.WriteProperty("*",o.pathStringOnChoice),n.WriteIntProperty("flg",o.flags),void n.WriteObjectEnd();var u=p(r,at);if(u)n.WriteBool(u.value);else{var l=p(r,E);if(l)n.WriteInt(l.value);else{var h=p(r,rt);if(h)n.WriteFloat(h.value);else{var f=p(r,W);if(f)f.isNewline?n.Write("\n",!1):(n.WriteStringStart(),n.WriteStringInner("^"),n.WriteStringInner(f.value),n.WriteStringEnd());else{var v=p(r,Y);if(v)this.WriteInkList(n,v);else{var k=p(r,ut);if(k)return n.WriteObjectStart(),null===k.value?c("divTargetVal.value"):(n.WriteProperty("^->",k.value.componentsString),void n.WriteObjectEnd());var g=p(r,lt);if(g)return n.WriteObjectStart(),n.WriteProperty("^var",g.value),n.WriteIntProperty("ci",g.contextIndex),void n.WriteObjectEnd();if(p(r,_t))n.Write("<>");else{var _=p(r,y);if(_)n.Write(s._controlCommandNames[_.commandType]);else{var b=p(r,N);if(b){var O=b.name;return"^"==O&&(O="L^"),void n.Write(O)}var j=p(r,Ot);if(j){n.WriteObjectStart();var H=j.pathStringForCount;return null!=H?n.WriteProperty("CNT?",H):n.WriteProperty("VAR?",j.name),void n.WriteObjectEnd()}var z=p(r,Kt);if(z)return n.WriteObjectStart(),n.WriteProperty(z.isGlobal?"VAR=":"temp=",z.variableName),z.isNewDeclaration||n.WriteProperty("re",!0),void n.WriteObjectEnd();if(p(r,ht))n.Write("void");else{var st=p(r,Pt);if(st)return n.WriteObjectStart(),n.WriteProperty("#",st.text),void n.WriteObjectEnd();var ft=p(r,$t);if(!ft)throw new Error("Failed to convert runtime object to Json token: "+r);this.WriteChoice(n,ft)}}}}}}}}}}},{key:"JObjectToDictionaryRuntimeObjs",value:function(n){var r=new Map;for(var t in n)if(n.hasOwnProperty(t)){var e=this.JTokenToRuntimeObject(n[t]);if(null===e)return c("inkObject");r.set(t,e)}return r}},{key:"JObjectToIntDictionary",value:function(n){var r=new Map;for(var t in n)n.hasOwnProperty(t)&&r.set(t,parseInt(n[t]));return r}},{key:"JTokenToRuntimeObject",value:function(n){if("number"==typeof n&&!isNaN(n)||"boolean"==typeof n)return P.Create(n);if("string"==typeof n){var r=n.toString(),t=r[0];if("^"==t)return new W(r.substring(1));if("\n"==t&&1==r.length)return new W("\n");if("<>"==r)return new _t;for(var e=0;e<s._controlCommandNames.length;++e)if(r==s._controlCommandNames[e])return new y(e);if("L^"==r&&(r="^"),N.CallExistsWithName(r))return N.CallWithName(r);if("->->"==r)return y.PopTunnel();if("~ret"==r)return y.PopFunction();if("void"==r)return new ht}if("object"===G(n)&&!Array.isArray(n)){var i,a=n;if(a["^->"])return new ut(new V((i=a["^->"]).toString()));if(a["^var"]){var o=new lt((i=a["^var"]).toString());return"ci"in a&&(i=a.ci,o.contextIndex=parseInt(i)),o}var u=!1,l=!1,h=x.Function,f=!1;if((i=a["->"])?u=!0:(i=a["f()"])?(u=!0,l=!0,h=x.Function):(i=a["->t->"])?(u=!0,l=!0,h=x.Tunnel):(i=a["x()"])&&(u=!0,f=!0,l=!1,h=x.Function),u){var v=new At;v.pushesToStack=l,v.stackPushType=h,v.isExternal=f;var k=i.toString();return(i=a.var)?v.variableDivertName=k:v.targetPathString=k,v.isConditional=!!a.c,f&&(i=a.exArgs)&&(v.externalArgs=parseInt(i)),v}if(i=a["*"]){var g=new Ut;return g.pathStringOnChoice=i.toString(),(i=a.flg)&&(g.flags=parseInt(i)),g}if(i=a["VAR?"])return new Ot(i.toString());if(i=a["CNT?"]){var _=new Ot;return _.pathStringForCount=i.toString(),_}var b=!1,O=!1;if((i=a["VAR="])?(b=!0,O=!0):(i=a["temp="])&&(b=!0,O=!1),b){var j=i.toString(),z=new Kt(j,!a.re);return z.isGlobal=O,z}if(void 0!==a["#"])return new Pt((i=a["#"]).toString());if(i=a.list){var U=i,st=new J;for(var St in(i=a.origins)&&st.SetInitialOriginNames(i),U)if(U.hasOwnProperty(St)){var Ft=U[St],Wt=new A(St),kt=parseInt(Ft);st.Add(Wt,kt)}return new Y(st)}if(null!=a.originalChoicePath)return this.JObjectToChoice(a)}if(Array.isArray(n))return this.JArrayToContainer(n);if(null==n)return null;throw new Error("Failed to convert token to runtime object: "+this.toJson(n,["parent"]))}},{key:"toJson",value:function(n,r,t){return JSON.stringify(n,function(e,i){return r?.some(function(a){return a===e})?void 0:i},t)}},{key:"WriteRuntimeContainer",value:function(n,r){var t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(n.WriteArrayStart(),null===r)return c("container");var e,i=d(r.content);try{for(i.s();!(e=i.n()).done;)this.WriteRuntimeObject(n,e.value)}catch(j){i.e(j)}finally{i.f()}var o=r.namedOnlyContent,u=r.countFlags,l=null!=r.name&&!t,h=null!=o||u>0||l;if(h&&n.WriteObjectStart(),null!=o){var f,v=d(o);try{for(v.s();!(f=v.n()).done;){var k=w(f.value,2),b=k[0],O=p(k[1],R);n.WritePropertyStart(b),this.WriteRuntimeContainer(n,O,!0),n.WritePropertyEnd()}}catch(j){v.e(j)}finally{v.f()}}u>0&&n.WriteIntProperty("#f",u),l&&n.WriteProperty("#n",r.name),h?n.WriteObjectEnd():n.WriteNull(),n.WriteArrayEnd()}},{key:"JArrayToContainer",value:function(n){var r=new R;r.content=this.JArrayToRuntimeObjList(n,!0);var t=n[n.length-1];if(null!=t){var e=new Map;for(var i in t)if("#f"==i)r.countFlags=parseInt(t[i]);else if("#n"==i)r.name=t[i].toString();else{var a=this.JTokenToRuntimeObject(t[i]),o=p(a,R);o&&(o.name=i),e.set(i,a)}r.namedOnlyContent=e}return r}},{key:"JObjectToChoice",value:function(n){var r=new $t;return r.text=n.text.toString(),r.index=parseInt(n.index),r.sourcePath=n.originalChoicePath.toString(),r.originalThreadIndex=parseInt(n.originalThreadIndex),r.pathStringOnChoice=n.targetPath.toString(),r}},{key:"WriteChoice",value:function(n,r){n.WriteObjectStart(),n.WriteProperty("text",r.text),n.WriteIntProperty("index",r.index),n.WriteProperty("originalChoicePath",r.sourcePath),n.WriteIntProperty("originalThreadIndex",r.originalThreadIndex),n.WriteProperty("targetPath",r.pathStringOnChoice),n.WriteObjectEnd()}},{key:"WriteInkList",value:function(n,r){var t=r.value;if(null===t)return c("rawList");n.WriteObjectStart(),n.WritePropertyStart("list"),n.WriteObjectStart();var e,i=d(t);try{for(i.s();!(e=i.n()).done;){var a=w(e.value,2),u=a[1],l=A.fromSerializedKey(a[0]),h=u;if(null===l.itemName)return c("item.itemName");n.WritePropertyNameStart(),n.WritePropertyNameInner(l.originName?l.originName:"?"),n.WritePropertyNameInner("."),n.WritePropertyNameInner(l.itemName),n.WritePropertyNameEnd(),n.Write(h),n.WritePropertyEnd()}}catch(g){i.e(g)}finally{i.f()}if(n.WriteObjectEnd(),n.WritePropertyEnd(),0==t.Count&&null!=t.originNames&&t.originNames.length>0){n.WritePropertyStart("origins"),n.WriteArrayStart();var f,v=d(t.originNames);try{for(v.s();!(f=v.n()).done;)n.Write(f.value)}catch(g){v.e(g)}finally{v.f()}n.WriteArrayEnd(),n.WritePropertyEnd()}n.WriteObjectEnd()}},{key:"ListDefinitionsToJToken",value:function(n){var r,t={},e=d(n.lists);try{for(e.s();!(r=e.n()).done;){var i,a=r.value,o={},u=d(a.items);try{for(u.s();!(i=u.n()).done;){var l=w(i.value,2),f=l[1],v=A.fromSerializedKey(l[0]);if(null===v.itemName)return c("item.itemName");o[v.itemName]=f}}catch(k){u.e(k)}finally{u.f()}t[a.name]=o}}catch(k){e.e(k)}finally{e.f()}return t}},{key:"JTokenToListDefinitions",value:function(n){var r=n,t=[];for(var e in r)if(r.hasOwnProperty(e)){var i=e.toString(),a=r[e],o=new Map;for(var u in a)r.hasOwnProperty(e)&&o.set(u,parseInt(a[u]));var h=new ye(i,o);t.push(h)}return new Zt(t)}}]),s}();Q._controlCommandNames=function(){var s=[];s[y.CommandType.EvalStart]="ev",s[y.CommandType.EvalOutput]="out",s[y.CommandType.EvalEnd]="/ev",s[y.CommandType.Duplicate]="du",s[y.CommandType.PopEvaluatedValue]="pop",s[y.CommandType.PopFunction]="~ret",s[y.CommandType.PopTunnel]="->->",s[y.CommandType.BeginString]="str",s[y.CommandType.EndString]="/str",s[y.CommandType.NoOp]="nop",s[y.CommandType.ChoiceCount]="choiceCnt",s[y.CommandType.Turns]="turn",s[y.CommandType.TurnsSince]="turns",s[y.CommandType.ReadCount]="readc",s[y.CommandType.Random]="rnd",s[y.CommandType.SeedRandom]="srnd",s[y.CommandType.VisitIndex]="visit",s[y.CommandType.SequenceShuffleIndex]="seq",s[y.CommandType.StartThread]="thread",s[y.CommandType.Done]="done",s[y.CommandType.End]="end",s[y.CommandType.ListFromInt]="listInt",s[y.CommandType.ListRange]="range",s[y.CommandType.ListRandom]="lrnd";for(var n=0;n<y.CommandType.TOTAL_VALUES;++n)if(null==s[n])throw new Error("Control command not accounted for in serialisation");return s}();var wt=function(){function s(){if(S(this,s),this._threadCounter=0,this._startOfRoot=$.Null,arguments[0]instanceof tt.Story)this._startOfRoot=$.StartOf(arguments[0].rootContentContainer),this.Reset();else{var r=arguments[0];this._threads=[];var t,e=d(r._threads);try{for(e.s();!(t=e.n()).done;)this._threads.push(t.value.Copy())}catch(a){e.e(a)}finally{e.f()}this._threadCounter=r._threadCounter,this._startOfRoot=r._startOfRoot.copy()}}return C(s,[{key:"elements",get:function(){return this.callStack}},{key:"depth",get:function(){return this.elements.length}},{key:"currentElement",get:function(){var n=this._threads[this._threads.length-1].callstack;return n[n.length-1]}},{key:"currentElementIndex",get:function(){return this.callStack.length-1}},{key:"currentThread",get:function(){return this._threads[this._threads.length-1]},set:function(n){Z.Assert(1==this._threads.length,"Shouldn't be directly setting the current thread when we have a stack of them"),this._threads.length=0,this._threads.push(n)}},{key:"canPop",get:function(){return this.callStack.length>1}},{key:"Reset",value:function(){this._threads=[],this._threads.push(new s.Thread),this._threads[0].callstack.push(new s.Element(x.Tunnel,this._startOfRoot))}},{key:"SetJsonToken",value:function(n,r){this._threads.length=0;var t,e=d(n.threads);try{for(e.s();!(t=e.n()).done;){var a=new s.Thread(t.value,r);this._threads.push(a)}}catch(o){e.e(o)}finally{e.f()}this._threadCounter=parseInt(n.threadCounter),this._startOfRoot=$.StartOf(r.rootContentContainer)}},{key:"WriteJson",value:function(n){var r=this;n.WriteObject(function(t){t.WritePropertyStart("threads"),t.WriteArrayStart();var e,i=d(r._threads);try{for(i.s();!(e=i.n()).done;)e.value.WriteJson(t)}catch(a){i.e(a)}finally{i.f()}t.WriteArrayEnd(),t.WritePropertyEnd(),t.WritePropertyStart("threadCounter"),t.WriteInt(r._threadCounter),t.WritePropertyEnd()})}},{key:"PushThread",value:function(){var n=this.currentThread.Copy();this._threadCounter++,n.threadIndex=this._threadCounter,this._threads.push(n)}},{key:"ForkThread",value:function(){var n=this.currentThread.Copy();return this._threadCounter++,n.threadIndex=this._threadCounter,n}},{key:"PopThread",value:function(){if(!this.canPopThread)throw new Error("Can't pop thread");this._threads.splice(this._threads.indexOf(this.currentThread),1)}},{key:"canPopThread",get:function(){return this._threads.length>1&&!this.elementIsEvaluateFromGame}},{key:"elementIsEvaluateFromGame",get:function(){return this.currentElement.type==x.FunctionEvaluationFromGame}},{key:"Push",value:function(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,e=new s.Element(n,this.currentElement.currentPointer,!1);e.evaluationStackHeightWhenPushed=r,e.functionStartInOutputStream=t,this.callStack.push(e)}},{key:"CanPop",value:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return!!this.canPop&&(null==n||this.currentElement.type==n)}},{key:"Pop",value:function(){if(!this.CanPop(arguments.length>0&&void 0!==arguments[0]?arguments[0]:null))throw new Error("Mismatched push/pop in Callstack");this.callStack.pop()}},{key:"GetTemporaryVariableWithName",value:function(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;-1==r&&(r=this.currentElementIndex+1);var e=T(this.callStack[r-1].temporaryVariables,n,null);return e.exists?e.result:null}},{key:"SetTemporaryVariable",value:function(n,r,t){var e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1;-1==e&&(e=this.currentElementIndex+1);var i=this.callStack[e-1];if(!t&&!i.temporaryVariables.get(n))throw new Error("Could not find temporary variable to set: "+n);var a=T(i.temporaryVariables,n,null);a.exists&&Y.RetainListOriginsForAssignment(a.result,r),i.temporaryVariables.set(n,r)}},{key:"ContextForVariableNamed",value:function(n){return this.currentElement.temporaryVariables.get(n)?this.currentElementIndex+1:0}},{key:"ThreadWithIndex",value:function(n){var r=this._threads.filter(function(t){if(t.threadIndex==n)return t});return r.length>0?r[0]:null}},{key:"callStack",get:function(){return this.currentThread.callstack}},{key:"callStackTrace",get:function(){for(var n=new X,r=0;r<this._threads.length;r++){var t=this._threads[r];n.AppendFormat("=== THREAD {0}/{1} {2}===\n",r+1,this._threads.length,r==this._threads.length-1?"(current) ":"");for(var i=0;i<t.callstack.length;i++){n.Append(t.callstack[i].type==x.Function?"  [FUNCTION] ":"  [TUNNEL] ");var a=t.callstack[i].currentPointer;if(!a.isNull){if(n.Append("<SOMEWHERE IN "),null===a.container)return c("pointer.container");n.Append(a.container.path.toString()),n.AppendLine(">")}}}return n.toString()}}]),s}();!function(s){var n=function(){function t(e,i){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];S(this,t),this.evaluationStackHeightWhenPushed=0,this.functionStartInOutputStream=0,this.currentPointer=i.copy(),this.inExpressionEvaluation=a,this.temporaryVariables=new Map,this.type=e}return C(t,[{key:"Copy",value:function(){var e=new t(this.type,this.currentPointer,this.inExpressionEvaluation);return e.temporaryVariables=new Map(this.temporaryVariables),e.evaluationStackHeightWhenPushed=this.evaluationStackHeightWhenPushed,e.functionStartInOutputStream=this.functionStartInOutputStream,e}}]),t}();s.Element=n;var r=function(){function t(){if(S(this,t),this.threadIndex=0,this.previousPointer=$.Null,this.callstack=[],arguments[0]&&arguments[1]){var e=arguments[0],i=arguments[1];this.threadIndex=parseInt(e.threadIndex);var a,u=d(e.callstack);try{for(u.s();!(a=u.n()).done;){var h=a.value,f=parseInt(h.type),v=$.Null,k=void 0,g=h.cPath;if(void 0!==g){k=g.toString();var _=i.ContentAtPath(new V(k));if(v.container=_.container,v.index=parseInt(h.idx),null==_.obj)throw new Error("When loading state, internal story location couldn't be found: "+k+". Has the story changed since this save data was created?");if(_.approximate){if(null===v.container)return c("pointer.container");i.Warning("When loading state, exact internal story location couldn't be found: '"+k+"', so it was approximated to '"+v.container.path.toString()+"' to recover. Has the story changed since this save data was created?")}}var O=new n(f,v,!!h.exp),j=h.temp;void 0!==j?O.temporaryVariables=Q.JObjectToDictionaryRuntimeObjs(j):O.temporaryVariables.clear(),this.callstack.push(O)}}catch(U){u.e(U)}finally{u.f()}var H=e.previousContentObject;if(void 0!==H){var z=new V(H.toString());this.previousPointer=i.PointerAtPath(z)}}}return C(t,[{key:"Copy",value:function(){var e=new t;e.threadIndex=this.threadIndex;var i,a=d(this.callstack);try{for(a.s();!(i=a.n()).done;)e.callstack.push(i.value.Copy())}catch(u){a.e(u)}finally{a.f()}return e.previousPointer=this.previousPointer.copy(),e}},{key:"WriteJson",value:function(e){e.WriteObjectStart(),e.WritePropertyStart("callstack"),e.WriteArrayStart();var i,a=d(this.callstack);try{for(a.s();!(i=a.n()).done;){var o=i.value;if(e.WriteObjectStart(),!o.currentPointer.isNull){if(null===o.currentPointer.container)return c("el.currentPointer.container");e.WriteProperty("cPath",o.currentPointer.container.path.componentsString),e.WriteIntProperty("idx",o.currentPointer.index)}e.WriteProperty("exp",o.inExpressionEvaluation),e.WriteIntProperty("type",o.type),o.temporaryVariables.size>0&&(e.WritePropertyStart("temp"),Q.WriteDictionaryRuntimeObjs(e,o.temporaryVariables),e.WritePropertyEnd()),e.WriteObjectEnd()}}catch(l){a.e(l)}finally{a.f()}if(e.WriteArrayEnd(),e.WritePropertyEnd(),e.WriteIntProperty("threadIndex",this.threadIndex),!this.previousPointer.isNull){var u=this.previousPointer.Resolve();if(null===u)return c("this.previousPointer.Resolve()");e.WriteProperty("previousContentObject",u.path.toString())}e.WriteObjectEnd()}}]),t}();s.Thread=r}(wt||(wt={}));var te=function(){function s(n,r){S(this,s),this.variableChangedEventCallbacks=[],this.patch=null,this._batchObservingVariableChanges=!1,this._defaultGlobalVariables=new Map,this._changedVariablesForBatchObs=new Set,this._globalVariables=new Map,this._callStack=n,this._listDefsOrigin=r;try{return new Proxy(this,{get:function(t,e){return e in t?t[e]:t.$(e)},set:function(t,e,i){return e in t?t[e]=i:t.$(e,i),!0}})}catch{}}return C(s,[{key:"variableChangedEvent",value:function(n,r){var t,e=d(this.variableChangedEventCallbacks);try{for(e.s();!(t=e.n()).done;)(0,t.value)(n,r)}catch(i){e.e(i)}finally{e.f()}}},{key:"batchObservingVariableChanges",get:function(){return this._batchObservingVariableChanges},set:function(n){if(this._batchObservingVariableChanges=n,n)this._changedVariablesForBatchObs=new Set;else if(null!=this._changedVariablesForBatchObs){var r,t=d(this._changedVariablesForBatchObs);try{for(t.s();!(r=t.n()).done;){var e=r.value,i=this._globalVariables.get(e);i?this.variableChangedEvent(e,i):c("currentValue")}}catch(a){t.e(a)}finally{t.f()}this._changedVariablesForBatchObs=null}}},{key:"callStack",get:function(){return this._callStack},set:function(n){this._callStack=n}},{key:"$",value:function(n,r){if(void 0===r){var t=null;return null!==this.patch&&(t=this.patch.TryGetGlobal(n,null)).exists?t.result.valueObject:(void 0===(t=this._globalVariables.get(n))&&(t=this._defaultGlobalVariables.get(n)),void 0!==t?t.valueObject:null)}if(void 0===this._defaultGlobalVariables.get(n))throw new K("Cannot assign to a variable ("+n+") that hasn't been declared in the story");var e=P.Create(r);if(null==e)throw null==r?new Error("Cannot pass null to VariableState"):new Error("Invalid value passed to VariableState: "+r.toString());this.SetGlobal(n,e)}},{key:"ApplyPatch",value:function(){if(null===this.patch)return c("this.patch");var n,r=d(this.patch.globals);try{for(r.s();!(n=r.n()).done;){var t=w(n.value,2);this._globalVariables.set(t[0],t[1])}}catch(l){r.e(l)}finally{r.f()}if(null!==this._changedVariablesForBatchObs){var a,o=d(this.patch.changedVariables);try{for(o.s();!(a=o.n()).done;)this._changedVariablesForBatchObs.add(a.value)}catch(l){o.e(l)}finally{o.f()}}this.patch=null}},{key:"SetJsonToken",value:function(n){this._globalVariables.clear();var r,t=d(this._defaultGlobalVariables);try{for(t.s();!(r=t.n()).done;){var e=w(r.value,2),i=e[0],a=e[1],o=n[i];if(void 0!==o){var u=Q.JTokenToRuntimeObject(o);if(null===u)return c("tokenInkObject");this._globalVariables.set(i,u)}else this._globalVariables.set(i,a)}}catch(l){t.e(l)}finally{t.f()}}},{key:"WriteJson",value:function(n){n.WriteObjectStart();var r,t=d(this._globalVariables);try{for(t.s();!(r=t.n()).done;){var e=w(r.value,2),o=e[0],u=e[1];if(s.dontSaveDefaultValues&&this._defaultGlobalVariables.has(o)){var l=this._defaultGlobalVariables.get(o);if(this.RuntimeObjectsEqual(u,l))continue}n.WritePropertyStart(o),Q.WriteRuntimeObject(n,u),n.WritePropertyEnd()}}catch(h){t.e(h)}finally{t.f()}n.WriteObjectEnd()}},{key:"RuntimeObjectsEqual",value:function(n,r){if(null===n)return c("obj1");if(null===r)return c("obj2");if(n.constructor!==r.constructor)return!1;var t=p(n,at);if(null!==t)return t.value===I(r,at).value;var e=p(n,E);if(null!==e)return e.value===I(r,E).value;var i=p(n,rt);if(null!==i)return i.value===I(r,rt).value;var a=p(n,P),o=p(r,P);if(null!==a&&null!==o)return L(a.valueObject)&&L(o.valueObject)?a.valueObject.Equals(o.valueObject):a.valueObject===o.valueObject;throw new Error("FastRoughDefinitelyEquals: Unsupported runtime object type: "+n.constructor.name)}},{key:"GetVariableWithName",value:function(n){var t=this.GetRawVariableWithName(n,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1),e=p(t,lt);return null!==e&&(t=this.ValueAtVariablePointer(e)),t}},{key:"TryGetDefaultVariableValue",value:function(n){var r=T(this._defaultGlobalVariables,n,null);return r.exists?r.result:null}},{key:"GlobalVariableExistsWithName",value:function(n){return this._globalVariables.has(n)||null!==this._defaultGlobalVariables&&this._defaultGlobalVariables.has(n)}},{key:"GetRawVariableWithName",value:function(n,r){if(0==r||-1==r){var t=null;if(null!==this.patch&&(t=this.patch.TryGetGlobal(n,null)).exists||(t=T(this._globalVariables,n,null)).exists||null!==this._defaultGlobalVariables&&(t=T(this._defaultGlobalVariables,n,null)).exists)return t.result;if(null===this._listDefsOrigin)return c("VariablesState._listDefsOrigin");var e=this._listDefsOrigin.FindSingleItemListWithName(n);if(e)return e}return this._callStack.GetTemporaryVariableWithName(n,r)}},{key:"ValueAtVariablePointer",value:function(n){return this.GetVariableWithName(n.variableName,n.contextIndex)}},{key:"Assign",value:function(n,r){var t=n.variableName;if(null===t)return c("name");var e=-1,i=!1;if(i=n.isNewDeclaration?n.isGlobal:this.GlobalVariableExistsWithName(t),n.isNewDeclaration){var a=p(r,lt);null!==a&&(r=this.ResolveVariablePointer(a))}else{var o=null;do{null!=(o=p(this.GetRawVariableWithName(t,e),lt))&&(t=o.variableName,i=0==(e=o.contextIndex))}while(null!=o)}i?this.SetGlobal(t,r):this._callStack.SetTemporaryVariable(t,r,n.isNewDeclaration,e)}},{key:"SnapshotDefaultGlobals",value:function(){this._defaultGlobalVariables=new Map(this._globalVariables)}},{key:"RetainListOriginsForAssignment",value:function(n,r){var t=I(n,Y),e=I(r,Y);t.value&&e.value&&0==e.value.Count&&e.value.SetInitialOriginNames(t.value.originNames)}},{key:"SetGlobal",value:function(n,r){var t=null;if(null===this.patch&&(t=T(this._globalVariables,n,null)),null!==this.patch&&((t=this.patch.TryGetGlobal(n,null)).exists||(t=T(this._globalVariables,n,null))),Y.RetainListOriginsForAssignment(t.result,r),null===n)return c("variableName");if(null!==this.patch?this.patch.SetGlobal(n,r):this._globalVariables.set(n,r),null!==this.variableChangedEvent&&null!==t&&r!==t.result)if(this.batchObservingVariableChanges){if(null===this._changedVariablesForBatchObs)return c("this._changedVariablesForBatchObs");null!==this.patch?this.patch.AddChangedVariable(n):null!==this._changedVariablesForBatchObs&&this._changedVariablesForBatchObs.add(n)}else this.variableChangedEvent(n,r)}},{key:"ResolveVariablePointer",value:function(n){var r=n.contextIndex;return-1==r&&(r=this.GetContextIndexOfVariableNamed(n.variableName)),p(this.GetRawVariableWithName(n.variableName,r),lt)??new lt(n.variableName,r)}},{key:"GetContextIndexOfVariableNamed",value:function(n){return this.GlobalVariableExistsWithName(n)?0:this._callStack.currentElementIndex}},{key:"ObserveVariableChange",value:function(n){this.variableChangedEventCallbacks.push(n)}}]),s}();te.dontSaveDefaultValues=!0;var Nt=function(){function s(n){S(this,s),this.seed=n%2147483647,this.seed<=0&&(this.seed+=2147483646)}return C(s,[{key:"next",value:function(){return this.seed=48271*this.seed%2147483647}},{key:"nextFloat",value:function(){return(this.next()-1)/2147483646}}]),s}(),me=function(){function s(){if(S(this,s),this._changedVariables=new Set,this._visitCounts=new Map,this._turnIndices=new Map,1===arguments.length&&null!==arguments[0]){var n=arguments[0];this._globals=new Map(n._globals),this._changedVariables=new Set(n._changedVariables),this._visitCounts=new Map(n._visitCounts),this._turnIndices=new Map(n._turnIndices)}else this._globals=new Map,this._changedVariables=new Set,this._visitCounts=new Map,this._turnIndices=new Map}return C(s,[{key:"globals",get:function(){return this._globals}},{key:"changedVariables",get:function(){return this._changedVariables}},{key:"visitCounts",get:function(){return this._visitCounts}},{key:"turnIndices",get:function(){return this._turnIndices}},{key:"TryGetGlobal",value:function(n,r){return null!==n&&this._globals.has(n)?{result:this._globals.get(n),exists:!0}:{result:r,exists:!1}}},{key:"SetGlobal",value:function(n,r){this._globals.set(n,r)}},{key:"AddChangedVariable",value:function(n){return this._changedVariables.add(n)}},{key:"TryGetVisitCount",value:function(n,r){return this._visitCounts.has(n)?{result:this._visitCounts.get(n),exists:!0}:{result:r,exists:!1}}},{key:"SetVisitCount",value:function(n,r){this._visitCounts.set(n,r)}},{key:"SetTurnIndex",value:function(n,r){this._turnIndices.set(n,r)}},{key:"TryGetTurnIndex",value:function(n,r){return this._turnIndices.has(n)?{result:this._turnIndices.get(n),exists:!0}:{result:r,exists:!1}}}]),s}(),mt=function(){function s(){S(this,s)}return C(s,null,[{key:"TextToDictionary",value:function(n){return new s.Reader(n).ToDictionary()}},{key:"TextToArray",value:function(n){return new s.Reader(n).ToArray()}}]),s}();!function(s){var n=function(){function t(e){S(this,t),this._rootObject=JSON.parse(e)}return C(t,[{key:"ToDictionary",value:function(){return this._rootObject}},{key:"ToArray",value:function(){return this._rootObject}}]),t}();s.Reader=n;var r=function(){function t(){S(this,t),this._currentPropertyName=null,this._currentString=null,this._stateStack=[],this._collectionStack=[],this._propertyNameStack=[],this._jsonObject=null}return C(t,[{key:"WriteObject",value:function(e){this.WriteObjectStart(),e(this),this.WriteObjectEnd()}},{key:"WriteObjectStart",value:function(){this.StartNewObject(!0);var e={};if(this.state===s.Writer.State.Property){this.Assert(null!==this.currentCollection),this.Assert(null!==this.currentPropertyName);var i=this._propertyNameStack.pop();this.currentCollection[i]=e,this._collectionStack.push(e)}else this.state===s.Writer.State.Array?(this.Assert(null!==this.currentCollection),this.currentCollection.push(e),this._collectionStack.push(e)):(this.Assert(this.state===s.Writer.State.None),this._jsonObject=e,this._collectionStack.push(e));this._stateStack.push(new s.Writer.StateElement(s.Writer.State.Object))}},{key:"WriteObjectEnd",value:function(){this.Assert(this.state===s.Writer.State.Object),this._collectionStack.pop(),this._stateStack.pop()}},{key:"WriteProperty",value:function(e,i){this.WritePropertyStart(e),arguments[1]instanceof Function?(0,arguments[1])(this):this.Write(arguments[1]),this.WritePropertyEnd()}},{key:"WriteIntProperty",value:function(e,i){this.WritePropertyStart(e),this.WriteInt(i),this.WritePropertyEnd()}},{key:"WriteFloatProperty",value:function(e,i){this.WritePropertyStart(e),this.WriteFloat(i),this.WritePropertyEnd()}},{key:"WritePropertyStart",value:function(e){this.Assert(this.state===s.Writer.State.Object),this._propertyNameStack.push(e),this.IncrementChildCount(),this._stateStack.push(new s.Writer.StateElement(s.Writer.State.Property))}},{key:"WritePropertyEnd",value:function(){this.Assert(this.state===s.Writer.State.Property),this.Assert(1===this.childCount),this._stateStack.pop()}},{key:"WritePropertyNameStart",value:function(){this.Assert(this.state===s.Writer.State.Object),this.IncrementChildCount(),this._currentPropertyName="",this._stateStack.push(new s.Writer.StateElement(s.Writer.State.Property)),this._stateStack.push(new s.Writer.StateElement(s.Writer.State.PropertyName))}},{key:"WritePropertyNameEnd",value:function(){this.Assert(this.state===s.Writer.State.PropertyName),this.Assert(null!==this._currentPropertyName),this._propertyNameStack.push(this._currentPropertyName),this._currentPropertyName=null,this._stateStack.pop()}},{key:"WritePropertyNameInner",value:function(e){this.Assert(this.state===s.Writer.State.PropertyName),this.Assert(null!==this._currentPropertyName),this._currentPropertyName+=e}},{key:"WriteArrayStart",value:function(){this.StartNewObject(!0);var e=[];if(this.state===s.Writer.State.Property){this.Assert(null!==this.currentCollection),this.Assert(null!==this.currentPropertyName);var i=this._propertyNameStack.pop();this.currentCollection[i]=e,this._collectionStack.push(e)}else this.state===s.Writer.State.Array?(this.Assert(null!==this.currentCollection),this.currentCollection.push(e),this._collectionStack.push(e)):(this.Assert(this.state===s.Writer.State.None),this._jsonObject=e,this._collectionStack.push(e));this._stateStack.push(new s.Writer.StateElement(s.Writer.State.Array))}},{key:"WriteArrayEnd",value:function(){this.Assert(this.state===s.Writer.State.Array),this._collectionStack.pop(),this._stateStack.pop()}},{key:"Write",value:function(e){null!==e?(this.StartNewObject(!1),this._addToCurrentObject(e)):console.error("Warning: trying to write a null value")}},{key:"WriteBool",value:function(e){null!==e&&(this.StartNewObject(!1),this._addToCurrentObject(e))}},{key:"WriteInt",value:function(e){null!==e&&(this.StartNewObject(!1),this._addToCurrentObject(Math.floor(e)))}},{key:"WriteFloat",value:function(e){null!==e&&(this.StartNewObject(!1),e==Number.POSITIVE_INFINITY?this._addToCurrentObject(34e37):e==Number.NEGATIVE_INFINITY?this._addToCurrentObject(-34e37):isNaN(e)?this._addToCurrentObject(0):this._addToCurrentObject(e))}},{key:"WriteNull",value:function(){this.StartNewObject(!1),this._addToCurrentObject(null)}},{key:"WriteStringStart",value:function(){this.StartNewObject(!1),this._currentString="",this._stateStack.push(new s.Writer.StateElement(s.Writer.State.String))}},{key:"WriteStringEnd",value:function(){this.Assert(this.state==s.Writer.State.String),this._stateStack.pop(),this._addToCurrentObject(this._currentString),this._currentString=null}},{key:"WriteStringInner",value:function(e){this.Assert(this.state===s.Writer.State.String),null!==e?this._currentString+=e:console.error("Warning: trying to write a null string")}},{key:"toString",value:function(){return null===this._jsonObject?"":JSON.stringify(this._jsonObject)}},{key:"StartNewObject",value:function(e){this.Assert(e?this.state===s.Writer.State.None||this.state===s.Writer.State.Property||this.state===s.Writer.State.Array:this.state===s.Writer.State.Property||this.state===s.Writer.State.Array),this.state===s.Writer.State.Property&&this.Assert(0===this.childCount),this.state!==s.Writer.State.Array&&this.state!==s.Writer.State.Property||this.IncrementChildCount()}},{key:"state",get:function(){return this._stateStack.length>0?this._stateStack[this._stateStack.length-1].type:s.Writer.State.None}},{key:"childCount",get:function(){return this._stateStack.length>0?this._stateStack[this._stateStack.length-1].childCount:0}},{key:"currentCollection",get:function(){return this._collectionStack.length>0?this._collectionStack[this._collectionStack.length-1]:null}},{key:"currentPropertyName",get:function(){return this._propertyNameStack.length>0?this._propertyNameStack[this._propertyNameStack.length-1]:null}},{key:"IncrementChildCount",value:function(){this.Assert(this._stateStack.length>0);var e=this._stateStack.pop();e.childCount++,this._stateStack.push(e)}},{key:"Assert",value:function(e){if(!e)throw Error("Assert failed while writing JSON")}},{key:"_addToCurrentObject",value:function(e){this.Assert(null!==this.currentCollection),this.state===s.Writer.State.Array?(this.Assert(Array.isArray(this.currentCollection)),this.currentCollection.push(e)):this.state===s.Writer.State.Property&&(this.Assert(!Array.isArray(this.currentCollection)),this.Assert(null!==this.currentPropertyName),this.currentCollection[this.currentPropertyName]=e,this._propertyNameStack.pop())}}]),t}();s.Writer=r,function(t){var e;(e=t.State||(t.State={}))[e.None=0]="None",e[e.Object=1]="Object",e[e.Array=2]="Array",e[e.Property=3]="Property",e[e.PropertyName=4]="PropertyName",e[e.String=5]="String";var i=C(function a(o){S(this,a),this.type=s.Writer.State.None,this.childCount=0,this.type=o});t.StateElement=i}(r=s.Writer||(s.Writer={}))}(mt||(mt={}));var It,Ht,gt,xt=function(){function s(){S(this,s);var r=arguments[1];if(this.name=arguments[0],this.callStack=new wt(r),arguments[2]){var t=arguments[2];this.callStack.SetJsonToken(t.callstack,r),this.outputStream=Q.JArrayToRuntimeObjList(t.outputStream),this.currentChoices=Q.JArrayToRuntimeObjList(t.currentChoices);var e=t.choiceThreads;void 0!==e&&this.LoadFlowChoiceThreads(e,r)}else this.outputStream=[],this.currentChoices=[]}return C(s,[{key:"WriteJson",value:function(n){var r=this;n.WriteObjectStart(),n.WriteProperty("callstack",function(o){return r.callStack.WriteJson(o)}),n.WriteProperty("outputStream",function(o){return Q.WriteListRuntimeObjs(o,r.outputStream)});var t,e=!1,i=d(this.currentChoices);try{for(i.s();!(t=i.n()).done;){var a=t.value;if(null===a.threadAtGeneration)return c("c.threadAtGeneration");a.originalThreadIndex=a.threadAtGeneration.threadIndex,null===this.callStack.ThreadWithIndex(a.originalThreadIndex)&&(e||(e=!0,n.WritePropertyStart("choiceThreads"),n.WriteObjectStart()),n.WritePropertyStart(a.originalThreadIndex),a.threadAtGeneration.WriteJson(n),n.WritePropertyEnd())}}catch(o){i.e(o)}finally{i.f()}e&&(n.WriteObjectEnd(),n.WritePropertyEnd()),n.WriteProperty("currentChoices",function(o){o.WriteArrayStart();var u,l=d(r.currentChoices);try{for(l.s();!(u=l.n()).done;)Q.WriteChoice(o,u.value)}catch(f){l.e(f)}finally{l.f()}o.WriteArrayEnd()}),n.WriteObjectEnd()}},{key:"LoadFlowChoiceThreads",value:function(n,r){var t,e=d(this.currentChoices);try{for(e.s();!(t=e.n()).done;){var i=t.value,a=this.callStack.ThreadWithIndex(i.originalThreadIndex);if(null!==a)i.threadAtGeneration=a.Copy();else{var o=n["".concat(i.originalThreadIndex)];i.threadAtGeneration=new wt.Thread(o,r)}}}catch(u){e.e(u)}finally{e.f()}}}]),s}(),ge=function(){function s(n){S(this,s),this.kInkSaveStateVersion=9,this.kMinCompatibleLoadVersion=8,this.onDidLoadState=null,this._currentErrors=null,this._currentWarnings=null,this.divertedPointer=$.Null,this._currentTurnIndex=0,this.storySeed=0,this.previousRandom=0,this.didSafeExit=!1,this._currentText=null,this._currentTags=null,this._outputStreamTextDirty=!0,this._outputStreamTagsDirty=!0,this._patch=null,this._namedFlows=null,this.kDefaultFlowName="DEFAULT_FLOW",this.story=n,this._currentFlow=new xt(this.kDefaultFlowName,n),this.OutputStreamDirty(),this._evaluationStack=[],this._variablesState=new te(this.callStack,n.listDefinitions),this._visitCounts=new Map,this._turnIndices=new Map,this.currentTurnIndex=-1;var r=(new Date).getTime();this.storySeed=new Nt(r).next()%100,this.previousRandom=0,this.GoToStart()}return C(s,[{key:"ToJson",value:function(){var n=new mt.Writer;return this.WriteJson(n),n.toString()}},{key:"toJson",value:function(){return this.ToJson(arguments.length>0&&void 0!==arguments[0]&&arguments[0])}},{key:"LoadJson",value:function(n){var r=mt.TextToDictionary(n);this.LoadJsonObj(r),null!==this.onDidLoadState&&this.onDidLoadState()}},{key:"VisitCountAtPathString",value:function(n){var r;if(null!==this._patch){var t=this.story.ContentAtPath(new V(n)).container;if(null===t)throw new Error("Content at path not found: "+n);if((r=this._patch.TryGetVisitCount(t,0)).exists)return r.result}return(r=T(this._visitCounts,n,null)).exists?r.result:0}},{key:"VisitCountForContainer",value:function(n){if(null===n)return c("container");if(!n.visitsShouldBeCounted)return this.story.Error("Read count for target ("+n.name+" - on "+n.debugMetadata+") unknown. The story may need to be compiled with countAllVisits flag (-c)."),0;if(null!==this._patch){var r=this._patch.TryGetVisitCount(n,0);if(r.exists)return r.result}var t=n.path.toString(),e=T(this._visitCounts,t,null);return e.exists?e.result:0}},{key:"IncrementVisitCountForContainer",value:function(n){if(null!==this._patch){var r=this.VisitCountForContainer(n);return r++,void this._patch.SetVisitCount(n,r)}var t=n.path.toString(),e=T(this._visitCounts,t,null);this._visitCounts.set(t,e.exists?e.result+1:1)}},{key:"RecordTurnIndexVisitToContainer",value:function(n){if(null===this._patch){var r=n.path.toString();this._turnIndices.set(r,this.currentTurnIndex)}else this._patch.SetTurnIndex(n,this.currentTurnIndex)}},{key:"TurnsSinceForContainer",value:function(n){if(n.turnIndexShouldBeCounted||this.story.Error("TURNS_SINCE() for target ("+n.name+" - on "+n.debugMetadata+") unknown. The story may need to be compiled with countAllVisits flag (-c)."),null!==this._patch){var r=this._patch.TryGetTurnIndex(n,0);if(r.exists)return this.currentTurnIndex-r.result}var t=n.path.toString(),e=T(this._turnIndices,t,0);return e.exists?this.currentTurnIndex-e.result:-1}},{key:"callstackDepth",get:function(){return this.callStack.depth}},{key:"outputStream",get:function(){return this._currentFlow.outputStream}},{key:"currentChoices",get:function(){return this.canContinue?[]:this._currentFlow.currentChoices}},{key:"generatedChoices",get:function(){return this._currentFlow.currentChoices}},{key:"currentErrors",get:function(){return this._currentErrors}},{key:"currentWarnings",get:function(){return this._currentWarnings}},{key:"variablesState",get:function(){return this._variablesState},set:function(n){this._variablesState=n}},{key:"callStack",get:function(){return this._currentFlow.callStack}},{key:"evaluationStack",get:function(){return this._evaluationStack}},{key:"currentTurnIndex",get:function(){return this._currentTurnIndex},set:function(n){this._currentTurnIndex=n}},{key:"currentPathString",get:function(){var n=this.currentPointer;return n.isNull?null:null===n.path?c("pointer.path"):n.path.toString()}},{key:"currentPointer",get:function(){return this.callStack.currentElement.currentPointer.copy()},set:function(n){this.callStack.currentElement.currentPointer=n.copy()}},{key:"previousPointer",get:function(){return this.callStack.currentThread.previousPointer.copy()},set:function(n){this.callStack.currentThread.previousPointer=n.copy()}},{key:"canContinue",get:function(){return!this.currentPointer.isNull&&!this.hasError}},{key:"hasError",get:function(){return null!=this.currentErrors&&this.currentErrors.length>0}},{key:"hasWarning",get:function(){return null!=this.currentWarnings&&this.currentWarnings.length>0}},{key:"currentText",get:function(){if(this._outputStreamTextDirty){var n,r=new X,t=d(this.outputStream);try{for(t.s();!(n=t.n()).done;){var e=p(n.value,W);null!==e&&r.Append(e.value)}}catch(i){t.e(i)}finally{t.f()}this._currentText=this.CleanOutputWhitespace(r.toString()),this._outputStreamTextDirty=!1}return this._currentText}},{key:"CleanOutputWhitespace",value:function(n){for(var r=new X,t=-1,e=0,i=0;i<n.length;i++){var a=n.charAt(i),o=" "==a||"\t"==a;o&&-1==t&&(t=i),o||("\n"!=a&&t>0&&t!=e&&r.Append(" "),t=-1),"\n"==a&&(e=i+1),o||r.Append(a)}return r.toString()}},{key:"currentTags",get:function(){if(this._outputStreamTagsDirty){this._currentTags=[];var n,r=d(this.outputStream);try{for(r.s();!(n=r.n()).done;){var t=p(n.value,Pt);null!==t&&this._currentTags.push(t.text)}}catch(e){r.e(e)}finally{r.f()}this._outputStreamTagsDirty=!1}return this._currentTags}},{key:"currentFlowName",get:function(){return this._currentFlow.name}},{key:"inExpressionEvaluation",get:function(){return this.callStack.currentElement.inExpressionEvaluation},set:function(n){this.callStack.currentElement.inExpressionEvaluation=n}},{key:"GoToStart",value:function(){this.callStack.currentElement.currentPointer=$.StartOf(this.story.mainContentContainer)}},{key:"SwitchFlow_Internal",value:function(n){if(null===n)throw new Error("Must pass a non-null string to Story.SwitchFlow");if(null===this._namedFlows&&(this._namedFlows=new Map,this._namedFlows.set(this.kDefaultFlowName,this._currentFlow)),n!==this._currentFlow.name){var r,t=T(this._namedFlows,n,null);t.exists?r=t.result:(r=new xt(n,this.story),this._namedFlows.set(n,r)),this._currentFlow=r,this.variablesState.callStack=this._currentFlow.callStack,this.OutputStreamDirty()}}},{key:"SwitchToDefaultFlow_Internal",value:function(){null!==this._namedFlows&&this.SwitchFlow_Internal(this.kDefaultFlowName)}},{key:"RemoveFlow_Internal",value:function(n){if(null===n)throw new Error("Must pass a non-null string to Story.DestroyFlow");if(n===this.kDefaultFlowName)throw new Error("Cannot destroy default flow");if(this._currentFlow.name===n&&this.SwitchToDefaultFlow_Internal(),null===this._namedFlows)return c("this._namedFlows");this._namedFlows.delete(n)}},{key:"CopyAndStartPatching",value:function(){var n,r,t,e,i,a=new s(this.story);if(a._patch=new me(this._patch),a._currentFlow.name=this._currentFlow.name,a._currentFlow.callStack=new wt(this._currentFlow.callStack),(n=a._currentFlow.currentChoices).push.apply(n,nt(this._currentFlow.currentChoices)),(r=a._currentFlow.outputStream).push.apply(r,nt(this._currentFlow.outputStream)),a.OutputStreamDirty(),null!==this._namedFlows){a._namedFlows=new Map;var o,u=d(this._namedFlows);try{for(u.s();!(o=u.n()).done;){var l=w(o.value,2);a._namedFlows.set(l[0],l[1])}}catch(v){u.e(v)}finally{u.f()}a._namedFlows.set(this._currentFlow.name,a._currentFlow)}return this.hasError&&(a._currentErrors=[],(e=a._currentErrors).push.apply(e,nt(this.currentErrors||[]))),this.hasWarning&&(a._currentWarnings=[],(i=a._currentWarnings).push.apply(i,nt(this.currentWarnings||[]))),a.variablesState=this.variablesState,a.variablesState.callStack=a.callStack,a.variablesState.patch=a._patch,(t=a.evaluationStack).push.apply(t,nt(this.evaluationStack)),this.divertedPointer.isNull||(a.divertedPointer=this.divertedPointer.copy()),a.previousPointer=this.previousPointer.copy(),a._visitCounts=this._visitCounts,a._turnIndices=this._turnIndices,a.currentTurnIndex=this.currentTurnIndex,a.storySeed=this.storySeed,a.previousRandom=this.previousRandom,a.didSafeExit=this.didSafeExit,a}},{key:"RestoreAfterPatch",value:function(){this.variablesState.callStack=this.callStack,this.variablesState.patch=this._patch}},{key:"ApplyAnyPatch",value:function(){if(null!==this._patch){this.variablesState.ApplyPatch();var n,r=d(this._patch.visitCounts);try{for(r.s();!(n=r.n()).done;){var t=w(n.value,2);this.ApplyCountChanges(t[0],t[1],!0)}}catch(f){r.e(f)}finally{r.f()}var a,o=d(this._patch.turnIndices);try{for(o.s();!(a=o.n()).done;){var u=w(a.value,2);this.ApplyCountChanges(u[0],u[1],!1)}}catch(f){o.e(f)}finally{o.f()}this._patch=null}}},{key:"ApplyCountChanges",value:function(n,r,t){(t?this._visitCounts:this._turnIndices).set(n.path.toString(),r)}},{key:"WriteJson",value:function(n){var r=this;if(n.WriteObjectStart(),n.WritePropertyStart("flows"),n.WriteObjectStart(),null!==this._namedFlows){var t,e=d(this._namedFlows);try{var i=function(){var a=w(t.value,2),u=a[1];n.WriteProperty(a[0],function(l){return u.WriteJson(l)})};for(e.s();!(t=e.n()).done;)i()}catch(a){e.e(a)}finally{e.f()}}else n.WriteProperty(this._currentFlow.name,function(a){return r._currentFlow.WriteJson(a)});if(n.WriteObjectEnd(),n.WritePropertyEnd(),n.WriteProperty("currentFlowName",this._currentFlow.name),n.WriteProperty("variablesState",function(a){return r.variablesState.WriteJson(a)}),n.WriteProperty("evalStack",function(a){return Q.WriteListRuntimeObjs(a,r.evaluationStack)}),!this.divertedPointer.isNull){if(null===this.divertedPointer.path)return c("divertedPointer");n.WriteProperty("currentDivertTarget",this.divertedPointer.path.componentsString)}n.WriteProperty("visitCounts",function(a){return Q.WriteIntDictionary(a,r._visitCounts)}),n.WriteProperty("turnIndices",function(a){return Q.WriteIntDictionary(a,r._turnIndices)}),n.WriteIntProperty("turnIdx",this.currentTurnIndex),n.WriteIntProperty("storySeed",this.storySeed),n.WriteIntProperty("previousRandom",this.previousRandom),n.WriteIntProperty("inkSaveVersion",this.kInkSaveStateVersion),n.WriteIntProperty("inkFormatVersion",tt.Story.inkVersionCurrent),n.WriteObjectEnd()}},{key:"LoadJsonObj",value:function(n){var r=n,t=r.inkSaveVersion;if(null==t)throw new Error("ink save format incorrect, can't load.");if(parseInt(t)<this.kMinCompatibleLoadVersion)throw new Error("Ink save format isn't compatible with the current version (saw '"+t+"', but minimum is "+this.kMinCompatibleLoadVersion+"), so can't load.");var e=r.flows;if(null!=e){var i=e;1===Object.keys(i).length?this._namedFlows=null:null===this._namedFlows?this._namedFlows=new Map:this._namedFlows.clear();for(var a=0,o=Object.entries(i);a<o.length;a++){var u=w(o[a],2),l=u[0],h=u[1],f=new xt(l,this.story,h);if(1===Object.keys(i).length)this._currentFlow=new xt(l,this.story,h);else{if(null===this._namedFlows)return c("this._namedFlows");this._namedFlows.set(l,f)}}null!=this._namedFlows&&this._namedFlows.size>1&&(this._currentFlow=this._namedFlows.get(r.currentFlowName))}else this._namedFlows=null,this._currentFlow.name=this.kDefaultFlowName,this._currentFlow.callStack.SetJsonToken(r.callstackThreads,this.story),this._currentFlow.outputStream=Q.JArrayToRuntimeObjList(r.outputStream),this._currentFlow.currentChoices=Q.JArrayToRuntimeObjList(r.currentChoices),this._currentFlow.LoadFlowChoiceThreads(r.choiceThreads,this.story);this.OutputStreamDirty(),this.variablesState.SetJsonToken(r.variablesState),this.variablesState.callStack=this._currentFlow.callStack,this._evaluationStack=Q.JArrayToRuntimeObjList(r.evalStack);var g=r.currentDivertTarget;if(null!=g){var _=new V(g.toString());this.divertedPointer=this.story.PointerAtPath(_)}this._visitCounts=Q.JObjectToIntDictionary(r.visitCounts),this._turnIndices=Q.JObjectToIntDictionary(r.turnIndices),this.currentTurnIndex=parseInt(r.turnIdx),this.storySeed=parseInt(r.storySeed),this.previousRandom=parseInt(r.previousRandom)}},{key:"ResetErrors",value:function(){this._currentErrors=null,this._currentWarnings=null}},{key:"ResetOutput",value:function(){var n,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.outputStream.length=0,null!==r&&(n=this.outputStream).push.apply(n,nt(r)),this.OutputStreamDirty()}},{key:"PushToOutputStream",value:function(n){var r=p(n,W);if(null!==r){var t=this.TrySplittingHeadTailWhitespace(r);if(null!==t){var e,i=d(t);try{for(i.s();!(e=i.n()).done;)this.PushToOutputStreamIndividual(e.value)}catch(o){i.e(o)}finally{i.f()}return void this.OutputStreamDirty()}}this.PushToOutputStreamIndividual(n),this.OutputStreamDirty()}},{key:"PopFromOutputStream",value:function(n){this.outputStream.splice(this.outputStream.length-n,n),this.OutputStreamDirty()}},{key:"TrySplittingHeadTailWhitespace",value:function(n){var r=n.value;if(null===r)return c("single.value");for(var t=-1,e=-1,i=0;i<r.length;i++){var a=r[i];if("\n"!=a){if(" "==a||"\t"==a)continue;break}-1==t&&(t=i),e=i}for(var o=-1,u=-1,l=r.length-1;l>=0;l--){var h=r[l];if("\n"!=h){if(" "==h||"\t"==h)continue;break}-1==o&&(o=l),u=l}if(-1==t&&-1==o)return null;var f=[],v=0,k=r.length;if(-1!=t){if(t>0){var g=new W(r.substring(0,t));f.push(g)}f.push(new W("\n")),v=e+1}if(-1!=o&&(k=u),k>v){var _=r.substring(v,k-v);f.push(new W(_))}if(-1!=o&&u>e&&(f.push(new W("\n")),o<r.length-1)){var O=new W(r.substring(o+1,r.length-o-1));f.push(O)}return f}},{key:"PushToOutputStreamIndividual",value:function(n){var r=p(n,_t),t=p(n,W),e=!0;if(r)this.TrimNewlinesFromOutputStream(),e=!0;else if(t){var i=-1,a=this.callStack.currentElement;a.type==x.Function&&(i=a.functionStartInOutputStream);for(var o=-1,u=this.outputStream.length-1;u>=0;u--){var l=this.outputStream[u],h=l instanceof y?l:null;if(null!=(l instanceof _t?l:null)){o=u;break}if(null!=h&&h.commandType==y.CommandType.BeginString){u>=i&&(i=-1);break}}if(-1!=(-1!=o&&-1!=i?Math.min(i,o):-1!=o?o:i)){if(t.isNewline)e=!1;else if(t.isNonWhitespace&&(o>-1&&this.RemoveExistingGlue(),i>-1))for(var f=this.callStack.elements,v=f.length-1;v>=0;v--){var k=f[v];if(k.type!=x.Function)break;k.functionStartInOutputStream=-1}}else t.isNewline&&(!this.outputStreamEndsInNewline&&this.outputStreamContainsContent||(e=!1))}if(e){if(null===n)return c("obj");this.outputStream.push(n),this.OutputStreamDirty()}}},{key:"TrimNewlinesFromOutputStream",value:function(){for(var n=-1,r=this.outputStream.length-1;r>=0;){var t=this.outputStream[r],e=p(t,y),i=p(t,W);if(null!=e||null!=i&&i.isNonWhitespace)break;null!=i&&i.isNewline&&(n=r),r--}if(n>=0)for(r=n;r<this.outputStream.length;)p(this.outputStream[r],W)?this.outputStream.splice(r,1):r++;this.OutputStreamDirty()}},{key:"RemoveExistingGlue",value:function(){for(var n=this.outputStream.length-1;n>=0;n--){var r=this.outputStream[n];if(r instanceof _t)this.outputStream.splice(n,1);else if(r instanceof y)break}this.OutputStreamDirty()}},{key:"outputStreamEndsInNewline",get:function(){if(this.outputStream.length>0)for(var n=this.outputStream.length-1;n>=0&&!(this.outputStream[n]instanceof y);n--){var r=this.outputStream[n];if(r instanceof W){if(r.isNewline)return!0;if(r.isNonWhitespace)break}}return!1}},{key:"outputStreamContainsContent",get:function(){var n,r=d(this.outputStream);try{for(r.s();!(n=r.n()).done;)if(n.value instanceof W)return!0}catch(t){r.e(t)}finally{r.f()}return!1}},{key:"inStringEvaluation",get:function(){for(var n=this.outputStream.length-1;n>=0;n--){var r=p(this.outputStream[n],y);if(r instanceof y&&r.commandType==y.CommandType.BeginString)return!0}return!1}},{key:"PushEvaluationStack",value:function(n){var r=p(n,Y);if(r){var t=r.value;if(null===t)return c("rawList");if(null!=t.originNames){t.origins||(t.origins=[]),t.origins.length=0;var e,i=d(t.originNames);try{for(i.s();!(e=i.n()).done;){var a=e.value;if(null===this.story.listDefinitions)return c("StoryState.story.listDefinitions");var o=this.story.listDefinitions.TryListGetDefinition(a,null);if(null===o.result)return c("StoryState def.result");t.origins.indexOf(o.result)<0&&t.origins.push(o.result)}}catch(u){i.e(u)}finally{i.f()}}}if(null===n)return c("obj");this.evaluationStack.push(n)}},{key:"PopEvaluationStack",value:function(n){if(void 0===n)return bt(this.evaluationStack.pop());if(n>this.evaluationStack.length)throw new Error("trying to pop too many objects");return bt(this.evaluationStack.splice(this.evaluationStack.length-n,n))}},{key:"PeekEvaluationStack",value:function(){return this.evaluationStack[this.evaluationStack.length-1]}},{key:"ForceEnd",value:function(){this.callStack.Reset(),this._currentFlow.currentChoices.length=0,this.currentPointer=$.Null,this.previousPointer=$.Null,this.didSafeExit=!0}},{key:"TrimWhitespaceFromFunctionEnd",value:function(){Z.Assert(this.callStack.currentElement.type==x.Function);var n=this.callStack.currentElement.functionStartInOutputStream;-1==n&&(n=0);for(var r=this.outputStream.length-1;r>=n;r--){var t=this.outputStream[r],e=p(t,W),i=p(t,y);if(null!=e){if(i||!e.isNewline&&!e.isInlineWhitespace)break;this.outputStream.splice(r,1),this.OutputStreamDirty()}}}},{key:"PopCallStack",value:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.callStack.currentElement.type==x.Function&&this.TrimWhitespaceFromFunctionEnd(),this.callStack.Pop(n)}},{key:"SetChosenPath",value:function(n,r){this._currentFlow.currentChoices.length=0;var t=this.story.PointerAtPath(n);t.isNull||-1!=t.index||(t.index=0),this.currentPointer=t,r&&this.currentTurnIndex++}},{key:"StartFunctionEvaluationFromGame",value:function(n,r){this.callStack.Push(x.FunctionEvaluationFromGame,this.evaluationStack.length),this.callStack.currentElement.currentPointer=$.StartOf(n),this.PassArgumentsToEvaluationStack(r)}},{key:"PassArgumentsToEvaluationStack",value:function(n){if(null!==n)for(var r=0;r<n.length;r++){if("number"!=typeof n[r]&&"string"!=typeof n[r]||n[r]instanceof J)throw new Error((bt(arguments[r]),"null"));this.PushEvaluationStack(P.Create(n[r]))}}},{key:"TryExitFunctionEvaluationFromGame",value:function(){return this.callStack.currentElement.type==x.FunctionEvaluationFromGame&&(this.currentPointer=$.Null,this.didSafeExit=!0,!0)}},{key:"CompleteFunctionEvaluationFromGame",value:function(){if(this.callStack.currentElement.type!=x.FunctionEvaluationFromGame)throw new Error("Expected external function evaluation to be complete. Stack trace: "+this.callStack.callStackTrace);for(var n=this.callStack.currentElement.evaluationStackHeightWhenPushed,r=null;this.evaluationStack.length>n;){var t=this.PopEvaluationStack();null===r&&(r=t)}if(this.PopCallStack(x.FunctionEvaluationFromGame),r){if(r instanceof ht)return null;var e=I(r,P);return e.valueType==m.DivertTarget?e.valueObject.toString():e.valueObject}return null}},{key:"AddError",value:function(n,r){r?(null==this._currentWarnings&&(this._currentWarnings=[]),this._currentWarnings.push(n)):(null==this._currentErrors&&(this._currentErrors=[]),this._currentErrors.push(n))}},{key:"OutputStreamDirty",value:function(){this._outputStreamTextDirty=!0,this._outputStreamTagsDirty=!0}}]),s}(),Se=function(){function s(){S(this,s),this.startTime=void 0}return C(s,[{key:"ElapsedMilliseconds",get:function(){return void 0===this.startTime?0:(new Date).getTime()-this.startTime}},{key:"Start",value:function(){this.startTime=(new Date).getTime()}},{key:"Stop",value:function(){this.startTime=void 0}}]),s}();(function(s){s[s.Author=0]="Author",s[s.Warning=1]="Warning",s[s.Error=2]="Error"})(It||(It={})),Number.isInteger||(Number.isInteger=function(s){return"number"==typeof s&&isFinite(s)&&s>-9007199254740992&&s<9007199254740992&&Math.floor(s)===s}),tt.Story=function(s){B(r,s);var n=M(r);function r(){var t;S(this,r),(t=n.call(this)).inkVersionMinimumCompatible=18,t.onError=null,t.onDidContinue=null,t.onMakeChoice=null,t.onEvaluateFunction=null,t.onCompleteEvaluateFunction=null,t.onChoosePathString=null,t._prevContainers=[],t.allowExternalFunctionFallbacks=!1,t._listDefinitions=null,t._variableObservers=null,t._hasValidatedExternals=!1,t._temporaryEvaluationContainer=null,t._asyncContinueActive=!1,t._stateSnapshotAtLastNewline=null,t._sawLookaheadUnsafeFunctionAfterNewline=!1,t._recursiveContinueCount=0,t._asyncSaving=!1,t._profiler=null;var i=null,a=null;if(arguments[0]instanceof R?(void 0!==arguments[1]&&(i=arguments[1]),t._mainContentContainer=arguments[0]):a="string"==typeof arguments[0]?mt.TextToDictionary(arguments[0]):arguments[0],null!=i&&(t._listDefinitions=new Zt(i)),t._externals=new Map,null!==a){var u=a,l=u.inkVersion;if(null==l)throw new Error("ink version number not found. Are you sure it's a valid .ink.json file?");var h=parseInt(l);if(h>r.inkVersionCurrent)throw new Error("Version of ink used to build story was newer than the current version of the engine");if(h<t.inkVersionMinimumCompatible)throw new Error("Version of ink used to build story is too old to be loaded by this version of the engine");h!=r.inkVersionCurrent&&console.warn("WARNING: Version of ink used to build story doesn't match current version of engine. Non-critical, but recommend synchronising.");var f,v=u.root;if(null==v)throw new Error("Root node for ink not found. Are you sure it's a valid .ink.json file?");(f=u.listDefs)&&(t._listDefinitions=Q.JTokenToListDefinitions(f)),t._mainContentContainer=I(Q.JTokenToRuntimeObject(v),R),t.ResetState()}return t}return C(r,[{key:"currentChoices",get:function(){var t=[];if(null===this._state)return c("this._state");var e,i=d(this._state.currentChoices);try{for(i.s();!(e=i.n()).done;){var a=e.value;a.isInvisibleDefault||(a.index=t.length,t.push(a))}}catch(o){i.e(o)}finally{i.f()}return t}},{key:"currentText",get:function(){return this.IfAsyncWeCant("call currentText since it's a work in progress"),this.state.currentText}},{key:"currentTags",get:function(){return this.IfAsyncWeCant("call currentTags since it's a work in progress"),this.state.currentTags}},{key:"currentErrors",get:function(){return this.state.currentErrors}},{key:"currentWarnings",get:function(){return this.state.currentWarnings}},{key:"currentFlowName",get:function(){return this.state.currentFlowName}},{key:"hasError",get:function(){return this.state.hasError}},{key:"hasWarning",get:function(){return this.state.hasWarning}},{key:"variablesState",get:function(){return this.state.variablesState}},{key:"listDefinitions",get:function(){return this._listDefinitions}},{key:"state",get:function(){return this._state}},{key:"StartProfiling",value:function(){}},{key:"EndProfiling",value:function(){}},{key:"ToJson",value:function(t){var e=this,i=!1;if(t||(i=!0,t=new mt.Writer),t.WriteObjectStart(),t.WriteIntProperty("inkVersion",r.inkVersionCurrent),t.WriteProperty("root",function(b){return Q.WriteRuntimeContainer(b,e._mainContentContainer)}),null!=this._listDefinitions){t.WritePropertyStart("listDefs"),t.WriteObjectStart();var a,o=d(this._listDefinitions.lists);try{for(o.s();!(a=o.n()).done;){var u=a.value;t.WritePropertyStart(u.name),t.WriteObjectStart();var l,h=d(u.items);try{for(h.s();!(l=h.n()).done;){var f=w(l.value,2),k=f[1],g=A.fromSerializedKey(f[0]);t.WriteIntProperty(g.itemName,k)}}catch(b){h.e(b)}finally{h.f()}t.WriteObjectEnd(),t.WritePropertyEnd()}}catch(b){o.e(b)}finally{o.f()}t.WriteObjectEnd(),t.WritePropertyEnd()}if(t.WriteObjectEnd(),i)return t.toString()}},{key:"ResetState",value:function(){this.IfAsyncWeCant("ResetState"),this._state=new ge(this),this._state.variablesState.ObserveVariableChange(this.VariableStateDidChangeEvent.bind(this)),this.ResetGlobals()}},{key:"ResetErrors",value:function(){if(null===this._state)return c("this._state");this._state.ResetErrors()}},{key:"ResetCallstack",value:function(){if(this.IfAsyncWeCant("ResetCallstack"),null===this._state)return c("this._state");this._state.ForceEnd()}},{key:"ResetGlobals",value:function(){if(this._mainContentContainer.namedContent.get("global decl")){var t=this.state.currentPointer.copy();this.ChoosePath(new V("global decl"),!1),this.ContinueInternal(),this.state.currentPointer=t}this.state.variablesState.SnapshotDefaultGlobals()}},{key:"SwitchFlow",value:function(t){if(this.IfAsyncWeCant("switch flow"),this._asyncSaving)throw new Error("Story is already in background saving mode, can't switch flow to "+t);this.state.SwitchFlow_Internal(t)}},{key:"RemoveFlow",value:function(t){this.state.RemoveFlow_Internal(t)}},{key:"SwitchToDefaultFlow",value:function(){this.state.SwitchToDefaultFlow_Internal()}},{key:"Continue",value:function(){return this.ContinueAsync(0),this.currentText}},{key:"canContinue",get:function(){return this.state.canContinue}},{key:"asyncContinueComplete",get:function(){return!this._asyncContinueActive}},{key:"ContinueAsync",value:function(t){this._hasValidatedExternals||this.ValidateExternalBindings(),this.ContinueInternal(t)}},{key:"ContinueInternal",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;null!=this._profiler&&this._profiler.PreContinue();var e=t>0;if(this._recursiveContinueCount++,!this._asyncContinueActive){if(this._asyncContinueActive=e,!this.canContinue)throw new Error("Can't continue - should check canContinue before calling Continue");this._state.didSafeExit=!1,this._state.ResetOutput(),1==this._recursiveContinueCount&&(this._state.variablesState.batchObservingVariableChanges=!0)}var i=new Se;i.Start();var a=!1;this._sawLookaheadUnsafeFunctionAfterNewline=!1;do{try{a=this.ContinueSingleStep()}catch(g){if(!(g instanceof K))throw g;this.AddError(g.message,void 0,g.useEndLineNumber);break}if(a||this._asyncContinueActive&&i.ElapsedMilliseconds>t)break}while(this.canContinue);if(i.Stop(),!a&&this.canContinue||(null!==this._stateSnapshotAtLastNewline&&this.RestoreStateSnapshot(),this.canContinue||(this.state.callStack.canPopThread&&this.AddError("Thread available to pop, threads should always be flat by the end of evaluation?"),0!=this.state.generatedChoices.length||this.state.didSafeExit||null!=this._temporaryEvaluationContainer||(this.state.callStack.CanPop(x.Tunnel)?this.AddError("unexpectedly reached end of content. Do you need a '->->' to return from a tunnel?"):this.state.callStack.CanPop(x.Function)?this.AddError("unexpectedly reached end of content. Do you need a '~ return'?"):this.AddError(this.state.callStack.canPop?"unexpectedly reached end of content for unknown reason. Please debug compiler!":"ran out of content. Do you need a '-> DONE' or '-> END'?"))),this.state.didSafeExit=!1,this._sawLookaheadUnsafeFunctionAfterNewline=!1,1==this._recursiveContinueCount&&(this._state.variablesState.batchObservingVariableChanges=!1),this._asyncContinueActive=!1,null!==this.onDidContinue&&this.onDidContinue()),this._recursiveContinueCount--,null!=this._profiler&&this._profiler.PostContinue(),this.state.hasError||this.state.hasWarning){if(null===this.onError){var o=new X;throw o.Append("Ink had "),this.state.hasError&&(o.Append("".concat(this.state.currentErrors.length)),o.Append(1==this.state.currentErrors.length?" error":"errors"),this.state.hasWarning&&o.Append(" and ")),this.state.hasWarning&&(o.Append("".concat(this.state.currentWarnings.length)),o.Append(1==this.state.currentWarnings.length?" warning":"warnings"),this.state.hasWarning&&o.Append(" and ")),o.Append(". It is strongly suggested that you assign an error handler to story.onError. The first issue was: "),o.Append(this.state.hasError?this.state.currentErrors[0]:this.state.currentWarnings[0]),new K(o.toString())}if(this.state.hasError){var u,l=d(this.state.currentErrors);try{for(l.s();!(u=l.n()).done;)this.onError(u.value,It.Error)}catch(g){l.e(g)}finally{l.f()}}if(this.state.hasWarning){var f,v=d(this.state.currentWarnings);try{for(v.s();!(f=v.n()).done;)this.onError(f.value,It.Warning)}catch(g){v.e(g)}finally{v.f()}}this.ResetErrors()}}},{key:"ContinueSingleStep",value:function(){if(null!=this._profiler&&this._profiler.PreStep(),this.Step(),null!=this._profiler&&this._profiler.PostStep(),this.canContinue||this.state.callStack.elementIsEvaluateFromGame||this.TryFollowDefaultInvisibleChoice(),null!=this._profiler&&this._profiler.PreSnapshot(),!this.state.inStringEvaluation){if(null!==this._stateSnapshotAtLastNewline){if(null===this._stateSnapshotAtLastNewline.currentTags)return c("this._stateAtLastNewline.currentTags");if(null===this.state.currentTags)return c("this.state.currentTags");var t=this.CalculateNewlineOutputStateChange(this._stateSnapshotAtLastNewline.currentText,this.state.currentText,this._stateSnapshotAtLastNewline.currentTags.length,this.state.currentTags.length);if(t==r.OutputStateChange.ExtendedBeyondNewline||this._sawLookaheadUnsafeFunctionAfterNewline)return this.RestoreStateSnapshot(),!0;t==r.OutputStateChange.NewlineRemoved&&this.DiscardSnapshot()}this.state.outputStreamEndsInNewline&&(this.canContinue?null==this._stateSnapshotAtLastNewline&&this.StateSnapshot():this.DiscardSnapshot())}return null!=this._profiler&&this._profiler.PostSnapshot(),!1}},{key:"CalculateNewlineOutputStateChange",value:function(t,e,i,a){if(null===t)return c("prevText");if(null===e)return c("currText");var o=e.length>=t.length&&"\n"==e.charAt(t.length-1);if(i==a&&t.length==e.length&&o)return r.OutputStateChange.NoChange;if(!o)return r.OutputStateChange.NewlineRemoved;if(a>i)return r.OutputStateChange.ExtendedBeyondNewline;for(var u=t.length;u<e.length;u++){var l=e.charAt(u);if(" "!=l&&"\t"!=l)return r.OutputStateChange.ExtendedBeyondNewline}return r.OutputStateChange.NoChange}},{key:"ContinueMaximally",value:function(){this.IfAsyncWeCant("ContinueMaximally");for(var t=new X;this.canContinue;)t.Append(this.Continue());return t.toString()}},{key:"ContentAtPath",value:function(t){return this.mainContentContainer.ContentAtPath(t)}},{key:"KnotContainerWithName",value:function(t){var e=this.mainContentContainer.namedContent.get(t);return e instanceof R?e:null}},{key:"PointerAtPath",value:function(t){if(0==t.length)return $.Null;var e=new $,i=t.length,a=null;return null===t.lastComponent?c("path.lastComponent"):(t.lastComponent.isIndex?(a=this.mainContentContainer.ContentAtPath(t,void 0,i=t.length-1),e.container=a.container,e.index=t.lastComponent.index):(a=this.mainContentContainer.ContentAtPath(t),e.container=a.container,e.index=-1),null==a.obj||a.obj==this.mainContentContainer&&i>0?this.Error("Failed to find content at path '"+t+"', and no approximation of it was possible."):a.approximate&&this.Warning("Failed to find content at path '"+t+"', so it was approximated to: '"+a.obj.path+"'."),e)}},{key:"StateSnapshot",value:function(){this._stateSnapshotAtLastNewline=this._state,this._state=this._state.CopyAndStartPatching()}},{key:"RestoreStateSnapshot",value:function(){null===this._stateSnapshotAtLastNewline&&c("_stateSnapshotAtLastNewline"),this._stateSnapshotAtLastNewline.RestoreAfterPatch(),this._state=this._stateSnapshotAtLastNewline,this._stateSnapshotAtLastNewline=null,this._asyncSaving||this._state.ApplyAnyPatch()}},{key:"DiscardSnapshot",value:function(){this._asyncSaving||this._state.ApplyAnyPatch(),this._stateSnapshotAtLastNewline=null}},{key:"CopyStateForBackgroundThreadSave",value:function(){if(this.IfAsyncWeCant("start saving on a background thread"),this._asyncSaving)throw new Error("Story is already in background saving mode, can't call CopyStateForBackgroundThreadSave again!");var t=this._state;return this._state=this._state.CopyAndStartPatching(),this._asyncSaving=!0,t}},{key:"BackgroundSaveComplete",value:function(){null===this._stateSnapshotAtLastNewline&&this._state.ApplyAnyPatch(),this._asyncSaving=!1}},{key:"Step",value:function(){var t=!0,e=this.state.currentPointer.copy();if(!e.isNull){for(var i=p(e.Resolve(),R);i&&(this.VisitContainer(i,!0),0!=i.content.length);)i=p((e=$.StartOf(i)).Resolve(),R);this.state.currentPointer=e.copy(),null!=this._profiler&&this._profiler.Step(this.state.callStack);var a=e.Resolve(),o=this.PerformLogicAndFlowControl(a);if(!this.state.currentPointer.isNull){o&&(t=!1);var u=p(a,Ut);if(u){var l=this.ProcessChoice(u);l&&this.state.generatedChoices.push(l),a=null,t=!1}if(a instanceof R&&(t=!1),t){var h=p(a,lt);if(h&&-1==h.contextIndex){var f=this.state.callStack.ContextForVariableNamed(h.variableName);a=new lt(h.variableName,f)}this.state.inExpressionEvaluation?this.state.PushEvaluationStack(a):this.state.PushToOutputStream(a)}this.NextContent();var v=p(a,y);v&&v.commandType==y.CommandType.StartThread&&this.state.callStack.PushThread()}}}},{key:"VisitContainer",value:function(t,e){t.countingAtStartOnly&&!e||(t.visitsShouldBeCounted&&this.state.IncrementVisitCountForContainer(t),t.turnIndexShouldBeCounted&&this.state.RecordTurnIndexVisitToContainer(t))}},{key:"VisitChangedContainersDueToDivert",value:function(){var t=this.state.previousPointer.copy(),e=this.state.currentPointer.copy();if(!e.isNull&&-1!=e.index){if(this._prevContainers.length=0,!t.isNull)for(var i=p(t.Resolve(),R)||p(t.container,R);i;)this._prevContainers.push(i),i=p(i.parent,R);var a=e.Resolve();if(null!=a)for(var o=p(a.parent,R),u=!0;o&&(this._prevContainers.indexOf(o)<0||o.countingAtStartOnly);){var l=o.content.length>0&&a==o.content[0]&&u;l||(u=!1),this.VisitContainer(o,l),a=o,o=p(o.parent,R)}}}},{key:"ProcessChoice",value:function(t){var e=!0;if(t.hasCondition){var i=this.state.PopEvaluationStack();this.IsTruthy(i)||(e=!1)}var a="",o="";if(t.hasChoiceOnlyContent&&(o=I(this.state.PopEvaluationStack(),W).value||""),t.hasStartContent&&(a=I(this.state.PopEvaluationStack(),W).value||""),t.onceOnly&&this.state.VisitCountForContainer(t.choiceTarget)>0&&(e=!1),!e)return null;var u=new $t;return u.targetPath=t.pathOnChoice,u.sourcePath=t.path.toString(),u.isInvisibleDefault=t.isInvisibleDefault,u.threadAtGeneration=this.state.callStack.ForkThread(),u.text=(a+o).replace(/^[ \t]+|[ \t]+$/g,""),u}},{key:"IsTruthy",value:function(t){if(t instanceof P){var e=t;return e instanceof ut?(this.Error("Shouldn't use a divert target (to "+e.targetPath+") as a conditional value. Did you intend a function call 'likeThis()' or a read count check 'likeThis'? (no arrows)"),!1):e.isTruthy}return!1}},{key:"PerformLogicAndFlowControl",value:function(t){if(null==t)return!1;if(t instanceof At){var e=t;if(e.isConditional){var i=this.state.PopEvaluationStack();if(!this.IsTruthy(i))return!0}if(e.hasVariableTarget){var a=e.variableDivertName,o=this.state.variablesState.GetVariableWithName(a);if(null==o)this.Error("Tried to divert using a target from a variable that could not be found ("+a+")");else if(!(o instanceof ut)){var u=p(o,E),l="Tried to divert to a target from a variable, but the variable ("+a+") didn't contain a divert target, it ";this.Error(l+=u instanceof E&&0==u.value?"was empty/null (the value 0).":"contained '"+o+"'.")}var h=I(o,ut);this.state.divertedPointer=this.PointerAtPath(h.targetPath)}else{if(e.isExternal)return this.CallExternalFunction(e.targetPathString,e.externalArgs),!0;this.state.divertedPointer=e.targetPointer.copy()}return e.pushesToStack&&this.state.callStack.Push(e.stackPushType,void 0,this.state.outputStream.length),this.state.divertedPointer.isNull&&!e.isExternal&&this.Error(e&&e.debugMetadata&&null!=e.debugMetadata.sourceName?"Divert target doesn't exist: "+e.debugMetadata.sourceName:"Divert resolution failed: "+e),!0}if(t instanceof y){var f=t;switch(f.commandType){case y.CommandType.EvalStart:this.Assert(!1===this.state.inExpressionEvaluation,"Already in expression evaluation?"),this.state.inExpressionEvaluation=!0;break;case y.CommandType.EvalEnd:this.Assert(!0===this.state.inExpressionEvaluation,"Not in expression evaluation mode"),this.state.inExpressionEvaluation=!1;break;case y.CommandType.EvalOutput:if(this.state.evaluationStack.length>0){var v=this.state.PopEvaluationStack();if(!(v instanceof ht)){var k=new W(v.toString());this.state.PushToOutputStream(k)}}break;case y.CommandType.NoOp:break;case y.CommandType.Duplicate:this.state.PushEvaluationStack(this.state.PeekEvaluationStack());break;case y.CommandType.PopEvaluatedValue:this.state.PopEvaluationStack();break;case y.CommandType.PopFunction:case y.CommandType.PopTunnel:var g=f.commandType==y.CommandType.PopFunction?x.Function:x.Tunnel,_=null;if(g==x.Tunnel){var b=this.state.PopEvaluationStack();null===(_=p(b,ut))&&this.Assert(b instanceof ht,"Expected void if ->-> doesn't override target")}if(this.state.TryExitFunctionEvaluationFromGame())break;if(this.state.callStack.currentElement.type==g&&this.state.callStack.canPop)this.state.PopCallStack(),_&&(this.state.divertedPointer=this.PointerAtPath(_.targetPath));else{var O=new Map;O.set(x.Function,"function return statement (~ return)"),O.set(x.Tunnel,"tunnel onwards statement (->->)");var j=O.get(this.state.callStack.currentElement.type);this.state.callStack.canPop||(j="end of flow (-> END or choice)");var H="Found "+O.get(g)+", when expected "+j;this.Error(H)}break;case y.CommandType.BeginString:this.state.PushToOutputStream(f),this.Assert(!0===this.state.inExpressionEvaluation,"Expected to be in an expression when evaluating a string"),this.state.inExpressionEvaluation=!1;break;case y.CommandType.EndString:for(var z=[],U=0,st=this.state.outputStream.length-1;st>=0;--st){var ft=this.state.outputStream[st];U++;var St=p(ft,y);if(St&&St.commandType==y.CommandType.BeginString)break;ft instanceof W&&z.push(ft)}this.state.PopFromOutputStream(U),z=z.reverse();var Ft,Wt=new X,kt=d(z);try{for(kt.s();!(Ft=kt.n()).done;)Wt.Append(Ft.value.toString())}catch(Ve){kt.e(Ve)}finally{kt.f()}this.state.inExpressionEvaluation=!0,this.state.PushEvaluationStack(new W(Wt.toString()));break;case y.CommandType.ChoiceCount:this.state.PushEvaluationStack(new E(this.state.generatedChoices.length));break;case y.CommandType.Turns:this.state.PushEvaluationStack(new E(this.state.currentTurnIndex+1));break;case y.CommandType.TurnsSince:case y.CommandType.ReadCount:var Vt=this.state.PopEvaluationStack();if(!(Vt instanceof ut)){var ee="";Vt instanceof E&&(ee=". Did you accidentally pass a read count ('knot_name') instead of a target ('-> knot_name')?"),this.Error("TURNS_SINCE / READ_COUNT expected a divert target (knot, stitch, label name), but saw "+Vt+ee);break}var zt,ne=I(Vt,ut),Xt=p(this.ContentAtPath(ne.targetPath).correctObj,R);null!=Xt?zt=f.commandType==y.CommandType.TurnsSince?this.state.TurnsSinceForContainer(Xt):this.state.VisitCountForContainer(Xt):(zt=f.commandType==y.CommandType.TurnsSince?-1:0,this.Warning("Failed to find container for "+f.toString()+" lookup at "+ne.targetPath.toString())),this.state.PushEvaluationStack(new E(zt));break;case y.CommandType.Random:var Lt=p(this.state.PopEvaluationStack(),E),dt=p(this.state.PopEvaluationStack(),E);if(null==dt||!(dt instanceof E))return this.Error("Invalid value for minimum parameter of RANDOM(min, max)");if(null==Lt||!(dt instanceof E))return this.Error("Invalid value for maximum parameter of RANDOM(min, max)");if(null===Lt.value)return c("maxInt.value");if(null===dt.value)return c("minInt.value");var Tt=Lt.value-dt.value+1;(!isFinite(Tt)||Tt>Number.MAX_SAFE_INTEGER)&&(Tt=Number.MAX_SAFE_INTEGER,this.Error("RANDOM was called with a range that exceeds the size that ink numbers can use.")),Tt<=0&&this.Error("RANDOM was called with minimum as "+dt.value+" and maximum as "+Lt.value+". The maximum must be larger");var re=new Nt(this.state.storySeed+this.state.previousRandom).next();this.state.PushEvaluationStack(new E(re%Tt+dt.value)),this.state.previousRandom=re;break;case y.CommandType.SeedRandom:var Rt=p(this.state.PopEvaluationStack(),E);if(null==Rt||!(Rt instanceof E))return this.Error("Invalid value passed to SEED_RANDOM");if(null===Rt.value)return c("minInt.value");this.state.storySeed=Rt.value,this.state.previousRandom=0,this.state.PushEvaluationStack(new ht);break;case y.CommandType.VisitIndex:var we=this.state.VisitCountForContainer(this.state.currentPointer.container)-1;this.state.PushEvaluationStack(new E(we));break;case y.CommandType.SequenceShuffleIndex:var Te=this.NextSequenceShuffleIndex();this.state.PushEvaluationStack(new E(Te));break;case y.CommandType.StartThread:break;case y.CommandType.Done:this.state.callStack.canPopThread?this.state.callStack.PopThread():(this.state.didSafeExit=!0,this.state.currentPointer=$.Null);break;case y.CommandType.End:this.state.ForceEnd();break;case y.CommandType.ListFromInt:var jt=p(this.state.PopEvaluationStack(),E),ie=I(this.state.PopEvaluationStack(),W);if(null===jt)throw new K("Passed non-integer when creating a list element from a numerical value.");var Dt=null;if(null===this.listDefinitions)return c("this.listDefinitions");var ae=this.listDefinitions.TryListGetDefinition(ie.value,null);if(!ae.exists)throw new K("Failed to find LIST called "+ie.value);if(null===jt.value)return c("minInt.value");var se=ae.result.TryGetItemWithValue(jt.value,A.Null);se.exists&&(Dt=new Y(se.result,jt.value)),null==Dt&&(Dt=new Y),this.state.PushEvaluationStack(Dt);break;case y.CommandType.ListRange:var oe=p(this.state.PopEvaluationStack(),P),ue=p(this.state.PopEvaluationStack(),P),Yt=p(this.state.PopEvaluationStack(),Y);if(null===Yt||null===ue||null===oe)throw new K("Expected list, minimum and maximum for LIST_RANGE");if(null===Yt.value)return c("targetList.value");var Ee=Yt.value.ListWithSubRange(ue.valueObject,oe.valueObject);this.state.PushEvaluationStack(new Y(Ee));break;case y.CommandType.ListRandom:var le=this.state.PopEvaluationStack();if(null===le)throw new K("Expected list for LIST_RANDOM");var Bt=le.value,Qt=null;if(null===Bt)throw c("list");if(0==Bt.Count)Qt=new J;else{for(var he=new Nt(this.state.storySeed+this.state.previousRandom).next(),Oe=he%Bt.Count,ce=Bt.entries(),fe=0;fe<=Oe-1;fe++)ce.next();var ve=ce.next().value,Mt={Key:A.fromSerializedKey(ve[0]),Value:ve[1]};if(null===Mt.Key.originName)return c("randomItem.Key.originName");(Qt=new J(Mt.Key.originName,this)).Add(Mt.Key,Mt.Value),this.state.previousRandom=he}this.state.PushEvaluationStack(new Y(Qt));break;default:this.Error("unhandled ControlCommand: "+f)}return!0}if(t instanceof Kt){var Pe=t,Ne=this.state.PopEvaluationStack();return this.state.variablesState.Assign(Pe,Ne),!0}if(t instanceof Ot){var Gt=t,qt=null;if(null!=Gt.pathForCount){var xe=this.state.VisitCountForContainer(Gt.containerForCount);qt=new E(xe)}else null==(qt=this.state.variablesState.GetVariableWithName(Gt.name))&&(this.Warning("Variable not found: '"+Gt.name+"'. Using default value of 0 (false). This can happen with temporary variables if the declaration hasn't yet been hit. Globals are always given a default value on load if a value doesn't exist in the save state."),qt=new E(0));return this.state.PushEvaluationStack(qt),!0}if(t instanceof N){var de=t,Fe=this.state.PopEvaluationStack(de.numberOfParameters),We=de.Call(Fe);return this.state.PushEvaluationStack(We),!0}return!1}},{key:"ChoosePathString",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(this.IfAsyncWeCant("call ChoosePathString right now"),null!==this.onChoosePathString&&this.onChoosePathString(t,i),e)this.ResetCallstack();else if(this.state.callStack.currentElement.type==x.Function){var a="",o=this.state.callStack.currentElement.currentPointer.container;throw null!=o&&(a="("+o.path.toString()+") "),new Error("Story was running a function "+a+"when you called ChoosePathString("+t+") - this is almost certainly not not what you want! Full stack trace: \n"+this.state.callStack.callStackTrace)}this.state.PassArgumentsToEvaluationStack(i),this.ChoosePath(new V(t))}},{key:"IfAsyncWeCant",value:function(t){if(this._asyncContinueActive)throw new Error("Can't "+t+". Story is in the middle of a ContinueAsync(). Make more ContinueAsync() calls or a single Continue() call beforehand.")}},{key:"ChoosePath",value:function(t){this.state.SetChosenPath(t,!(arguments.length>1&&void 0!==arguments[1])||arguments[1]),this.VisitChangedContainersDueToDivert()}},{key:"ChooseChoiceIndex",value:function(t){var e=this.currentChoices;this.Assert(t>=0&&t<e.length,"choice out of range");var i=e[t];return null!==this.onMakeChoice&&this.onMakeChoice(i),null===i.threadAtGeneration?c("choiceToChoose.threadAtGeneration"):null===i.targetPath?c("choiceToChoose.targetPath"):(this.state.callStack.currentThread=i.threadAtGeneration,void this.ChoosePath(i.targetPath))}},{key:"HasFunction",value:function(t){try{return null!=this.KnotContainerWithName(t)}catch{return!1}}},{key:"EvaluateFunction",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(null!==this.onEvaluateFunction&&this.onEvaluateFunction(t,e),this.IfAsyncWeCant("evaluate a function"),null==t)throw new Error("Function is null");if(""==t||""==t.trim())throw new Error("Function is empty or white space.");var a=this.KnotContainerWithName(t);if(null==a)throw new Error("Function doesn't exist: '"+t+"'");var o=[];o.push.apply(o,nt(this.state.outputStream)),this._state.ResetOutput(),this.state.StartFunctionEvaluationFromGame(a,e);for(var u=new X;this.canContinue;)u.Append(this.Continue());var l=u.toString();this._state.ResetOutput(o);var h=this.state.CompleteFunctionEvaluationFromGame();return null!=this.onCompleteEvaluateFunction&&this.onCompleteEvaluateFunction(t,e,l,h),i?{returned:h,output:l}:h}},{key:"EvaluateExpression",value:function(t){var e=this.state.callStack.elements.length;this.state.callStack.Push(x.Tunnel),this._temporaryEvaluationContainer=t,this.state.GoToStart();var i=this.state.evaluationStack.length;return this.Continue(),this._temporaryEvaluationContainer=null,this.state.callStack.elements.length>e&&this.state.PopCallStack(),this.state.evaluationStack.length>i?this.state.PopEvaluationStack():null}},{key:"CallExternalFunction",value:function(t,e){if(null===t)return c("funcName");var i=this._externals.get(t),a=null,o=void 0!==i;if(!o||i.lookAheadSafe||null===this._stateSnapshotAtLastNewline){if(!o){if(this.allowExternalFunctionFallbacks)return a=this.KnotContainerWithName(t),this.Assert(null!==a,"Trying to call EXTERNAL function '"+t+"' which has not been bound, and fallback ink function could not be found."),this.state.callStack.Push(x.Function,void 0,this.state.outputStream.length),void(this.state.divertedPointer=$.StartOf(a));this.Assert(!1,"Trying to call EXTERNAL function '"+t+"' which has not been bound (and ink fallbacks disabled).")}for(var u=[],l=0;l<e;++l){var h=I(this.state.PopEvaluationStack(),P).valueObject;u.push(h)}u.reverse();var f=i.function(u),v=null;null!=f?(v=P.Create(f),this.Assert(null!==v,"Could not create ink value from returned object of type "+G(f))):v=new ht,this.state.PushEvaluationStack(v)}else this._sawLookaheadUnsafeFunctionAfterNewline=!0}},{key:"BindExternalFunctionGeneral",value:function(t,e,i){this.IfAsyncWeCant("bind an external function"),this.Assert(!this._externals.has(t),"Function '"+t+"' has already been bound."),this._externals.set(t,{function:e,lookAheadSafe:i})}},{key:"TryCoerce",value:function(t){return t}},{key:"BindExternalFunction",value:function(t,e,i){var a=this;this.Assert(null!=e,"Can't bind a null function"),this.BindExternalFunctionGeneral(t,function(o){a.Assert(o.length>=e.length,"External function expected "+e.length+" arguments");for(var u=[],l=0,h=o.length;l<h;l++)u[l]=a.TryCoerce(o[l]);return e.apply(null,u)},i)}},{key:"UnbindExternalFunction",value:function(t){this.IfAsyncWeCant("unbind an external a function"),this.Assert(this._externals.has(t),"Function '"+t+"' has not been bound."),this._externals.delete(t)}},{key:"ValidateExternalBindings",value:function(){var t=null,e=null,i=arguments[1]||new Set;if(arguments[0]instanceof R&&(t=arguments[0]),arguments[0]instanceof F&&(e=arguments[0]),null===t&&null===e)if(this.ValidateExternalBindings(this._mainContentContainer,i),this._hasValidatedExternals=!0,0==i.size)this._hasValidatedExternals=!0;else{var a="Error: Missing function binding for external";a+=i.size>1?"s":"",a+=": '",a+=Array.from(i).join("', '"),a+="' ",this.Error(a+=this.allowExternalFunctionFallbacks?", and no fallback ink function found.":" (ink fallbacks disabled)")}else if(null!=t){var o,u=d(t.content);try{for(u.s();!(o=u.n()).done;){var l=o.value;null!=l&&l.hasValidName||this.ValidateExternalBindings(l,i)}}catch(j){u.e(j)}finally{u.f()}var f,v=d(t.namedContent);try{for(v.s();!(f=v.n()).done;){var k=w(f.value,2);this.ValidateExternalBindings(p(k[1],F),i)}}catch(j){v.e(j)}finally{v.f()}}else if(null!=e){var _=p(e,At);if(_&&_.isExternal){var b=_.targetPathString;if(null===b)return c("name");this._externals.has(b)||this.allowExternalFunctionFallbacks&&this.mainContentContainer.namedContent.has(b)||i.add(b)}}}},{key:"ObserveVariable",value:function(t,e){if(this.IfAsyncWeCant("observe a new variable"),null===this._variableObservers&&(this._variableObservers=new Map),!this.state.variablesState.GlobalVariableExistsWithName(t))throw new Error("Cannot observe variable '"+t+"' because it wasn't declared in the ink story.");this._variableObservers.has(t)?this._variableObservers.get(t).push(e):this._variableObservers.set(t,[e])}},{key:"ObserveVariables",value:function(t,e){for(var i=0,a=t.length;i<a;i++)this.ObserveVariable(t[i],e[i])}},{key:"RemoveVariableObserver",value:function(t,e){if(this.IfAsyncWeCant("remove a variable observer"),null!==this._variableObservers)if(null!=e){if(this._variableObservers.has(e))if(null!=t){var i=this._variableObservers.get(e);null!=i&&(i.splice(i.indexOf(t),1),0===i.length&&this._variableObservers.delete(e))}else this._variableObservers.delete(e)}else if(null!=t){var a,o=d(this._variableObservers.keys());try{for(o.s();!(a=o.n()).done;){var u=a.value,l=this._variableObservers.get(u);null!=l&&(l.splice(l.indexOf(t),1),0===l.length&&this._variableObservers.delete(u))}}catch(h){o.e(h)}finally{o.f()}}}},{key:"VariableStateDidChangeEvent",value:function(t,e){if(null!==this._variableObservers){var i=this._variableObservers.get(t);if(void 0!==i){if(!(e instanceof P))throw new Error("Tried to get the value of a variable that isn't a standard type");var a,o=I(e,P),u=d(i);try{for(u.s();!(a=u.n()).done;)(0,a.value)(t,o.valueObject)}catch(l){u.e(l)}finally{u.f()}}}}},{key:"globalTags",get:function(){return this.TagsAtStartOfFlowContainerWithPathString("")}},{key:"TagsForContentAtPath",value:function(t){return this.TagsAtStartOfFlowContainerWithPathString(t)}},{key:"TagsAtStartOfFlowContainerWithPathString",value:function(t){var e=new V(t),i=this.ContentAtPath(e).container;if(null===i)return c("flowContainer");for(;;){var a=i.content[0];if(!(a instanceof R))break;i=a}var o,u=null,l=d(i.content);try{for(l.s();!(o=l.n()).done;){var h=p(o.value,Pt);if(!h)break;null==u&&(u=[]),u.push(h.text)}}catch(f){l.e(f)}finally{l.f()}return u}},{key:"BuildStringOfHierarchy",value:function(){var t=new X;return this.mainContentContainer.BuildStringOfHierarchy(t,0,this.state.currentPointer.Resolve()),t.toString()}},{key:"BuildStringOfContainer",value:function(t){var e=new X;return t.BuildStringOfHierarchy(e,0,this.state.currentPointer.Resolve()),e.toString()}},{key:"NextContent",value:function(){if(this.state.previousPointer=this.state.currentPointer.copy(),(this.state.divertedPointer.isNull||(this.state.currentPointer=this.state.divertedPointer.copy(),this.state.divertedPointer=$.Null,this.VisitChangedContainersDueToDivert(),this.state.currentPointer.isNull))&&!this.IncrementContentPointer()){var t=!1;this.state.callStack.CanPop(x.Function)?(this.state.PopCallStack(x.Function),this.state.inExpressionEvaluation&&this.state.PushEvaluationStack(new ht),t=!0):this.state.callStack.canPopThread?(this.state.callStack.PopThread(),t=!0):this.state.TryExitFunctionEvaluationFromGame(),t&&!this.state.currentPointer.isNull&&this.NextContent()}}},{key:"IncrementContentPointer",value:function(){var t=!0,e=this.state.callStack.currentElement.currentPointer.copy();if(e.index++,null===e.container)return c("pointer.container");for(;e.index>=e.container.content.length;){t=!1;var i=p(e.container.parent,R);if(!(i instanceof R))break;var a=i.content.indexOf(e.container);if(-1==a)break;if((e=new $(i,a)).index++,t=!0,null===e.container)return c("pointer.container")}return t||(e=$.Null),this.state.callStack.currentElement.currentPointer=e.copy(),t}},{key:"TryFollowDefaultInvisibleChoice",value:function(){var t=this._state.currentChoices,e=t.filter(function(a){return a.isInvisibleDefault});if(0==e.length||t.length>e.length)return!1;var i=e[0];return null===i.targetPath?c("choice.targetPath"):null===i.threadAtGeneration?c("choice.threadAtGeneration"):(this.state.callStack.currentThread=i.threadAtGeneration,null!==this._stateSnapshotAtLastNewline&&(this.state.callStack.currentThread=this.state.callStack.ForkThread()),this.ChoosePath(i.targetPath,!1),!0)}},{key:"NextSequenceShuffleIndex",value:function(){var t=p(this.state.PopEvaluationStack(),E);if(!(t instanceof E))return this.Error("expected number of elements in sequence for shuffle index"),0;var e=this.state.currentPointer.container;if(null===e)return c("seqContainer");if(null===t.value)return c("numElementsIntVal.value");var i=t.value,a=I(this.state.PopEvaluationStack(),E).value;if(null===a)return c("seqCount");for(var o=a/i,u=a%i,l=e.path.toString(),h=0,f=0,v=l.length;f<v;f++)h+=l.charCodeAt(f)||0;for(var g=new Nt(Math.floor(h+o+this.state.storySeed)),_=[],b=0;b<i;++b)_.push(b);for(var O=0;O<=u;++O){var j=g.next()%_.length,H=_[j];if(_.splice(j,1),O==u)return H}throw new Error("Should never reach here")}},{key:"Error",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=new K(t);throw i.useEndLineNumber=e,i}},{key:"Warning",value:function(t){this.AddError(t,!0)}},{key:"AddError",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=this.currentDebugMetadata,o=e?"WARNING":"ERROR";this.state.AddError(t=null!=a?"RUNTIME "+o+": '"+a.fileName+"' line "+(arguments.length>2&&void 0!==arguments[2]&&arguments[2]?a.endLineNumber:a.startLineNumber)+": "+t:this.state.currentPointer.isNull?"RUNTIME "+o+": "+t:"RUNTIME "+o+": ("+this.state.currentPointer+"): "+t,e),e||this.state.ForceEnd()}},{key:"Assert",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(0==t)throw null==e&&(e="Story assert"),new Error(e+" "+this.currentDebugMetadata)}},{key:"currentDebugMetadata",get:function(){var t,e=this.state.currentPointer;if(!e.isNull&&null!==e.Resolve()&&null!==(t=e.Resolve().debugMetadata))return t;for(var i=this.state.callStack.elements.length-1;i>=0;--i)if(!(e=this.state.callStack.elements[i].currentPointer).isNull&&null!==e.Resolve()&&null!==(t=e.Resolve().debugMetadata))return t;for(var a=this.state.outputStream.length-1;a>=0;--a)if(null!==(t=this.state.outputStream[a].debugMetadata))return t;return null}},{key:"mainContentContainer",get:function(){return this._temporaryEvaluationContainer?this._temporaryEvaluationContainer:this._mainContentContainer}}]),r}(F),tt.Story.inkVersionCurrent=20,(gt=(Ht=tt.Story||(tt.Story={})).OutputStateChange||(Ht.OutputStateChange={}))[gt.NoChange=0]="NoChange",gt[gt.ExtendedBeyondNewline=1]="ExtendedBeyondNewline",gt[gt.NewlineRemoved=2]="NewlineRemoved",tt.InkList=J,Object.defineProperty(tt,"__esModule",{value:!0})});var storyContent={inkVersion:20,root:[["^\u737b\u7d66\u6240\u6709\u7684\u5c0f\u52a9\u624b\u73a9\u800d~!","\n","^\u524d\u6392\u63d0\u793a\uff1a\u5287\u60c5\u3001\u89d2\u8272\u7686\u70ba\u675c\u64b0\uff0c\u53ef\u80fd\u6703\u6709\u908f\u8f2f\u4ee5\u53ca\u5404\u7a2e\u554f\u984c\uff0c\u50c5\u4f9b\u5a1b\u6a02\uff01\u88e1\u982d\u6709\u5c0f\u5075\u63a2\u7684\u4e00\u9ede\u9ede\u79c1\u5fc3\uff0c\u563f\u563f\u2014\u2014\u80fd\u63a5\u53d7\u5c31\u63a5\u8457\u4e0b\u53bb\u5427\uff01","\n",{"->":"main"},["done",{"#f":5,"#n":"g-0"}],null],"done",{main:[["ev","str","^\u958b\u59cb","/str","/ev",{"*":".^.c-0",flg:20},"ev","str","^\u7d50\u675f","/str","/ev",{"*":".^.c-1",flg:4},{"c-0":["\n","^\u4e8b\u4ef6\u7684\u958b\u7aef...","\n",{"->":"Start_1"},{"#f":5}],"c-1":["\n","^\u55da\u55da\u55da\u5c0f\u52a9\u624b\u4f60\u4e0d\u8ddf\u5927\u5075\u63a2\u73a9?!","\n",{"->":"main"},{"#f":5}]}],{"#f":1}],Start_1:[["^\u95a3\u6a13\u4e0a\u7684\u602a\u8072\u97f3","\n","^\u5831\u6848\u4eba\uff1a\u746a\u9e97","\n","^\u4e8b\u7531\uff1a\u9019\u9663\u5b50\u81ea\u5bb6\u7684\u95a3\u6a13\u4e0a\u7e3d\u662f\u51fa\u73fe\u4e0d\u77e5\u540d\u7684\u8173\u6b65\u8072\u4ee5\u53ca\u7d30\u788e\u7684\u566a\u97f3\uff0c\u591a\u6b21\u63a2\u52d8\u537b\u4e00\u7121\u6240\u7372\uff0c\u5e0c\u671b\u6cbb\u5b89\u5c40\u6d3e\u4eba\u524d\u5f80\u63a2\u67e5\u3002","\n","ev","str","^\u7e7c\u7e8c","/str","/ev",{"*":".^.c-0",flg:20},{"c-0":["\n","^\u2026\u2026\u55ef\uff0c\u770b\u8d77\u4f86\u53ea\u662f\u4e00\u500b\u975e\u5e38\u7c21\u55ae\u7684\u6848\u4ef6\uff0c\u7167\u7406\u4f86\u8aaa\u4e0d\u6703\u5206\u6d3e\u5230\u7ba1\u7406\u5c40\uff0c\u4f46\u5f8c\u4f86\u5728\u9019\u8d77\u6848\u4ef6\u7684\u4e8b\u767c\u5730\u5468\u570d\u6aa2\u6e2c\u5230\u72c2\u5384\u53cd\u61c9\uff0c\u4e0d\u5f97\u5df2\u53ea\u597d\u5411\u7ba1\u7406\u5c40\u5448\u5831\u3002","\n",{"->":"Start_2"},{"#f":5}]}],{"#f":1}],Start_2:[["^\u514b\u91cc\u65af\u6b63\u7d00\u9304\u8457\u5f9e\u5c40\u9577\u90a3\u908a\u5f97\u4f86\u7684\u6d88\u606f\uff0c\u5979\u7684\u60f3\u6cd5\u662f\uff1a","\n",["ev",{"^->":"Start_2.0.2.$r1"},{"temp=":"$r"},"str",{"->":".^.s"},[{"#n":"$r1"}],"/str","/ev",{"*":".^.^.c-0",flg:18},{s:['^"\u6240\u4ee5\u6700\u5f8c\u5206\u914d\u5230\u4e86\u6211\u8eab\u4e0a\u2014\u2014\u9019\u6a23\u7684\u8d70\u5411\u662f\u5427\uff01\u54fc\u54fc\uff0c\u679c\u7136\u5c0f\u52a9\u624b\u662f\u9700\u8981\u514b\u91cc\u65af\u63a2\u9577\u5354\u52a9\u7684~\uff01"',{"->":"$r",var:!0},null]}],["ev",{"^->":"Start_2.0.3.$r1"},{"temp=":"$r"},"str",{"->":".^.s"},[{"#n":"$r1"}],"/str","/ev",{"*":".^.^.c-1",flg:18},{s:['^"\u53c8\u4e00\u4f4d\u53d7\u8b0e\u5718\u6240\u56f0\u64fe\u7684\u6c11\u773e\uff1f\u5225\u64d4\u5fc3\uff0c\u514b\u91cc\u65af\u63a2\u9577\u4f86\u4e86\uff01"',{"->":"$r",var:!0},null]}],{"c-0":["ev",{"^->":"Start_2.0.c-0.$r2"},"/ev",{"temp=":"$r"},{"->":".^.^.2.s"},[{"#n":"$r2"}],"\n",{"->":"A_Start_2"},{"#f":5}],"c-1":["ev",{"^->":"Start_2.0.c-1.$r2"},"/ev",{"temp=":"$r"},{"->":".^.^.3.s"},[{"#n":"$r2"}],"\n",{"->":"A_Start_2"},{"#f":5}]}],{"#f":1}],A_Start_2:[["^\u5927\u5075\u63a2\u7684\u8166\u5b50\u88e1\u8fc5\u901f\u9583\u904e\u81ea\u5df1\u9583\u4eae\u767b\u5834\u7684\u756b\u9762\uff0c\u4e00\u6642\u9593\u6709\u4e9b\u98c4\u98c4\u7136\uff0c\u4e00\u908a\u54fc\u8457\u6b4c\u4e00\u908a\u6536\u62fe\u8457\u8981\u53bb\u73fe\u5834\u63a2\u52d8\u7684\u7269\u54c1\uff0c\u65a7\u6756\u3001\u63a2\u6848\u7c3f\u80af\u5b9a\u662f\u5fc5\u5099\u7684\uff01\u63a5\u4e0b\u4f86\u9084\u53ef\u4ee5\u5e36\u4e0a\u4e00\u500b\u7269\u54c1\uff0c\u8981\u5e36\u4ec0\u9ebc\u5462\u3002","\n","ev","str","^\u624b\u96fb\u7b52\uff08\u8aaa\u4e0d\u5b9a\u6703\u7528\u4e0a\u2026\uff09","/str","/ev",{"*":".^.c-0",flg:20},"ev","str","^\u87a2\u5149\u7c89\uff08\u7b49\u7b49\uff0c\u9019\u662f\u6211\u4ec0\u9ebc\u6642\u5019\u5e36\u904e\u4f86\u7684\uff01\uff1f\uff09","/str","/ev",{"*":".^.c-1",flg:20},"ev","str","^\u653e\u5927\u93e1\uff08\u2026\u2026\u662f\u4e0d\u662f\u770b\u8d77\u4f86\u66f4\u50cf\u540d\u5075\u63a2\u4e86\uff1f\uff09","/str","/ev",{"*":".^.c-2",flg:20},"ev","str","^\u90fd\u4e0d\u5e36\uff08\u8f15\u88dd\u4e0a\u9663\uff01\uff09","/str","/ev",{"*":".^.c-3",flg:20},{"c-0":["\n","ev",1,"/ev",{"VAR=":"item",re:!0},{"->":"choose_A"},{"#f":5}],"c-1":["\n","ev",2,"/ev",{"VAR=":"item",re:!0},{"->":"choose_B"},{"#f":5}],"c-2":["\n","ev",3,"/ev",{"VAR=":"item",re:!0},{"->":"choose_C"},{"#f":5}],"c-3":["\n","ev",4,"/ev",{"VAR=":"item",re:!0},{"->":"choose_D"},{"#f":5}]}],{"#f":1}],choose_A:["^[\u63d0\u793a]\u514b\u91cc\u65af\u6700\u5f8c\u9078\u64c7\u4e86\u624b\u96fb\u7b52","\n",{"->":"After_A_Start_2"},{"#f":1}],choose_B:["^[\u63d0\u793a]\u514b\u91cc\u65af\u6700\u5f8c\u9078\u64c7\u4e86\u87a2\u5149\u7c89","\n",{"->":"After_A_Start_2"},{"#f":1}],choose_C:["^[\u63d0\u793a]\u514b\u91cc\u65af\u6700\u5f8c\u9078\u64c7\u4e86\u653e\u5927\u93e1","\n",{"->":"After_A_Start_2"},{"#f":1}],choose_D:["^[\u63d0\u793a]\u514b\u91cc\u65af\u6700\u5f8c\u9078\u64c7\u90fd\u4e0d\u5e36","\n",{"->":"After_A_Start_2"},{"#f":1}],After_A_Start_2:[["^\u78ba\u8a8d\u6771\u897f\u90fd\u6c92\u6709\u6f0f\u4e0b\u5f8c\uff0c\u514b\u91cc\u65af\u53bb\u627e\u4e86\u5c0f\u52a9\u624b\u6253\u4e86\u8072\u62db\u547c\uff0c\u4fe1\u8a93\u65e6\u65e6\u5730\u8aaa\u80af\u5b9a\u5f88\u5feb\u5c31\u7834\u6848\u56de\u4f86\u5566\uff01","\n","ev","str","^\u51fa\u767c","/str","/ev",{"*":".^.c-0",flg:20},{"c-0":["\n",{"->":"go"},{"#f":5}]}],{"#f":1}],go:[["^\u62b5\u9054\u76ee\u7684\u5730\u6642\u6070\u597d\u5728\u4e2d\u5348\uff0c\u746a\u9e97\u592b\u4eba\u5f88\u71b1\u60c5\u5730\u9080\u8acb\u81ea\u5df1\u8207\u5979\u7684\u5bb6\u4eba\u4eab\u7528\u5348\u9910\u3002","\n","ev","str","^\u7b54\u61c9\u7528\u9910","/str","/ev",{"*":".^.c-0",flg:20},"ev","str","^\u62d2\u7d55\u7528\u9910","/str","/ev",{"*":".^.c-1",flg:20},{"c-0":["\n",{"->":"agree_meal"},{"#f":5}],"c-1":["\n",{"->":"notagree_meal"},{"#f":5}]}],{"#f":1}],agree_meal:[["^\u63a2\u9577\u6709\u4e9b\u4e0d\u597d\u610f\u601d\u7684\u7b54\u61c9\u4e86\u746a\u9e97\u592b\u4eba\u7684\u9080\u7d04\uff0c\u5728\u8ddf\u8457\u5c0d\u65b9\u9032\u5165\u4f4f\u5b85\u6642\u6070\u597d\u77a5\u898b\u4e86\u8eb2\u5728\u9580\u5f8c\u5077\u5077\u770b\u8457\u81ea\u5df1\u7684\u5c0f\u5973\u5b69\uff0c\u662f\u746a\u9e97\u592b\u4eba\u7684\u5b69\u5b50\u5427\uff1f","\n","ev","str","^\u671d\u5979\u7728\u7728\u773c","/str","/ev",{"*":".^.c-0",flg:20},"ev","str","^\u671d\u5979\u63da\u8d77\u7b11\u81c9","/str","/ev",{"*":".^.c-1",flg:20},"ev","str","^\u671d\u5979\u5410\u820c\u982d","/str","/ev",{"*":".^.c-2",flg:20},{"c-0":["\n","^\u5c0f\u5973\u5b69\u6b6a\u4e86\u6b6a\u8166\u888b\uff0c\u5b78\u8457\u4f60\u7728\u7728\u773c\u775b\u3002","\n",{"->":"After_meal"},{"#f":5}],"c-1":["\n","^\u5c0f\u5973\u5b69\u5bb3\u7f9e\u7684\u5c0d\u4f60\u7b11\u4e86\u4e00\u4e0b\uff0c\u96a8\u5f8c\u8eb2\u5230\u4e86\u746a\u9e97\u592b\u4eba\u7684\u80cc\u5f8c\u3002","\n",{"->":"After_meal"},{"#f":5}],"c-2":["\n","^\u5c0f\u5973\u5b69\u4e5f\u5b78\u4f60\u5410\u4e86\u5410\u820c\u982d\uff0c\u4f60\u5011\u540c\u6642\u7b11\u4e86\u51fa\u8072\uff0c\u746a\u9e97\u592b\u4eba\u898b\u72c0\u4e5f\u5fae\u7b11\u8457\u6416\u4e86\u6416\u982d\u3002","\n","^\u746a\u9e97\u592b\u4eba\uff1a\u840a\u7d72\u8389\u5f88\u559c\u6b61\u4f60\uff0c\u5979\u4e00\u5411\u4e0d\u600e\u9ebc\u559c\u6b61\u898b\u964c\u751f\u4eba\u7684\uff0c\u7562\u7adf\u65b0\u57ce\u4eba\u5c0d\u6211\u5011\u7684\u614b\u5ea6\u7e3d\u6709\u4e9b\u4e0d\u540c\uff0c\u5c0f\u5b69\u5b50\u662f\u5f88\u654f\u611f\u7684\u3002","\n","^\u514b\u91cc\u65af\u60f3\u8d77\u6a94\u6848\u4e2d\u9019\u5bb6\u4eba\u7684\u80cc\u666f\uff0c\u4e0d\u514d\u7406\u89e3\u5730\u9ede\u4e86\u9ede\u982d\u3002","\n",{"->":"After_meal"},{"#f":5}]}],{"#f":1}],notagree_meal:[["^\u525b\u628a\u62d2\u7d55\u7684\u8a71\u8b1b\u51fa\u53e3\uff0c\u809a\u5b50\u6beb\u4e0d\u5ba2\u6c23\u5730\u767c\u51fa\u5495\u5695\u2014\u2014\u7684\u8072\u97f3\uff0c\u5bb3\u5f97\u5c0f\u63a2\u9577\u6b62\u4f4f\u4e86\u5f8c\u7e8c\u8a71\u8a9e\uff0c\u4e0d\u597d\u610f\u601d\u5730\u7d05\u4e86\u81c9\u9830\uff0c\u6700\u5f8c\u4f9d\u820a\u88ab\u548c\u85f9\u7684\u746a\u9e97\u592b\u4eba\u5e36\u9032\u4f4f\u5b85\u4e2d\u3002","\n","ev","str","^\u7b54\u61c9\u7528\u9910","/str","/ev",{"*":".^.c-0",flg:20},{"c-0":["\n","^\u884c\u52d5:[\u7b54\u61c9\u7528\u9910]","\n",{"->":"After_meal"},{"#f":5}]}],{"#f":1}],After_meal:[["^\u7528\u904e\u5348\u9910\u5f8c\u514b\u91cc\u65af\u8ddf\u96a8\u8457\u746a\u9e97\u592b\u4eba\u7684\u5e36\u9818\uff0c\u7b2c\u4e00\u6b21\u7528\u81ea\u5df1\u7684\u96d9\u773c\u78ba\u8a8d\u904e\u6848\u767c\u73fe\u5834\uff0c\u9670\u6697\u3001\u60b6\u71b1\uff0c\u5e36\u8457\u4e9b\u8a31\u6728\u982d\u8150\u673d\u7684\u6c23\u606f\u8207\u9709\u5473\uff0c\u4e0d\u50cf\u662f\u6709\u4eba\u6703\u60f3\u8eb2\u5728\u9019\u88e1\u7684\u5730\u9ede\u3002","\n","ev","str","^\u74b0\u9867\u56db\u5468","/str","/ev",{"*":".^.c-0",flg:20},"ev","str","^\u8a62\u554f\u746a\u9e97\u592b\u4eba","/str","/ev",{"*":".^.c-1",flg:20},{"c-0":["\n","^\u884c\u52d5:[\u74b0\u9867\u56db\u5468]","\n","^\u53ea\u80fd\u770b\u898b\u5806\u6eff\u7684\u96dc\u7269\u3002","\n",{"->":".^.^.^"},{"#f":5}],"c-1":["\n","^\u884c\u52d5:[\u8a62\u554f\u746a\u9e97\u592b\u4eba]","\n",{"->":"ask1"},{"#f":5}]}],{"#f":1}],ask1:[["^\u746a\u9e97\u592b\u4eba\uff1a\u5c0f\u5075\u63a2\uff0c\u60f3\u554f\u4ec0\u9ebc\u55ce\uff1f","\n","ev","str","^\u8a62\u554f\u767c\u751f\u60c5\u5f62","/str","/ev",{"*":".^.c-0",flg:20},"ev","str","^\u8a62\u554f\u662f\u5426\u6709\u7a97\u6236","/str","/ev",{"*":".^.c-1",flg:20},"ev","str","^\u9592\u804a","/str","/ev",{"*":".^.c-2",flg:20},"ev","str","^\u7d50\u675f","/str","/ev",{"*":".^.c-3",flg:20},{"c-0":["\n","^\u884c\u52d5:[\u8a62\u554f\u767c\u751f\u60c5\u5f62]","\n","^\u746a\u9e97\u592b\u4eba\uff1a\u767c\u751f\u6642\u9593\u2026\u2026\u6211\u8a18\u5f97\u5728\u534a\u591c\uff0c\u63a5\u8fd1\u51cc\u6668\u5169\u9ede\u7684\u6642\u5019\u3002\u840a\u65af\u8389\u623f\u9593\u6b63\u4e0a\u65b9\u5c31\u662f\u95a3\u6a13\uff0c\u6211\u53bb\u6aa2\u67e5\u5979\u6709\u6c92\u6709\u8e22\u88ab\u5b50\u6642\u5c31\u80fd\u807d\u898b\u7d30\u788e\u7684\u8173\u6b65\u8072\u3002","\n","^\u6211\u6aa2\u67e5\u4e86\u5f88\u4e45\uff0c\u6700\u5f8c\u78ba\u5b9a\u662f\u5f9e\u95a3\u6a13\u767c\u51fa\u4f86\u7684\u3002","\n","^\u514b\u91cc\u65af\uff1a\u534a\u591c\u55ce\uff1f\u80fd\u807d\u898b\u8173\u6b65\u8072\u7684\u524d\u63d0\u4e0b\uff0c\u5c0f\u52d5\u7269\u4f3c\u4e4e\u80fd\u5148\u6392\u9664\u4e86\u3002\u2026\u2026\u4eba\uff1f\u7981\u9589\u8005\uff1f\uff08\u514b\u91cc\u65af\u6084\u6084\u5600\u5495\u8457\uff09","\n",{"->":"ask1"},{"#f":5}],"c-1":["\n","^\u884c\u52d5:[\u8a62\u554f\u662f\u5426\u6709\u7a97\u6236]","\n","^\u746a\u9e97\u592b\u4eba\uff1a\u7a97\u6236\uff1f\u7a97\u6236\u554a\u2026\u2026\u807d\u4f60\u4e00\u554f\u4f3c\u4e4e\u6709\u4e00\u6247\uff0c\u4f46\u5df2\u7d93\u88ab\u90a3\u5806\u96dc\u7269\u7d66\u64cb\u8d77\u4f86\u4e86\uff0c\u6211\u5df2\u7d93\u5f88\u4e45\u6c92\u6709\u642c\u958b\u90a3\u5806\u96dc\u7269\u4e86\u3002","\n","^\u514b\u91cc\u65af\uff1a\u55ef\uff01\u770b\u4f86\u7a97\u6236\u4e5f\u662f\u4e00\u500b\u53ef\u4ee5\u78ba\u8a8d\u7684\u90e8\u5206\u3002","\n",{"->":"ask1"},{"#f":5}],"c-2":["\n","^\u884c\u52d5:[\u9592\u804a]","\n","^\u746a\u9e97\u592b\u4eba\uff1a\u840a\u65af\u8389\u5979\u5728\u623f\u9593\u88e1\u807d\u5230\u5947\u602a\u7684\u8072\u97f3\u9019\u9ebc\u4e45\u4e86\uff0c\u90fd\u6c92\u6709\u8ddf\u6211\u5011\u8aaa\u3002","\n","^\u514b\u91cc\u65af\uff1a\u9019\u500b\u72c0\u6cc1\u6301\u7e8c\u5f88\u4e45\u4e86\u55ce\uff1f","\n","^\u746a\u9e97\u592b\u4eba\uff1a\u81f3\u5c11\u6709\u4e00\u5468\u4e86\u3002","\n",{"->":"ask1"},{"#f":5}],"c-3":["\n",{"->":"After_ask1"},{"#f":5}]}],{"#f":1}],After_ask1:[["^\u514b\u91cc\u65af\u5c07\u9019\u4e9b\u8a0a\u606f\u5530\u5530\u5730\u5beb\u5728\u63a2\u6848\u7c3f\u4e0a\uff0c\u4e00\u908a\u5beb\u8457\u4e00\u908a\u9ede\u8457\u8166\u888b\uff0c\u6700\u5f8c\u556a\u7684\u4e00\u4e0b\u5408\u4e86\u8d77\u4f86\uff0c\u7b11\u7787\u7787\u5730\u5c0d\u8457\u746a\u9e97\u592b\u4eba\u8aaa\uff1a\u5225\u64d4\u5fc3\uff0c\u514b\u91cc\u65af\u63a2\u9577\u6703\u89e3\u6c7a\u554f\u984c\u7684\uff01","\n","^\u63a5\u4e0b\u4f86\u4f60\u60f3\uff1f","\n",["ev",{"^->":"After_ask1.0.4.$r1"},{"temp=":"$r"},"str",{"->":".^.s"},[{"#n":"$r1"}],"/str","/ev",{"*":".^.^.c-0",flg:18},{s:['^"\u746a\u9e97\u592b\u4eba\uff0c\u518d\u4f86\u6211\u60f3\u6aa2\u67e5\u4e00\u4e0b\u95a3\u6a13\uff0c\u9700\u8981\u5728\u592b\u4eba\u60a8\u7684\u966a\u540c\u4e0b\u9032\u884c\u9019\u9805\u6d3b\u52d5\u55ce\uff1f"',{"->":"$r",var:!0},null]}],["ev",{"^->":"After_ask1.0.5.$r1"},{"temp=":"$r"},"str",{"->":".^.s"},[{"#n":"$r1"}],"/str","/ev",{"*":".^.^.c-1",flg:18},{s:['^"\u746a\u9e97\u592b\u4eba\uff0c\u518d\u4f86\u6211\u8981\u642c\u958b\u90a3\u4e9b\u96dc\u7269\uff0c\u55ef\u3001\u53ef\u80fd\u6703\u6709\u4e9b\u7070\u5875\uff0c\u60a8\u8981\u5148\u4e0b\u6a13\u7b49\u6211\u6aa2\u67e5\u5b8c\u7562\u55ce\uff1f"',{"->":"$r",var:!0},null]}],{"c-0":["ev",{"^->":"After_ask1.0.c-0.$r2"},"/ev",{"temp=":"$r"},{"->":".^.^.4.s"},[{"#n":"$r2"}],"\n","^\u746a\u9e97\u592b\u4eba\uff1a\u5c0f\u63a2\u9577\u5c31\u653e\u5fc3\u7684\u6aa2\u67e5\u5427\uff0c\u9019\u88e1\u982d\u4e5f\u6c92\u4ec0\u9ebc\u503c\u9322\u7684\u7269\u54c1\uff0c\u90fd\u662f\u4e9b\u7834\u820a\u7684\u5bb6\u5177\u800c\u5df2\u3002","\n","^\u746a\u9e97\u592b\u4eba\u96e2\u958b\u4e86\uff0c\u63a5\u4e0b\u4f86\u60f3\u8981\u600e\u9ebc\u63a2\u67e5\u5462\uff1f","\n",{"->":"action1"},{"#f":5}],"c-1":["ev",{"^->":"After_ask1.0.c-1.$r2"},"/ev",{"temp=":"$r"},{"->":".^.^.5.s"},[{"#n":"$r2"}],"\n","^\u746a\u9e97\u592b\u4eba\uff1a\u54c8\u54c8\uff0c\u597d\u7684\u3002\u5c0f\u63a2\u9577\u4f60\u4e5f\u8981\u6ce8\u610f\u4e00\u4e9b\uff0c\u4e0d\u8981\u88ab\u7070\u5875\u5f04\u5f97\u5674\u568f\u9023\u9023\u5566\u3002","\n","^\u746a\u9e97\u592b\u4eba\u96e2\u958b\u4e86\uff0c\u63a5\u4e0b\u4f86\u60f3\u8981\u600e\u9ebc\u63a2\u67e5\u5462\uff1f","\n",{"->":"action1"},{"#f":5}]}],{"#f":1}],action1:[["ev","str","^\u67e5\u770b\u96dc\u7269","/str",{"VAR?":"item"},1,"==","/ev",{"*":".^.c-0",flg:5},"ev","str","^\u67e5\u770b\u96dc\u7269","/str",{"VAR?":"item"},1,"!=","/ev",{"*":".^.c-1",flg:5},{"c-0":["\n",{"->":"hasflashLight"},{"#f":5}],"c-1":["\n",{"->":"noflashLight"},{"#f":5}]}],{"#f":1}],hasflashLight:[["^\u884c\u52d5:[\u67e5\u770b\u96dc\u7269]","\n","^\u63a2\u9577\u62ff\u8457\u624b\u96fb\u7b52\u5148\u662f\u67e5\u770b\u4e86\u4e00\u4e0b\u90a3\u5806\u7d19\u7bb1\uff0c\u4e0a\u9762\u6eff\u662f\u7070\u5875\u4e14\u6c92\u6709\u88ab\u89f8\u78b0\u904e\u7684\u75d5\u8de1\uff0c\u7c97\u7565\u5224\u65b7\u53ef\u80fd\u4e0d\u662f\u5f9e\u7a97\u6236\u9032\u5165\u2026\u2026\u6216\u8005\u662f\u4e0d\u9700\u8981\u78b0\u89f8\u4e5f\u80fd\u9032\u5165\u7684\u985e\u578b\u3002","\n","ev","str","^\u642c\u958b\u96dc\u7269","/str","/ev",{"*":".^.c-0",flg:20},{"c-0":["\n","^\u884c\u52d5:[\u642c\u958b\u96dc\u7269]","\n","^\u63a2\u9577\u82b1\u4e86\u4e00\u4e9b\u6642\u9593\u4ee5\u53ca\u529b\u6c23\u628a\u96dc\u7269\u642c\u958b\u4e86\uff0c\u7070\u5875\u56db\u6ea2\uff0c\u514b\u91cc\u65af\u5fcd\u4e0d\u4f4f\u54b3\u4e86\u5e7e\u8072\uff0c\u4e00\u908a\u7528\u8863\u670d\u6342\u4f4f\u53e3\u9f3b\u4e00\u908a\u6e4a\u5230\u7a97\u908a\u67e5\u770b\u3002","\n",{"->":"After_action1"},{"#f":5}]}],{"#f":1}],noflashLight:["^\u884c\u52d5:[\u67e5\u770b\u96dc\u7269]","\n","^\u746a\u9e97\u592b\u4eba\u8d70\u4e86\uff0c\u4e5f\u5e36\u8d70\u4e86\u552f\u4e00\u7684\u5149\u6e90\u3002\u5fd8\u8a18\u5e36\u4e0a\u624b\u96fb\u7b52\u7684\u5c0f\u63a2\u9577\u5fcd\u4e0d\u4f4f\u4e00\u62cd\u8166\u888b\uff0c\u61ca\u60f1\u5730\u5600\u5495\u5e7e\u53e5\uff0c\u9023\u5fd9\u8ddf\u4e0a\u746a\u9e97\u592b\u4eba\uff0c\u4e0d\u597d\u610f\u601d\u5730\u501f\u4f86\u4e86\u5979\u7684\u624b\u96fb\u7b52\u3002","\n",{"->":"After_action1"},{"#f":1}],After_action1:[["ev","str","^\u67e5\u770b\u7a97\u6236","/str","/ev",{"*":".^.c-0",flg:20},"ev","str","^\u4f7f\u7528\u87a2\u5149\u7c89","/str",{"VAR?":"item"},2,"==","/ev",{"*":".^.c-1",flg:21},{"c-0":["\n","^\u884c\u52d5:[\u67e5\u770b\u7a97\u6236]","\n","^\u7a97\u6236\u4e0a\u5806\u7a4d\u6eff\u7070\u5875\uff0c\u8207\u65b9\u624d\u63a8\u7406\u7684\u7d50\u679c\u76f8\u7b26\u3002","\n",{"->":"After_action1_1"},{"#f":5}],"c-1":["\n","ev",1,"/ev",{"VAR=":"clue",re:!0},"^\u884c\u52d5:[\u4f7f\u7528\u87a2\u5149\u7c89]","\n","^\u55ef\u2026\u2026\u9019\u7a2e\u7279\u88fd\u7684\u87a2\u5149\u7c89\u53ea\u5728\u7d2b\u5916\u7dda\u4e0b\u6709\u87a2\u5149\u53cd\u61c9\uff0c\u5728\u7a97\u908a\u7051\u4e0b\u4e00\u4e9b\u6216\u8a31\u80fd\u6355\u6349\u5230\u4e00\u4e9b\u8e64\u8de1\uff1f\u4e0d\u904e\u770b\u4f86\u660e\u65e5\u9084\u9700\u8981\u4f86\u78ba\u8a8d\u3002","\n",{"->":"After_action1_1"},{"#f":5}]}],{"#f":1}],After_action1_1:[["ev","str","^\u96e2\u958b","/str","/ev",{"*":".^.c-0",flg:20},{"c-0":["\n",{"->":"action2"},{"#f":5}]}],{"#f":1}],action2:[["^\u63a5\u4e0b\u4f86\u8981?","\n","ev","str","^\u67e5\u770b\u5730\u677f","/str","/ev",{"*":".^.c-0",flg:20},{"c-0":["\n","^\u884c\u52d5:[\u67e5\u770b\u5730\u677f]","\n","^\u672c\u60f3\u78ba\u8a8d\u5730\u677f\u4e0a\u7684\u7070\u5875\u5206\u4f48\u8207\u75d5\u8de1\uff0c\u4f46\u5be6\u969b\u4e0a\u65e9\u5df2\u88ab\u81ea\u5df1\u8207\u746a\u9e97\u592b\u4eba\u7684\u4f86\u56de\u8d70\u52d5\u7d66\u7834\u58de\u4e86\u73fe\u5834\uff0c\u672a\u4f86\u7684\u540d\u5075\u63a2\u61ca\u60f1\u5730\u62cd\u62cd\u8166\u888b\uff0c\u61c9\u8a72\u60f3\u5230\u9019\u9ede\u7684\u624d\u5c0d\u3002","\n",["ev","str","^\u4f7f\u7528\u653e\u5927\u93e1","/str",{"VAR?":"item"},3,"==","/ev",{"*":".^.c-0",flg:21},"ev","str","^\u4f7f\u7528\u87a2\u5149\u7c89","/str",{"VAR?":"item"},2,"==","/ev",{"*":".^.c-1",flg:21},{"c-0":["\n","ev",2,"/ev",{"VAR=":"clue",re:!0},"^\u884c\u52d5:[\u4f7f\u7528\u653e\u5927\u93e1]","\n","^\uff08\u5728\u4ed4\u7d30\u7684\u641c\u7d22\u4e0b\u514b\u91cc\u65af\u767c\u73fe\u4e86\u5ee2\u68c4\u7684\u6c99\u767c\u65c1\u6709\u8a31\u591a\u660e\u986f\u770b\u8d77\u4f86\u4e0d\u662f\u6210\u4eba\u7684\u8173\u5370\u75d5\u8de1\uff0c\u4ee5\u53ca\u8a31\u591a\u5169\u689d\u5f88\u7d30\u7684\u5e73\u884c\u7dda\uff0c\u5ef6\u4f38\u4e86\u4e00\u5c0f\u6bb5\u8ddd\u96e2\u3002\uff09","\n","^\u55ef\uff1f\u9019\u9ebc\u5c0f\u7684\u8173\u5370\u2014\u2014\u5c0f\u5b69\u5b50\uff1f\u662f\u840a\u65af\u8389\u55ce\uff1f\u2026\u2026\u9084\u6709\u9019\u662f\u4ec0\u9ebc\u75d5\u8de1\uff1f\u514b\u91cc\u65af\u6478\u4e0d\u6e05\uff0c\u53ea\u597d\u5148\u62cd\u4e0b\u4f86\u65b9\u4fbf\u7a0d\u5f8c\u67e5\u770b\u3002","\n",["ev","str","^\u7d50\u675f\u884c\u52d5","/str","/ev",{"*":".^.c-0",flg:20},{"c-0":["\n","^\u884c\u52d5:[\u7d50\u675f\u884c\u52d5]","\n","^\u514b\u91cc\u65af\u7d50\u675f\u4e86\u884c\u52d5","\n",{"->":"finish_investigation_1"},{"#f":5}]}],{"#f":5}],"c-1":["\n","ev",1,"/ev",{"VAR=":"clue",re:!0},"^\u65e2\u7136\u7a97\u908a\u90fd\u7051\u4e86\uff0c\u9019\u908a\u4e5f\u7051\u4e00\u4e9b\u770b\u770b\u6703\u6709\u4ec0\u9ebc\u6536\u7a6b\u5427\uff01\u2026\u2026\u54ce\u5440\uff0c\u4e0d\u904e\u8981\u5148\u8ddf\u746a\u9e97\u592b\u4eba\u8aaa\u66ab\u6642\u4e0d\u8981\u4e0a\u4f86\u95a3\u6a13\u4e86\u3002\u540c\u6a23\u7684\u932f\u63a2\u9577\u6211\u53ef\u4e0d\u6703\u72af\u7b2c\u4e8c\u6b21\u2014\u2014\uff01","\n",["ev","str","^\u7d50\u675f\u884c\u52d5","/str","/ev",{"*":".^.c-0",flg:20},{"c-0":["\n","^\u884c\u52d5:[\u7d50\u675f\u884c\u52d5]","\n","^\u514b\u91cc\u65af\u7d50\u675f\u4e86\u884c\u52d5","\n",{"->":"finish_investigation_1"},{"#f":5}]}],{"#f":5}]}],{"#f":5}]}],{"#f":1}],finish_investigation_1:[["ev","str","^\u6574\u7406\u601d\u7dd2","/str",{"VAR?":"clue"},1,"==","/ev",{"*":".^.c-0",flg:5},"ev","str","^\u6574\u7406\u601d\u7dd2","/str",{"VAR?":"clue"},2,"==","/ev",{"*":".^.c-1",flg:5},{"c-0":["\n","^\u770b\u4f86\u9084\u5f97\u4f86\u5e7e\u8d9f\u78ba\u8a8d\u72af\u4eba\u662f\u5426\u6709\u518d\u5149\u81e8\u3002\u9084\u4ee5\u70ba\u4e00\u5929\u4e4b\u5167\u80fd\u89e3\u6c7a\u5462\uff01\u56de\u53bb\u6703\u4e0d\u6703\u88ab\u5c0f\u52a9\u624b\u7b11\u8a71\u554a\uff1f\u2026\u2026\u54ce\u5440\u3001\u80af\u5b9a\u4e0d\u6703\u7684\uff01\u4e0d\u904e\u88dd\u5099\u5e36\u7684\u4e0d\u5920\u9f4a\u5168\u5462\uff0c\u770b\u4f86\u660e\u5929\u4e5f\u5f97\u628a\u653e\u5927\u93e1\u5e36\u4e0a\u3002","\n",{"->":"goodbye_1"},{"#f":5}],"c-1":["\n","^\u76ee\u524d\u7dda\u7d22\u6709\u2026\u2026\u55ef\uff0c\u5c0f\u5b69\u5b50\u7684\u8173\u5370\uff0c\u5947\u602a\u7684\u5e73\u884c\u7dda\uff0c\u7b49\u7b49\u53bb\u554f\u4e00\u4e0b\u840a\u65af\u8389\u6709\u6c92\u6709\u4e0a\u4f86\u904e\u95a3\u6a13\u5427\u3002\u5982\u679c\u6709\u7684\u8a71\u662f\u56e0\u70ba\u4ec0\u9ebc\u539f\u56e0\u4e0a\u4f86\u7684\u5462\uff1f\u6c92\u6709\u7684\u8a71\uff0c\u6216\u8a31\u72af\u4eba\u5c31\u662f\u5c0f\u5b69\u5b50\u7981\u9589\u8005\uff1f\u54ce\u5440\uff0c\u770b\u4f86\u5f97\u8b93\u9053\u723e\u63a2\u9577\u5e6b\u5fd9\u67e5\u67e5\u9019\u9644\u8fd1\u7684\u5831\u6848\u7d00\u9304\u4e86\u3002","\n",["ev","str","^\u4e0b\u6a13\u8a62\u554f\u840a\u65af\u8389","/str","/ev",{"*":".^.c-0",flg:20},{"c-0":["\n","^\u884c\u52d5:[\u8a62\u554f]","\n","^\u5c0f\u63a2\u9577\u9806\u8457\u746a\u9e97\u592b\u4eba\u7684\u6307\u5f15\u4f86\u5230\u4e86\u840a\u65af\u8389\u7684\u623f\u9593\uff0c\u5979\u807d\u898b\u6572\u9580\u8072\u4fbf\u4e56\u5de7\u5730\u958b\u4e86\u9580\uff0c\u514b\u91cc\u65af\u900f\u904e\u9580\u7e2b\u80fd\u770b\u898b\u5979\u65b9\u624d\u6b63\u5728\u73a9\u73a9\u5177\u6c7d\u8eca\u3002","\n","^\uff08\u514b\u91cc\u65af\u8e72\u4e0b\u8eab\u5b50\u8b93\u81ea\u5df1\u4e0d\u6703\u986f\u5f97\u904e\u65bc\u58d3\u8feb\u5c0d\u65b9\uff0c\u4e26\u4e14\u5728\u840a\u65af\u8389\u7684\u624b\u5fc3\u4e2d\u653e\u4e86\u4e00\u5c0f\u9846\u7cd6\u679c\uff0c\u671d\u5979\u7728\u7728\u773c\u3002\uff09","\n","^\u514b\u91cc\u65af\uff1a\u4e0d\u597d\u610f\u601d\u5440\u6253\u64fe\u4e86\u4f60\u7684\u73a9\u800d\u6642\u9593\uff0c\u4f46\u6211\u60f3\u554f\u4e00\u500b\u5c0f\u554f\u984c\uff0c\u53ef\u4ee5\u7528\u9019\u9846\u7cd6\u679c\u8ddf\u4f60\u4ea4\u63db\u55ce\uff1f","\n","^\uff08\u840a\u65af\u8389\u770b\u8d77\u4f86\u6709\u4e9b\u7336\u8c6b\u4ee5\u53ca\u5bb3\u7f9e\uff0c\u4f46\u6700\u5f8c\u9084\u662f\u63e1\u8d77\u638c\u5fc3\u5c07\u7cd6\u679c\u6536\u4e0b\u4e86\u3002\uff09","\n","^\u840a\u65af\u8389\uff1a\u59d0\u59d0\u60f3\u554f\u4ec0\u9ebc\u554f\u984c\uff1f","\n",["ev","str","^\u7e7c\u7e8c\u8a62\u554f\u840a\u65af\u8389","/str","/ev",{"*":".^.c-0",flg:20},{"c-0":["\n","^\u884c\u52d5:[\u7e7c\u7e8c\u8a62\u554f]","\n","^\u514b\u91cc\u65af\uff1a\u4f60\u6700\u8fd1\u6709\u4e0a\u53bb\u95a3\u6a13\u55ce\uff1f","\n","^\u840a\u65af\u8389\uff1a\u2026\u2026\u6709\u3002","\n","^\uff08\u5979\u7684\u8996\u7dda\u7de9\u7de9\u98c4\u79fb\u958b\uff0c\u8072\u97f3\u5f88\u5c0f\u8072\uff0c\u770b\u8d77\u4f86\u4e0d\u662f\u5f88\u9858\u610f\u591a\u8aaa\u3002\uff09","\n","^\u514b\u91cc\u65af\uff1a\u597d\u5566\uff01\u6211\u7684\u554f\u984c\u554f\u5b8c\u4e86\uff01\u8b1d\u8b1d\u4f60\u5440\u840a\u65af\u8389\u3002","\n","^\u514b\u91cc\u65af\u7684\u8166\u4e2d\u5927\u81f4\u4e0a\u6709\u4e86\u4e00\u4e9b\u731c\u6e2c\uff0c\u5979\u563f\u54bb\u4e00\u8072\u7ad9\u76f4\u4e86\u8eab\u9ad4\uff0c\u96a8\u5f8c\u6478\u4e86\u6478\u840a\u65af\u8389\u7684\u8166\u888b\uff0c\u6372\u6372\u7684\u982d\u9aee\u5728\u638c\u5fc3\u7684\u89f8\u611f\u4e0d\u932f\uff0c\u745f\u7433\u59d0\u59d0\u7576\u521d\u662f\u4e0d\u662f\u4e5f\u6703\u9019\u9ebc\u89ba\u5f97\uff1f\u2026\u2026\u601d\u7dd2\u8dd1\u6389\u4e86\uff01\u5feb\u56de\u4f86\uff01","\n","^\u514b\u91cc\u65af\u6643\u4e86\u6643\u8166\u888b\uff0c\u53c8\u7d66\u5c0f\u840a\u65af\u8389\u4e86\u4e00\u9846\u7cd6\u679c\u3002","\n",{"->":"goodbye_1"},{"#f":5}]}],{"#f":5}]}],{"#f":5}]}],{"#f":1}],goodbye_1:[["ev","str","^\u9053\u5225","/str","/ev",{"*":".^.c-0",flg:20},{"c-0":["\n","^\u884c\u52d5:[\u9053\u5225]","\n","^\u514b\u91cc\u65af\u773c\u770b\u6642\u9593\u6709\u4e9b\u665a\u4e86\uff0c\u5148\u662f\u8ddf\u746a\u9e97\u592b\u4eba\u901a\u77e5\u4e86\u4e00\u4e0b\u9019\u5e7e\u5929\u90fd\u5148\u4e0d\u8981\u4e0a\u53bb\u95a3\u6a13\uff0c\u4ee5\u53ca\u81ea\u5df1\u660e\u5f8c\u5929\u61c9\u8a72\u6703\u518d\u4f86\u78ba\u8a8d\u4e00\u6b21\u7684\u6d88\u606f\u3002\u5f97\u5230\u540c\u610f\u5f8c\u624d\u671d\u8457\u5979\u5011\u63ee\u624b\u9053\u5225","\n",[["ev",{"^->":"goodbye_1.0.c-0.5.0.$r1"},{"temp=":"$r"},"str",{"->":".^.s"},[{"#n":"$r1"}],"/str","/ev",{"*":".^.^.c-0",flg:18},{s:["^\u56de\u7ba1\u7406\u5c40",{"->":"$r",var:!0},null]}],{"c-0":["ev",{"^->":"goodbye_1.0.c-0.5.c-0.$r2"},"/ev",{"temp=":"$r"},{"->":".^.^.0.s"},[{"#n":"$r2"}],"\n","^\u6709\u4e86\u4e9b\u8a31\u6536\u7a6b\u7684\u5c0f\u63a2\u9577\u4e00\u56de\u53bb\u5c31\u5f80\u5c40\u9577\u8fa6\u516c\u5ba4\u5954\u53bb\u3002\u4f60\u6b63\u597d\u5c07\u516c\u6587\u8655\u7406\u5230\u4e00\u500b\u6bb5\u843d\uff0c\u5fc3\u60c5\u6b63\u597d\uff0c\u5c31\u807d\u898b\u514b\u91cc\u65af\u90a3\u719f\u6089\u7684\u8173\u6b65\u8072\u3002","\n",{"->":"finish_day_1"},{"#f":5}]}],{"#f":5}]}],{"#f":1}],finish_day_1:[["ev","str","^\u62ac\u982d","/str",{"VAR?":"clue"},0,"==","/ev",{"*":".^.c-0",flg:5},"ev","str","^\u62ac\u982d","/str",{"VAR?":"clue"},1,"==","/ev",{"*":".^.c-1",flg:5},"ev","str","^\u62ac\u982d","/str",{"VAR?":"clue"},2,"==","/ev",{"*":".^.c-2",flg:5},{"c-0":["\n","^\u514b\u91cc\u65af\uff1a\u5c0f\u52a9\u624b\uff0c\u6211\u56de\u4f86\u5566\u2014\u2014\u3002\u5514\u3001\u9019\u6b21\u7684\u73fe\u5834\u63a2\u52d8\u627e\u5230\u7684\u7dda\u7d22\u592a\u5c11\u4e86\uff0c\u6050\u6015\u9084\u5f97\u660e\u5929\u518d\u5e36\u4e0a\u4e00\u4e9b\u5de5\u5177\uff01","\n","^\u514b\u91cc\u65af\uff1a\u9084\u6709\u9019\u4e9b\uff0c\u9019\u4e9b\u662f\u6211\u63a1\u8a2a\u5b8c\u5831\u6848\u4eba\u8207\u63a2\u52d8\u5b8c\u73fe\u5834\u5f8c\u6574\u7406\u51fa\u4f86\u7684\u6642\u9593\u7dda\uff0c\u5177\u9ad4\u7684\u5c31\u7b49\u6211\u660e\u5929\u63a2\u6848\u56de\u4f86\u518d\u8ddf\u5c0f\u52a9\u624b\u4e00\u8d77\u8a0e\u8ad6\u5427\uff01","\n","^\u514b\u91cc\u65af\uff1a\u2026\u2026\u563f\u563f\u3001\u6c92\u60f3\u5230\u9019\u6b21\u662f\u6211\u8aaa\u5f97\u592a\u81ea\u4fe1\u5566\u3002\u4e0b\u6b21\u4e00\u5b9a\u6539\u5584\uff01","\n","^\u514b\u91cc\u65af\u5288\u88e1\u556a\u5566\u8b1b\u4e86\u4e00\u9023\u4e32\u7684\u8a71\u4e4b\u5f8c\u53c8\u98a8\u98a8\u706b\u706b\u7684\u8dd1\u6389\u4e86\u3002","\n",{"->":"END1"},{"#f":5}],"c-1":["\n","^\u514b\u91cc\u65af\uff1a\u5c0f\u52a9\u624b\uff0c\u6211\u56de\u4f86\u5566\u2014\u2014\u3002\u5514\u3001\u9019\u6b21\u7684\u73fe\u5834\u63a2\u52d8\u627e\u5230\u7684\u7dda\u7d22\u592a\u5c11\u4e86\uff0c\u6050\u6015\u9084\u5f97\u660e\u5929\u518d\u5e36\u4e0a\u4e00\u4e9b\u5de5\u5177\uff01","\n","^\u514b\u91cc\u65af\uff1a\u6211\u5728\u91cd\u9ede\u4f4d\u7f6e\u7051\u4e0a\u4e86\u4e00\u4e9b\u87a2\u5149\u7c89\uff0c\u5982\u679c\u9019\u5e7e\u5929\u72af\u4eba\u6709\u91cd\u8fd4\u73fe\u5834\u7684\u8a71\uff0c\u90a3\u9ebc\u2014\u2014\u53ea\u8981\u7528\u6211\u7279\u88fd\u7684\u71c8\u7167\u904e\u53bb\uff0c\u5c31\u80fd\u770b\u898b\u72af\u4eba\u7559\u4e0b\u7684\u75d5\u8de1\u5566\uff01","\n","^\u514b\u91cc\u65af\uff1a\u65e2\u7136\u80fd\u767c\u51fa\u8173\u6b65\u8072\uff0c\u90a3\u9ebc\u4e00\u5b9a\u662f\u6709\u5be6\u9ad4\u7684\u5427\uff1f\u9019\u6a23\u7684\u8a71\uff0c\u7e3d\u6703\u6709\u78b0\u89f8\u5230\u7c89\u672b\u7684\u6a5f\u7387\u3002","\n","^\u514b\u91cc\u65af\uff1a\u53ea\u8981\u7b49\u5f85\u5e7e\u5929\u2026\u2026\u54fc\u54fc\uff01\u5c31\u662f\u514b\u91cc\u65af\u63a2\u9577\u7684\u6536\u5272\u6642\u523b\uff01","\n","^\u514b\u91cc\u65af\u975e\u5e38\u8208\u596e\u5730\u6276\u6b63\u81ea\u5df1\u7684\u7375\u9e7f\u5e3d\uff0c\u4e00\u908a\u54fc\u8457\u6b4c\u4e00\u908a\u8e66\u8e66\u8df3\u8df3\u7684\u96e2\u958b\u4e86\u4f60\u7684\u8fa6\u516c\u5ba4\u3002","\n",{"->":"END1"},{"#f":5}],"c-2":["\n","^\u514b\u91cc\u65af\uff1a\u5c0f\u52a9\u624b\u2014\u2014\uff01\u6211\u56de\u4f86\u5566\uff01\u54b3\u54b3\u3001\u96d6\u7136\u6c92\u6709\u4eca\u5929\u5c31\u902e\u51fa\u72af\u4eba\uff0c\u4f46\u6211\u4e5f\u627e\u5230\u4e86\u4e0d\u5c11\u7dda\u7d22\u5594\uff01","\n","^\u514b\u91cc\u65af\uff1a\u4f60\u77a7\uff0c\u9019\u88e1\u6709\u5c0f\u5b69\u5b50\u7684\u8173\u5370\u3002\u9084\u6709\u9019\u7a2e\u2026\u2026\u55ef\uff0c\u4e0d\u592a\u7406\u89e3\u7684\u75d5\u8de1\uff0c\u4e3b\u8981\u5206\u4f48\u5728\u6c99\u767c\u65c1\u3002","\n","^\u514b\u91cc\u65af\uff1a\u6211\u554f\u904e\u5831\u6848\u4eba\u5bb6\u7684\u5b69\u5b50\u4e86\uff0c\u8aaa\u5979\u6709\u53bb\u904e\u95a3\u6a13\uff0c\u4f46\u5728\u9019\u4e4b\u524d\u5979\u4e5f\u8ddf\u5831\u6848\u4eba\u8aaa\u904e\u6709\u807d\u898b\u5947\u602a\u7684\u8072\u97f3\u3002\u2026\u2026\u55ef\uff0c\u662f\u807d\u898b\u8072\u97f3\u5f8c\u7368\u81ea\u4e0a\u53bb\u67e5\u770b\u55ce\uff1f\u5c0f\u52a9\u624b\uff0c\u4f60\u600e\u9ebc\u60f3\uff1f","\n",["ev","str","^\u8b1b\u8a34\u731c\u6e2c","/str","/ev",{"*":".^.c-0",flg:20},{"c-0":["\n","^\u884c\u52d5:[\u8b1b\u8a34\u731c\u6e2c]","\n","^\u514b\u91cc\u65af\uff1a\u55ef\uff1f\u5be6\u969b\u4e0a\u6c92\u6709\u72af\u4eba\uff1f\u2026\u2026\u6c92\u932f\uff0c\u6216\u8a31\u4e5f\u6709\u9019\u500b\u53ef\u80fd\u6027\uff0c\u5148\u5165\u70ba\u4e3b\u53ef\u4e0d\u662f\u4e00\u500b\u597d\u7fd2\u6163\uff01\u6211\u9019\u5e7e\u5929\u6703\u518d\u7559\u610f\u4e00\u4e0b\u7684\u3002","\n","^\u514b\u91cc\u65af\uff1a\u6211\u77e5\u9053\u840a\u65af\u8389\u80af\u5b9a\u6709\u4ec0\u9ebc\u6c92\u6709\u8aaa\u51fa\u4f86\uff0c\u4f46\u65e2\u7136\u5979\u4e0d\u9858\u610f\u8aaa\u7684\u8a71\uff0c\u5c31\u8b93\u514b\u91cc\u65af\u63a2\u9577\u4f86\u89aa\u81ea\u627e\u51fa\u771f\u76f8\u5427\uff01\u63a2\u9577\u6211\u53ef\u6c92\u6709\u903c\u554f\u5c0f\u5b69\u5b50\u7684\u58de\u7fd2\u6163\u5462\u3002","\n",["ev","str","^\u8a87\u734e","/str","/ev",{"*":".^.c-0",flg:20},{"c-0":["\n","^\u884c\u52d5:[\u8a87\u734e]","\n","^\u514b\u91cc\u65af\uff1a\u5c0f\u52a9\u624b\u4f60\u8a87\u5f97\u6211\u90fd\u4e0d\u597d\u610f\u601d\u8d77\u4f86\u4e86\u2026\u2026\u3002\u4f60\u53ef\u4ee5\u770b\u898b\u514b\u91cc\u65af\u4e0d\u597d\u610f\u601d\u5730\u58d3\u4f4e\u5e3d\u6cbf\uff0c\u7d05\u4e86\u8033\u5c16\uff0c\u5600\u5600\u5495\u5495\u5730\u8d70\u51fa\u4e86\u4f60\u7684\u8fa6\u516c\u5ba4\u3002","\n",{"->":"END1"},{"#f":5}]}],{"#f":5}]}],{"#f":5}]}],{"#f":1}],END1:["^\u2606\xb0\uff0e\ufe52\u2606\xb0\uff0e\ufe52 \u2606\xb0\uff0e\ufe52 \u2606\xb0\uff0e\ufe52 \u2606\xb0\uff0e\ufe52 \u2606\xb0\uff0e\ufe52\u2606\xb0\uff0e\ufe52\u2606\xb0\uff0e","\n","^\u76ee\u524d\u904a\u6232\u5287\u60c5\u5c31\u5230\u9019\u88e1\u5566\uff01\u662f\u4e0d\u662f\u5f88\u671f\u5f85\u72af\u4eba\uff1f\u662f\u4e0d\u662f\u5f88\u597d\u5947\u5f8c\u7e8c\uff1f\u563f\u563f\u3001\u597d\u5947\u7684\u8a71\u5c31\u7e7c\u7e8c\u671f\u5f85\u5c0f\u63a2\u9577\u628a\u5f8c\u7e8c\u7684\u6848\u4ef6\u904e\u7a0b\u5beb\u51fa\u4f86\u5427\uff01","\n","^\u2014\u2014\u5dee\u9ede\u5fd8\u4e86\uff0c\u5982\u679c\u5c0d\u6d41\u7a0b\u6709\u5efa\u8b70\uff0c\u6216\u8005\u60f3\u8ddf\u6211\u8aaa\u4ec0\u9ebc\u7684\u8a71\uff0c\u53ef\u4ee5\u767c\u9001\u5230\u4e0b\u9762\u7684\u4fe1\u7bb1\uff01\u5c0f\u63a2\u9577\u5728\u63a2\u6848\u7a7a\u9592\u6642\u6703\u67e5\u770b\u7684\uff01","\n","^christina57320915@gmail.com","\n","end",{"#f":1}],"global decl":["ev",0,{"VAR=":"item"},0,{"VAR=":"clue"},"/ev","end",null],"#f":1}],listDefs:{}};